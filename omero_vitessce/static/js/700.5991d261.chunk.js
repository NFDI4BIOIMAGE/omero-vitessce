/*! For license information please see 700.5991d261.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkomero_vitessce=self.webpackChunkomero_vitessce||[]).push([[700],{700:(e,t,n)=>{n.d(t,{SpatialWrapper:()=>Oa});var r,o,i=n(150),a=n(43),s={exports:{}},l={};var u=(o||(o=1,s.exports=(r||(r=1,l.ConcurrentRoot=1,l.ContinuousEventPriority=4,l.DefaultEventPriority=16,l.DiscreteEventPriority=1,l.IdleEventPriority=536870912,l.LegacyRoot=0),l)),s.exports);function c(e){let t;const n=new Set,r=(e,r)=>{const o="function"==typeof e?e(t):e;if(o!==t){const e=t;t=r?o:Object.assign({},t,o),n.forEach(n=>n(t,e))}},o=()=>t,i={setState:r,getState:o,subscribe:(e,r,i)=>r||i?function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let a=r(t);function s(){const n=r(t);if(!i(a,n)){const t=a;e(a=n,t)}}return n.add(s),()=>n.delete(s)}(e,r,i):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(r,o,i),i}const d=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?a.useEffect:a.useLayoutEffect;function f(e){const t="function"==typeof e?c(e):e,n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,r]=(0,a.useReducer)(e=>e+1,0),o=t.getState(),i=(0,a.useRef)(o),s=(0,a.useRef)(e),l=(0,a.useRef)(n),u=(0,a.useRef)(!1),c=(0,a.useRef)();void 0===c.current&&(c.current=e(o));let f,h=!1;(i.current!==o||s.current!==e||l.current!==n||u.current)&&(f=e(o),h=!n(c.current,f)),d(()=>{h&&(c.current=f),i.current=o,s.current=e,l.current=n,u.current=!1});const p=(0,a.useRef)(o);d(()=>{const e=()=>{try{const e=t.getState(),n=s.current(e);l.current(c.current,n)||(i.current=e,c.current=n,r())}catch{u.current=!0,r()}},n=t.subscribe(e);return t.getState()!==p.current&&e(),n},[]);const m=h?f:c.current;return(0,a.useDebugValue)(m),m};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[n,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},n}var h,p,m,g,v,y={exports:{}},b={exports:{}},x={};function w(){return p||(p=1,b.exports=(h||(h=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,l=e[s],u=s+1,c=e[u];if(0>o(l,n))u<i&&0>o(c,l)?(e[r]=c,e[u]=n,r=u):(e[r]=l,e[s]=n,r=s);else{if(!(u<i&&0>o(c,n)))break e;e[r]=c,e[u]=n,r=u}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var l=[],u=[],c=1,d=null,f=3,h=!1,p=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;function b(e){for(var o=n(u);null!==o;){if(null===o.callback)r(u);else{if(!(o.startTime<=e))break;r(u),o.sortIndex=o.expirationTime,t(l,o)}o=n(u)}}function x(e){if(m=!1,b(e),!p)if(null!==n(l))p=!0,R(w);else{var t=n(u);null!==t&&k(x,t.startTime-e)}}function w(t,o){p=!1,m&&(m=!1,v(A),A=-1),h=!0;var i=f;try{for(b(o),d=n(l);null!==d&&(!(d.expirationTime>o)||t&&!C());){var a=d.callback;if("function"==typeof a){d.callback=null,f=d.priorityLevel;var s=a(d.expirationTime<=o);o=e.unstable_now(),"function"==typeof s?d.callback=s:d===n(l)&&r(l),b(o)}else r(l);d=n(l)}if(null!==d)var c=!0;else{var g=n(u);null!==g&&k(x,g.startTime-o),c=!1}return c}finally{d=null,f=i,h=!1}}typeof navigator<"u"&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,_=!1,E=null,A=-1,T=5,P=-1;function C(){return!(e.unstable_now()-P<T)}function M(){if(null!==E){var t=e.unstable_now();P=t;var n=!0;try{n=E(!0,t)}finally{n?S():(_=!1,E=null)}}else _=!1}if("function"==typeof y)S=function(){y(M)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,I=L.port2;L.port1.onmessage=M,S=function(){I.postMessage(null)}}else S=function(){g(M,0)};function R(e){E=e,_||(_=!0,S())}function k(t,n){A=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){p||h||(p=!0,R(w))},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},e.unstable_scheduleCallback=function(r,o,i){var a=e.unstable_now();switch(i="object"==typeof i&&null!==i&&"number"==typeof(i=i.delay)&&0<i?a+i:a,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:c++,callback:o,priorityLevel:r,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>a?(r.sortIndex=i,t(u,r),null===n(l)&&r===n(u)&&(m?(v(A),A=-1):m=!0,k(x,i-a))):(r.sortIndex=s,t(l,r),p||h||(p=!0,R(w))),r},e.unstable_shouldYield=C,e.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}}(x)),x)),b.exports}function S(){return g||(g=1,m=function(e){var t={},n=a,r=w(),o=Object.assign;function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),p=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),x=Symbol.for("react.offscreen"),S=Symbol.iterator;function _(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=S&&e[S]||e["@@iterator"])?e:null}function E(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case c:return"Fragment";case u:return"Portal";case f:return"Profiler";case d:return"StrictMode";case g:return"Suspense";case v:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case p:return(e.displayName||"Context")+".Consumer";case h:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:E(e.type)||"Memo";case b:t=e._payload,e=e._init;try{return E(e(t))}catch{}}return null}function A(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E(t);case 8:return t===d?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function T(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function P(e){if(T(e)!==e)throw Error(i(188))}function C(e){var t=e.alternate;if(!t){if(null===(t=T(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(r=o.return)){n=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return P(o),e;if(a===r)return P(o),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=o,r=a;else{for(var s=!1,l=o.child;l;){if(l===n){s=!0,n=o,r=a;break}if(l===r){s=!0,r=o,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,r=o;break}if(l===r){s=!0,r=a,n=o;break}l=l.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}function M(e){return null!==(e=C(e))?L(e):null}function L(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=L(e);if(null!==t)return t;e=e.sibling}return null}function I(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=I(e);if(null!==t)return t}e=e.sibling}return null}var R,k=Array.isArray,z=e.getPublicInstance,N=e.getRootHostContext,O=e.getChildHostContext,j=e.prepareForCommit,B=e.resetAfterCommit,D=e.createInstance,U=e.appendInitialChild,F=e.finalizeInitialChildren,H=e.prepareUpdate,V=e.shouldSetTextContent,G=e.createTextInstance,q=e.scheduleTimeout,W=e.cancelTimeout,X=e.noTimeout,K=e.isPrimaryRenderer,Y=e.supportsMutation,Q=e.supportsPersistence,$=e.supportsHydration,Z=e.getInstanceFromNode,J=e.preparePortalMount,ee=e.getCurrentEventPriority,te=e.detachDeletedInstance,ne=e.supportsMicrotasks,re=e.scheduleMicrotask,oe=e.supportsTestSelectors,ie=e.findFiberRoot,ae=e.getBoundingRect,se=e.getTextContent,le=e.isHiddenSubtree,ue=e.matchAccessibilityRole,ce=e.setFocusIfFocusable,de=e.setupIntersectionObserver,fe=e.appendChild,he=e.appendChildToContainer,pe=e.commitTextUpdate,me=e.commitMount,ge=e.commitUpdate,ve=e.insertBefore,ye=e.insertInContainerBefore,be=e.removeChild,xe=e.removeChildFromContainer,we=e.resetTextContent,Se=e.hideInstance,_e=e.hideTextInstance,Ee=e.unhideInstance,Ae=e.unhideTextInstance,Te=e.clearContainer,Pe=e.cloneInstance,Ce=e.createContainerChildSet,Me=e.appendChildToContainerChildSet,Le=e.finalizeContainerChildren,Ie=e.replaceContainerChildren,Re=e.cloneHiddenInstance,ke=e.cloneHiddenTextInstance,ze=e.canHydrateInstance,Ne=e.canHydrateTextInstance,Oe=e.canHydrateSuspenseInstance,je=e.isSuspenseInstancePending,Be=e.isSuspenseInstanceFallback,De=e.registerSuspenseInstanceRetry,Ue=e.getNextHydratableSibling,Fe=e.getFirstHydratableChild,He=e.getFirstHydratableChildWithinContainer,Ve=e.getFirstHydratableChildWithinSuspenseInstance,Ge=e.hydrateInstance,qe=e.hydrateTextInstance,We=e.hydrateSuspenseInstance,Xe=e.getNextHydratableInstanceAfterSuspenseInstance,Ke=e.commitHydratedContainer,Ye=e.commitHydratedSuspenseInstance,Qe=e.clearSuspenseBoundary,$e=e.clearSuspenseBoundaryFromContainer,Ze=e.shouldDeleteUnhydratedTailInstances,Je=e.didNotMatchHydratedContainerTextInstance,et=e.didNotMatchHydratedTextInstance;function tt(e){if(void 0===R)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);R=t&&t[1]||""}return"\n"+R+e}var nt=!1;function rt(e,t){if(!e||nt)return"";nt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&"string"==typeof u.stack){for(var o=u.stack.split("\n"),i=r.stack.split("\n"),a=o.length-1,s=i.length-1;1<=a&&0<=s&&o[a]!==i[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==i[s]){if(1!==a||1!==s)do{if(a--,0>--s||o[a]!==i[s]){var l="\n"+o[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=s);break}}}finally{nt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?tt(e):""}var ot=Object.prototype.hasOwnProperty,it=[],at=-1;function st(e){return{current:e}}function lt(e){0>at||(e.current=it[at],it[at]=null,at--)}function ut(e,t){at++,it[at]=e.current,e.current=t}var ct={},dt=st(ct),ft=st(!1),ht=ct;function pt(e,t){var n=e.type.contextTypes;if(!n)return ct;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,i={};for(o in n)i[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function mt(e){return null!=(e=e.childContextTypes)}function gt(){lt(ft),lt(dt)}function vt(e,t,n){if(dt.current!==ct)throw Error(i(168));ut(dt,t),ut(ft,n)}function yt(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,A(e)||"Unknown",a));return o({},n,r)}function bt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ct,ht=dt.current,ut(dt,e),ut(ft,ft.current),!0}function xt(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=yt(e,t,ht),r.__reactInternalMemoizedMergedChildContext=e,lt(ft),lt(dt),ut(dt,e)):lt(ft),ut(ft,n)}var wt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(St(e)/_t|0)|0},St=Math.log,_t=Math.LN2;var Et=64,At=4194304;function Tt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Pt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,i=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~o;0!==s?r=Tt(s):0!==(i&=a)&&(r=Tt(i))}else 0!==(a=n&~o)?r=Tt(a):0!==i&&(r=Tt(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(i=t&-t)||16===o&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-wt(t)),r|=e[n],t&=~o;return r}function Ct(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Lt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function It(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-wt(t)]=n}function Rt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-wt(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var kt=0;function zt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Nt=r.unstable_scheduleCallback,Ot=r.unstable_cancelCallback,jt=r.unstable_shouldYield,Bt=r.unstable_requestPaint,Dt=r.unstable_now,Ut=r.unstable_ImmediatePriority,Ft=r.unstable_UserBlockingPriority,Ht=r.unstable_NormalPriority,Vt=r.unstable_IdlePriority,Gt=null,qt=null;var Wt="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Xt=null,Kt=!1,Yt=!1;function Qt(e){null===Xt?Xt=[e]:Xt.push(e)}function $t(){if(!Yt&&null!==Xt){Yt=!0;var e=0,t=kt;try{var n=Xt;for(kt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Xt=null,Kt=!1}catch(o){throw null!==Xt&&(Xt=Xt.slice(e+1)),Nt(Ut,$t),o}finally{kt=t,Yt=!1}}return null}var Zt=s.ReactCurrentBatchConfig;function Jt(e,t){if(Wt(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!ot.call(t,o)||!Wt(e[o],t[o]))return!1}return!0}function en(e){switch(e.tag){case 5:return tt(e.type);case 16:return tt("Lazy");case 13:return tt("Suspense");case 19:return tt("SuspenseList");case 0:case 2:case 15:return e=rt(e.type,!1);case 11:return e=rt(e.type.render,!1);case 1:return e=rt(e.type,!0);default:return""}}function tn(e,t){if(e&&e.defaultProps){for(var n in t=o({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var nn=st(null),rn=null,on=null,an=null;function sn(){an=on=rn=null}function ln(e,t,n){K?(ut(nn,t._currentValue),t._currentValue=n):(ut(nn,t._currentValue2),t._currentValue2=n)}function un(e){var t=nn.current;lt(nn),K?e._currentValue=t:e._currentValue2=t}function cn(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function dn(e,t){rn=e,an=on=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Bo=!0),e.firstContext=null)}function fn(e){var t=K?e._currentValue:e._currentValue2;if(an!==e)if(e={context:e,memoizedValue:t,next:null},null===on){if(null===rn)throw Error(i(308));on=e,rn.dependencies={lanes:0,firstContext:e}}else on=on.next=e;return t}var hn=null,pn=!1;function mn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function vn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function yn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==Qi&&0!==(1&e.mode)&&0===(2&Yi)?(null===(e=n.interleaved)?(t.next=t,null===hn?hn=[n]:hn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function bn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Rt(e,n)}}function xn(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?o=i=a:i=i.next=a,n=n.next}while(null!==n);null===i?o=i=t:i=i.next=t}else o=i=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function wn(e,t,n,r){var i=e.updateQueue;pn=!1;var a=i.firstBaseUpdate,s=i.lastBaseUpdate,l=i.shared.pending;if(null!==l){i.shared.pending=null;var u=l,c=u.next;u.next=null,null===s?a=c:s.next=c,s=u;var d=e.alternate;null!==d&&((l=(d=d.updateQueue).lastBaseUpdate)!==s&&(null===l?d.firstBaseUpdate=c:l.next=c,d.lastBaseUpdate=u))}if(null!==a){var f=i.baseState;for(s=0,d=c=u=null,l=a;;){var h=l.lane,p=l.eventTime;if((r&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,g=l;switch(h=t,p=n,g.tag){case 1:if("function"==typeof(m=g.payload)){f=m.call(p,f,h);break e}f=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(h="function"==typeof(m=g.payload)?m.call(p,f,h):m))break e;f=o({},f,h);break e;case 2:pn=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[l]:h.push(l))}else p={eventTime:p,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===d?(c=d=p,u=f):d=d.next=p,s|=h;if(null===(l=l.next)){if(null===(l=i.shared.pending))break;l=(h=l).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===d&&(u=f),i.baseState=u,i.firstBaseUpdate=c,i.lastBaseUpdate=d,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);ra|=s,e.lanes=s,e.memoizedState=f}}function Sn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!=typeof o)throw Error(i(191,o));o.call(r)}}}var _n=(new n.Component).refs;function En(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:o({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var An={isMounted:function(e){return!!(e=e._reactInternals)&&T(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Sa(),o=_a(e),i=vn(r,o);i.payload=t,null!=n&&(i.callback=n),yn(e,i),null!==(t=Ea(e,o,r))&&bn(t,e,o)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Sa(),o=_a(e),i=vn(r,o);i.tag=1,i.payload=t,null!=n&&(i.callback=n),yn(e,i),null!==(t=Ea(e,o,r))&&bn(t,e,o)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Sa(),r=_a(e),o=vn(n,r);o.tag=2,null!=t&&(o.callback=t),yn(e,o),null!==(t=Ea(e,r,n))&&bn(t,e,r)}};function Tn(e,t,n,r,o,i,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!Jt(n,r)||!Jt(o,i))}function Pn(e,t,n){var r=!1,o=ct,i=t.contextType;return"object"==typeof i&&null!==i?i=fn(i):(o=mt(t)?ht:dt.current,i=(r=null!=(r=t.contextTypes))?pt(e,o):ct),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=An,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function Cn(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&An.enqueueReplaceState(t,t.state,null)}function Mn(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=_n,mn(e);var i=t.contextType;"object"==typeof i&&null!==i?o.context=fn(i):(i=mt(t)?ht:dt.current,o.context=pt(e,i)),o.state=e.memoizedState,"function"==typeof(i=t.getDerivedStateFromProps)&&(En(e,t,i,n),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&An.enqueueReplaceState(o,o.state,null),wn(e,n,o,r),o.state=e.memoizedState),"function"==typeof o.componentDidMount&&(e.flags|=4194308)}var Ln=[],In=0,Rn=null,kn=0,zn=[],Nn=0,On=null,jn=1,Bn="";function Dn(e,t){Ln[In++]=kn,Ln[In++]=Rn,Rn=e,kn=t}function Un(e,t,n){zn[Nn++]=jn,zn[Nn++]=Bn,zn[Nn++]=On,On=e;var r=jn;e=Bn;var o=32-wt(r)-1;r&=~(1<<o),n+=1;var i=32-wt(t)+o;if(30<i){var a=o-o%5;i=(r&(1<<a)-1).toString(32),r>>=a,o-=a,jn=1<<32-wt(t)+o|n<<o|r,Bn=i+e}else jn=1<<i|n<<o|r,Bn=e}function Fn(e){null!==e.return&&(Dn(e,1),Un(e,1,0))}function Hn(e){for(;e===Rn;)Rn=Ln[--In],Ln[In]=null,kn=Ln[--In],Ln[In]=null;for(;e===On;)On=zn[--Nn],zn[Nn]=null,Bn=zn[--Nn],zn[Nn]=null,jn=zn[--Nn],zn[Nn]=null}var Vn=null,Gn=null,qn=!1,Wn=!1,Xn=null;function Kn(e,t){var n=Ja(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Yn(e,t){switch(e.tag){case 5:return null!==(t=ze(t,e.type,e.pendingProps))&&(e.stateNode=t,Vn=e,Gn=Fe(t),!0);case 6:return null!==(t=Ne(t,e.pendingProps))&&(e.stateNode=t,Vn=e,Gn=null,!0);case 13:if(null!==(t=Oe(t))){var n=null!==On?{id:jn,overflow:Bn}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ja(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Vn=e,Gn=null,!0}return!1;default:return!1}}function Qn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function $n(e){if(qn){var t=Gn;if(t){var n=t;if(!Yn(e,t)){if(Qn(e))throw Error(i(418));t=Ue(n);var r=Vn;t&&Yn(e,t)?Kn(r,n):(e.flags=-4097&e.flags|2,qn=!1,Vn=e)}}else{if(Qn(e))throw Error(i(418));e.flags=-4097&e.flags|2,qn=!1,Vn=e}}}function Zn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Vn=e}function Jn(e){if(!$||e!==Vn)return!1;if(!qn)return Zn(e),qn=!0,!1;if(3!==e.tag&&(5!==e.tag||Ze(e.type)&&!V(e.type,e.memoizedProps))){var t=Gn;if(t){if(Qn(e)){for(e=Gn;e;)e=Ue(e);throw Error(i(418))}for(;t;)Kn(e,t),t=Ue(t)}}if(Zn(e),13===e.tag){if(!$)throw Error(i(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));Gn=Xe(e)}else Gn=Vn?Ue(e.stateNode):null;return!0}function er(){$&&(Gn=Vn=null,Wn=qn=!1)}function tr(e){null===Xn?Xn=[e]:Xn.push(e)}function nr(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var o=r,a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function(e){var t=o.refs;t===_n&&(t=o.refs={}),null===e?delete t[a]:t[a]=e})._stringRef=a,t)}if("string"!=typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function rr(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function or(e){return(0,e._init)(e._payload)}function ir(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=ts(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function d(e,t,n,r){return null===t||6!==t.tag?((t=is(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function f(e,t,n,r){var i=n.type;return i===c?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"==typeof i&&null!==i&&i.$$typeof===b&&or(i)===t.type)?((r=o(t,n.props)).ref=nr(e,t,n),r.return=e,r):((r=ns(n.type,n.key,n.props,null,e.mode,r)).ref=nr(e,t,n),r.return=e,r)}function h(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=as(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function p(e,t,n,r,i){return null===t||7!==t.tag?((t=rs(n,e.mode,r,i)).return=e,t):((t=o(t,n)).return=e,t)}function m(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=is(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case l:return(n=ns(t.type,t.key,t.props,null,e.mode,n)).ref=nr(e,null,t),n.return=e,n;case u:return(t=as(t,e.mode,n)).return=e,t;case b:return m(e,(0,t._init)(t._payload),n)}if(k(t)||_(t))return(t=rs(t,e.mode,n,null)).return=e,t;rr(e,t)}return null}function g(e,t,n,r){var o=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==o?null:d(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===o?f(e,t,n,r):null;case u:return n.key===o?h(e,t,n,r):null;case b:return g(e,t,(o=n._init)(n._payload),r)}if(k(n)||_(n))return null!==o?null:p(e,t,n,r,null);rr(e,n)}return null}function v(e,t,n,r,o){if("string"==typeof r&&""!==r||"number"==typeof r)return d(t,e=e.get(n)||null,""+r,o);if("object"==typeof r&&null!==r){switch(r.$$typeof){case l:return f(t,e=e.get(null===r.key?n:r.key)||null,r,o);case u:return h(t,e=e.get(null===r.key?n:r.key)||null,r,o);case b:return v(e,t,n,(0,r._init)(r._payload),o)}if(k(r)||_(r))return p(t,e=e.get(n)||null,r,o,null);rr(t,r)}return null}return function d(f,h,p,y){if("object"==typeof p&&null!==p&&p.type===c&&null===p.key&&(p=p.props.children),"object"==typeof p&&null!==p){switch(p.$$typeof){case l:e:{for(var x=p.key,w=h;null!==w;){if(w.key===x){if((x=p.type)===c){if(7===w.tag){n(f,w.sibling),(h=o(w,p.props.children)).return=f,f=h;break e}}else if(w.elementType===x||"object"==typeof x&&null!==x&&x.$$typeof===b&&or(x)===w.type){n(f,w.sibling),(h=o(w,p.props)).ref=nr(f,w,p),h.return=f,f=h;break e}n(f,w);break}t(f,w),w=w.sibling}p.type===c?((h=rs(p.props.children,f.mode,y,p.key)).return=f,f=h):((y=ns(p.type,p.key,p.props,null,f.mode,y)).ref=nr(f,h,p),y.return=f,f=y)}return s(f);case u:e:{for(w=p.key;null!==h;){if(h.key===w){if(4===h.tag&&h.stateNode.containerInfo===p.containerInfo&&h.stateNode.implementation===p.implementation){n(f,h.sibling),(h=o(h,p.children||[])).return=f,f=h;break e}n(f,h);break}t(f,h),h=h.sibling}(h=as(p,f.mode,y)).return=f,f=h}return s(f);case b:return d(f,h,(w=p._init)(p._payload),y)}if(k(p))return function(o,i,s,l){for(var u=null,c=null,d=i,f=i=0,h=null;null!==d&&f<s.length;f++){d.index>f?(h=d,d=null):h=d.sibling;var p=g(o,d,s[f],l);if(null===p){null===d&&(d=h);break}e&&d&&null===p.alternate&&t(o,d),i=a(p,i,f),null===c?u=p:c.sibling=p,c=p,d=h}if(f===s.length)return n(o,d),qn&&Dn(o,f),u;if(null===d){for(;f<s.length;f++)null!==(d=m(o,s[f],l))&&(i=a(d,i,f),null===c?u=d:c.sibling=d,c=d);return qn&&Dn(o,f),u}for(d=r(o,d);f<s.length;f++)null!==(h=v(d,o,f,s[f],l))&&(e&&null!==h.alternate&&d.delete(null===h.key?f:h.key),i=a(h,i,f),null===c?u=h:c.sibling=h,c=h);return e&&d.forEach(function(e){return t(o,e)}),qn&&Dn(o,f),u}(f,h,p,y);if(_(p))return function(o,s,l,u){var c=_(l);if("function"!=typeof c)throw Error(i(150));if(null==(l=c.call(l)))throw Error(i(151));for(var d=c=null,f=s,h=s=0,p=null,y=l.next();null!==f&&!y.done;h++,y=l.next()){f.index>h?(p=f,f=null):p=f.sibling;var b=g(o,f,y.value,u);if(null===b){null===f&&(f=p);break}e&&f&&null===b.alternate&&t(o,f),s=a(b,s,h),null===d?c=b:d.sibling=b,d=b,f=p}if(y.done)return n(o,f),qn&&Dn(o,h),c;if(null===f){for(;!y.done;h++,y=l.next())null!==(y=m(o,y.value,u))&&(s=a(y,s,h),null===d?c=y:d.sibling=y,d=y);return qn&&Dn(o,h),c}for(f=r(o,f);!y.done;h++,y=l.next())null!==(y=v(f,o,h,y.value,u))&&(e&&null!==y.alternate&&f.delete(null===y.key?h:y.key),s=a(y,s,h),null===d?c=y:d.sibling=y,d=y);return e&&f.forEach(function(e){return t(o,e)}),qn&&Dn(o,h),c}(f,h,p,y);rr(f,p)}return"string"==typeof p&&""!==p||"number"==typeof p?(p=""+p,null!==h&&6===h.tag?(n(f,h.sibling),(h=o(h,p)).return=f,f=h):(n(f,h),(h=is(p,f.mode,y)).return=f,f=h),s(f)):n(f,h)}}var ar=ir(!0),sr=ir(!1),lr={},ur=st(lr),cr=st(lr),dr=st(lr);function fr(e){if(e===lr)throw Error(i(174));return e}function hr(e,t){ut(dr,t),ut(cr,e),ut(ur,lr),e=N(t),lt(ur),ut(ur,e)}function pr(){lt(ur),lt(cr),lt(dr)}function mr(e){var t=fr(dr.current),n=fr(ur.current);n!==(t=O(n,e.type,t))&&(ut(cr,e),ut(ur,t))}function gr(e){cr.current===e&&(lt(ur),lt(cr))}var vr=st(0);function yr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||je(n)||Be(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var br=[];function xr(){for(var e=0;e<br.length;e++){var t=br[e];K?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}br.length=0}var wr=s.ReactCurrentDispatcher,Sr=s.ReactCurrentBatchConfig,_r=0,Er=null,Ar=null,Tr=null,Pr=!1,Cr=!1,Mr=0,Lr=0;function Ir(){throw Error(i(321))}function Rr(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Wt(e[n],t[n]))return!1;return!0}function kr(e,t,n,r,o,a){if(_r=a,Er=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,wr.current=null===e||null===e.memoizedState?go:vo,e=n(r,o),Cr){a=0;do{if(Cr=!1,Mr=0,25<=a)throw Error(i(301));a+=1,Tr=Ar=null,t.updateQueue=null,wr.current=yo,e=n(r,o)}while(Cr)}if(wr.current=mo,t=null!==Ar&&null!==Ar.next,_r=0,Tr=Ar=Er=null,Pr=!1,t)throw Error(i(300));return e}function zr(){var e=0!==Mr;return Mr=0,e}function Nr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Tr?Er.memoizedState=Tr=e:Tr=Tr.next=e,Tr}function Or(){if(null===Ar){var e=Er.alternate;e=null!==e?e.memoizedState:null}else e=Ar.next;var t=null===Tr?Er.memoizedState:Tr.next;if(null!==t)Tr=t,Ar=e;else{if(null===e)throw Error(i(310));e={memoizedState:(Ar=e).memoizedState,baseState:Ar.baseState,baseQueue:Ar.baseQueue,queue:Ar.queue,next:null},null===Tr?Er.memoizedState=Tr=e:Tr=Tr.next=e}return Tr}function jr(e,t){return"function"==typeof t?t(e):t}function Br(e){var t=Or(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=Ar,o=r.baseQueue,a=n.pending;if(null!==a){if(null!==o){var s=o.next;o.next=a.next,a.next=s}r.baseQueue=o=a,n.pending=null}if(null!==o){a=o.next,r=r.baseState;var l=s=null,u=null,c=a;do{var d=c.lane;if((_r&d)===d)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var f={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=f,s=r):u=u.next=f,Er.lanes|=d,ra|=d}c=c.next}while(null!==c&&c!==a);null===u?s=r:u.next=l,Wt(r,t.memoizedState)||(Bo=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=u,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{a=o.lane,Er.lanes|=a,ra|=a,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Dr(e){var t=Or(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,a=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{a=e(a,s.action),s=s.next}while(s!==o);Wt(a,t.memoizedState)||(Bo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Ur(){}function Fr(e,t){var n=Er,r=Or(),o=t(),a=!Wt(r.memoizedState,o);if(a&&(r.memoizedState=o,Bo=!0),r=r.queue,Zr(Gr.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==Tr&&1&Tr.memoizedState.tag){if(n.flags|=2048,Xr(9,Vr.bind(null,n,r,o,t),void 0,null),null===Qi)throw Error(i(349));0!==(30&_r)||Hr(n,t,o)}return o}function Hr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Er.updateQueue)?(t={lastEffect:null,stores:null},Er.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Vr(e,t,n,r){t.value=n,t.getSnapshot=r,qr(t)&&Ea(e,1,-1)}function Gr(e,t,n){return n(function(){qr(t)&&Ea(e,1,-1)})}function qr(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Wt(e,n)}catch{return!0}}function Wr(e){var t=Nr();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:jr,lastRenderedState:e},t.queue=e,e=e.dispatch=uo.bind(null,Er,e),[t.memoizedState,e]}function Xr(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Er.updateQueue)?(t={lastEffect:null,stores:null},Er.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Kr(){return Or().memoizedState}function Yr(e,t,n,r){var o=Nr();Er.flags|=e,o.memoizedState=Xr(1|t,n,void 0,void 0===r?null:r)}function Qr(e,t,n,r){var o=Or();r=void 0===r?null:r;var i=void 0;if(null!==Ar){var a=Ar.memoizedState;if(i=a.destroy,null!==r&&Rr(r,a.deps))return void(o.memoizedState=Xr(t,n,i,r))}Er.flags|=e,o.memoizedState=Xr(1|t,n,i,r)}function $r(e,t){return Yr(8390656,8,e,t)}function Zr(e,t){return Qr(2048,8,e,t)}function Jr(e,t){return Qr(4,2,e,t)}function eo(e,t){return Qr(4,4,e,t)}function to(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function no(e,t,n){return n=null!=n?n.concat([e]):null,Qr(4,4,to.bind(null,t,e),n)}function ro(){}function oo(e,t){var n=Or();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Rr(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function io(e,t){var n=Or();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Rr(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ao(e,t){var n=kt;kt=0!==n&&4>n?n:4,e(!0);var r=Sr.transition;Sr.transition={};try{e(!1),t()}finally{kt=n,Sr.transition=r}}function so(){return Or().memoizedState}function lo(e,t,n){var r=_a(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},co(e)?fo(t,n):(ho(e,t,n),null!==(e=Ea(e,r,n=Sa()))&&po(e,t,r))}function uo(e,t,n){var r=_a(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(co(e))fo(t,o);else{ho(e,t,o);var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=i(a,n);if(o.hasEagerState=!0,o.eagerState=s,Wt(s,a))return}catch{}null!==(e=Ea(e,r,n=Sa()))&&po(e,t,r)}}function co(e){var t=e.alternate;return e===Er||null!==t&&t===Er}function fo(e,t){Cr=Pr=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ho(e,t,n){null!==Qi&&0!==(1&e.mode)&&0===(2&Yi)?(null===(e=t.interleaved)?(n.next=n,null===hn?hn=[t]:hn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function po(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Rt(e,n)}}var mo={readContext:fn,useCallback:Ir,useContext:Ir,useEffect:Ir,useImperativeHandle:Ir,useInsertionEffect:Ir,useLayoutEffect:Ir,useMemo:Ir,useReducer:Ir,useRef:Ir,useState:Ir,useDebugValue:Ir,useDeferredValue:Ir,useTransition:Ir,useMutableSource:Ir,useSyncExternalStore:Ir,useId:Ir,unstable_isNewReconciler:!1},go={readContext:fn,useCallback:function(e,t){return Nr().memoizedState=[e,void 0===t?null:t],e},useContext:fn,useEffect:$r,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Yr(4194308,4,to.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Yr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Yr(4,2,e,t)},useMemo:function(e,t){var n=Nr();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Nr();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=lo.bind(null,Er,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Nr().memoizedState=e},useState:Wr,useDebugValue:ro,useDeferredValue:function(e){var t=Wr(e),n=t[0],r=t[1];return $r(function(){var t=Sr.transition;Sr.transition={};try{r(e)}finally{Sr.transition=t}},[e]),n},useTransition:function(){var e=Wr(!1),t=e[0];return e=ao.bind(null,e[1]),Nr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Er,o=Nr();if(qn){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Qi)throw Error(i(349));0!==(30&_r)||Hr(r,t,n)}o.memoizedState=n;var a={value:n,getSnapshot:t};return o.queue=a,$r(Gr.bind(null,r,a,e),[e]),r.flags|=2048,Xr(9,Vr.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Nr(),t=Qi.identifierPrefix;if(qn){var n=Bn;t=":"+t+"R"+(n=(jn&~(1<<32-wt(jn)-1)).toString(32)+n),0<(n=Mr++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Lr++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},vo={readContext:fn,useCallback:oo,useContext:fn,useEffect:Zr,useImperativeHandle:no,useInsertionEffect:Jr,useLayoutEffect:eo,useMemo:io,useReducer:Br,useRef:Kr,useState:function(){return Br(jr)},useDebugValue:ro,useDeferredValue:function(e){var t=Br(jr),n=t[0],r=t[1];return Zr(function(){var t=Sr.transition;Sr.transition={};try{r(e)}finally{Sr.transition=t}},[e]),n},useTransition:function(){return[Br(jr)[0],Or().memoizedState]},useMutableSource:Ur,useSyncExternalStore:Fr,useId:so,unstable_isNewReconciler:!1},yo={readContext:fn,useCallback:oo,useContext:fn,useEffect:Zr,useImperativeHandle:no,useInsertionEffect:Jr,useLayoutEffect:eo,useMemo:io,useReducer:Dr,useRef:Kr,useState:function(){return Dr(jr)},useDebugValue:ro,useDeferredValue:function(e){var t=Dr(jr),n=t[0],r=t[1];return Zr(function(){var t=Sr.transition;Sr.transition={};try{r(e)}finally{Sr.transition=t}},[e]),n},useTransition:function(){return[Dr(jr)[0],Or().memoizedState]},useMutableSource:Ur,useSyncExternalStore:Fr,useId:so,unstable_isNewReconciler:!1};function bo(e,t){try{var n="",r=t;do{n+=en(r),r=r.return}while(r);var o=n}catch(i){o="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:o}}function xo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var wo,So,_o,Eo,Ao="function"==typeof WeakMap?WeakMap:Map;function To(e,t,n){(n=vn(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){fa||(fa=!0,ha=r),xo(0,t)},n}function Po(e,t,n){(n=vn(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){xo(0,t)}}var i=e.stateNode;return null!==i&&"function"==typeof i.componentDidCatch&&(n.callback=function(){xo(0,t),"function"!=typeof r&&(null===pa?pa=new Set([this]):pa.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Co(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Ao;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Xa.bind(null,e,t,n),t.then(e,e))}function Mo(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Lo(e,t,n,r,o){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=vn(-1,1)).tag=2,yn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}function Io(e){e.flags|=4}function Ro(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(Y)wo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)U(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},So=function(){},_o=function(e,t,n,r,o){if((e=e.memoizedProps)!==r){var i=t.stateNode,a=fr(ur.current);n=H(i,n,e,r,o,a),(t.updateQueue=n)&&Io(t)}},Eo=function(e,t,n,r){n!==r&&Io(t)};else if(Q){wo=function(e,t,n,r){for(var o=t.child;null!==o;){if(5===o.tag){var i=o.stateNode;n&&r&&(i=Re(i,o.type,o.memoizedProps,o)),U(e,i)}else if(6===o.tag)i=o.stateNode,n&&r&&(i=ke(i,o.memoizedProps,o)),U(e,i);else if(4!==o.tag)if(22===o.tag&&null!==o.memoizedState)null!==(i=o.child)&&(i.return=o),wo(e,o,!0,!0);else if(null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};var ko=function(e,t,n,r){for(var o=t.child;null!==o;){if(5===o.tag){var i=o.stateNode;n&&r&&(i=Re(i,o.type,o.memoizedProps,o)),Me(e,i)}else if(6===o.tag)i=o.stateNode,n&&r&&(i=ke(i,o.memoizedProps,o)),Me(e,i);else if(4!==o.tag)if(22===o.tag&&null!==o.memoizedState)null!==(i=o.child)&&(i.return=o),ko(e,o,!0,!0);else if(null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};So=function(e,t){var n=t.stateNode;if(!Ro(e,t)){e=n.containerInfo;var r=Ce(e);ko(r,t,!1,!1),n.pendingChildren=r,Io(t),Le(e,r)}},_o=function(e,t,n,r,o){var i=e.stateNode,a=e.memoizedProps;if((e=Ro(e,t))&&a===r)t.stateNode=i;else{var s=t.stateNode,l=fr(ur.current),u=null;a!==r&&(u=H(s,n,a,r,o,l)),e&&null===u?t.stateNode=i:(i=Pe(i,u,n,a,r,t,e,s),F(i,n,r,o,l)&&Io(t),t.stateNode=i,e?Io(t):wo(i,t,!1,!1))}},Eo=function(e,t,n,r){n!==r?(e=fr(dr.current),n=fr(ur.current),t.stateNode=G(r,e,n,t),Io(t)):t.stateNode=e.stateNode}}else So=function(){},_o=function(){},Eo=function(){};function zo(e,t){if(!qn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function No(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Oo(e,t,n){var r=t.pendingProps;switch(Hn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return No(t),null;case 1:case 17:return mt(t.type)&&gt(),No(t),null;case 3:return r=t.stateNode,pr(),lt(ft),lt(dt),xr(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(null===e||null===e.child)&&(Jn(t)?Io(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Xn&&(Ma(Xn),Xn=null))),So(e,t),No(t),null;case 5:gr(t),n=fr(dr.current);var o=t.type;if(null!==e&&null!=t.stateNode)_o(e,t,o,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return No(t),null}if(e=fr(ur.current),Jn(t)){if(!$)throw Error(i(175));e=Ge(t.stateNode,t.type,t.memoizedProps,n,e,t,!Wn),t.updateQueue=e,null!==e&&Io(t)}else{var a=D(o,r,n,e,t);wo(a,t,!1,!1),t.stateNode=a,F(a,o,r,n,e)&&Io(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return No(t),null;case 6:if(e&&null!=t.stateNode)Eo(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(i(166));if(e=fr(dr.current),n=fr(ur.current),Jn(t)){if(!$)throw Error(i(176));if(e=t.stateNode,r=t.memoizedProps,(n=qe(e,r,t,!Wn))&&null!==(o=Vn))switch(a=0!==(1&o.mode),o.tag){case 3:Je(o.stateNode.containerInfo,e,r,a);break;case 5:et(o.type,o.memoizedProps,o.stateNode,e,r,a)}n&&Io(t)}else t.stateNode=G(r,e,n,t)}return No(t),null;case 13:if(lt(vr),r=t.memoizedState,qn&&null!==Gn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Gn;e;)e=Ue(e);return er(),t.flags|=98560,t}if(null!==r&&null!==r.dehydrated){if(r=Jn(t),null===e){if(!r)throw Error(i(318));if(!$)throw Error(i(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(i(317));We(e,t)}else er(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return No(t),null}return null!==Xn&&(Ma(Xn),Xn=null),0!==(128&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?Jn(t):n=null!==e.memoizedState,r&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&vr.current)?0===ta&&(ta=3):ja())),null!==t.updateQueue&&(t.flags|=4),No(t),null);case 4:return pr(),So(e,t),null===e&&J(t.stateNode.containerInfo),No(t),null;case 10:return un(t.type._context),No(t),null;case 19:if(lt(vr),null===(o=t.memoizedState))return No(t),null;if(r=0!==(128&t.flags),null===(a=o.rendering))if(r)zo(o,!1);else{if(0!==ta||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=yr(e))){for(t.flags|=128,zo(o,!1),null!==(e=a.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,r=t.child;null!==r;)o=e,(n=r).flags&=14680066,null===(a=n.alternate)?(n.childLanes=0,n.lanes=o,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,o=a.dependencies,n.dependencies=null===o?null:{lanes:o.lanes,firstContext:o.firstContext}),r=r.sibling;return ut(vr,1&vr.current|2),t.child}e=e.sibling}null!==o.tail&&Dt()>ua&&(t.flags|=128,r=!0,zo(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=yr(a))){if(t.flags|=128,r=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),zo(o,!0),null===o.tail&&"hidden"===o.tailMode&&!a.alternate&&!qn)return No(t),null}else 2*Dt()-o.renderingStartTime>ua&&1073741824!==n&&(t.flags|=128,r=!0,zo(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=o.last)?e.sibling=a:t.child=a,o.last=a)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Dt(),t.sibling=null,e=vr.current,ut(vr,r?1&e|2:1&e),t):(No(t),null);case 22:case 23:return ka(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ji)&&(No(t),Y&&6&t.subtreeFlags&&(t.flags|=8192)):No(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}var jo=s.ReactCurrentOwner,Bo=!1;function Do(e,t,n,r){t.child=null===e?sr(t,null,n,r):ar(t,e.child,n,r)}function Uo(e,t,n,r,o){n=n.render;var i=t.ref;return dn(t,o),r=kr(e,t,n,r,i,o),n=zr(),null===e||Bo?(qn&&n&&Fn(t),t.flags|=1,Do(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,ai(e,t,o))}function Fo(e,t,n,r,o){if(null===e){var i=n.type;return"function"!=typeof i||es(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ns(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ho(e,t,i,r,o))}if(i=e.child,0===(e.lanes&o)){var a=i.memoizedProps;if((n=null!==(n=n.compare)?n:Jt)(a,r)&&e.ref===t.ref)return ai(e,t,o)}return t.flags|=1,(e=ts(i,r)).ref=t.ref,e.return=t,t.child=e}function Ho(e,t,n,r,o){if(null!==e&&Jt(e.memoizedProps,r)&&e.ref===t.ref){if(Bo=!1,0===(e.lanes&o))return t.lanes=e.lanes,ai(e,t,o);0!==(131072&e.flags)&&(Bo=!0)}return qo(e,t,n,r,o)}function Vo(e,t,n){var r=t.pendingProps,o=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},ut(ea,Ji),Ji|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,ut(ea,Ji),Ji|=e,null;t.memoizedState={baseLanes:0,cachePool:null},r=null!==i?i.baseLanes:n,ut(ea,Ji),Ji|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,ut(ea,Ji),Ji|=r;return Do(e,t,o,n),t.child}function Go(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function qo(e,t,n,r,o){var i=mt(n)?ht:dt.current;return i=pt(t,i),dn(t,o),n=kr(e,t,n,r,i,o),r=zr(),null===e||Bo?(qn&&r&&Fn(t),t.flags|=1,Do(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,ai(e,t,o))}function Wo(e,t,n,r,o){if(mt(n)){var i=!0;bt(t)}else i=!1;if(dn(t,o),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Pn(t,n,r),Mn(t,n,r,o),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,u=n.contextType;"object"==typeof u&&null!==u?u=fn(u):u=pt(t,u=mt(n)?ht:dt.current);var c=n.getDerivedStateFromProps,d="function"==typeof c||"function"==typeof a.getSnapshotBeforeUpdate;d||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==r||l!==u)&&Cn(t,a,r,u),pn=!1;var f=t.memoizedState;a.state=f,wn(t,r,a,o),l=t.memoizedState,s!==r||f!==l||ft.current||pn?("function"==typeof c&&(En(t,n,c,r),l=t.memoizedState),(s=pn||Tn(t,n,s,r,f,l,u))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=u,r=s):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,gn(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:tn(t.type,s),a.props=u,d=t.pendingProps,f=a.context,"object"==typeof(l=n.contextType)&&null!==l?l=fn(l):l=pt(t,l=mt(n)?ht:dt.current);var h=n.getDerivedStateFromProps;(c="function"==typeof h||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==d||f!==l)&&Cn(t,a,r,l),pn=!1,f=t.memoizedState,a.state=f,wn(t,r,a,o);var p=t.memoizedState;s!==d||f!==p||ft.current||pn?("function"==typeof h&&(En(t,n,h,r),p=t.memoizedState),(u=pn||Tn(t,n,u,r,f,p,l)||!1)?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=u):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return Xo(e,t,n,r,i,o)}function Xo(e,t,n,r,o,i){Go(e,t);var a=0!==(128&t.flags);if(!r&&!a)return o&&xt(t,n,!1),ai(e,t,i);r=t.stateNode,jo.current=t;var s=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=ar(t,e.child,null,i),t.child=ar(t,null,s,i)):Do(e,t,s,i),t.memoizedState=r.state,o&&xt(t,n,!0),t.child}function Ko(e){var t=e.stateNode;t.pendingContext?vt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&vt(0,t.context,!1),hr(e,t.containerInfo)}function Yo(e,t,n,r,o){return er(),tr(o),t.flags|=256,Do(e,t,n,r),t.child}var Qo={dehydrated:null,treeContext:null,retryLane:0};function $o(e){return{baseLanes:e,cachePool:null}}function Zo(e,t,n){var r,o=t.pendingProps,a=vr.current,s=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(s=!0,t.flags&=-129):(null===e||null!==e.memoizedState)&&(a|=1),ut(vr,1&a),null===e)return $n(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:Be(e)?t.lanes=8:t.lanes=1073741824,null):(a=o.children,e=o.fallback,s?(o=t.mode,s=t.child,a={mode:"hidden",children:a},0===(1&o)&&null!==s?(s.childLanes=0,s.pendingProps=a):s=os(a,o,0,null),e=rs(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=$o(n),t.memoizedState=Qo,e):Jo(t,a));if(null!==(a=e.memoizedState)){if(null!==(r=a.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,ni(e,t,n,Error(i(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=o.fallback,a=t.mode,o=os({mode:"visible",children:o.children},a,0,null),(s=rs(s,a,n,null)).flags|=2,o.return=t,s.return=t,o.sibling=s,t.child=o,0!==(1&t.mode)&&ar(t,e.child,null,n),t.child.memoizedState=$o(n),t.memoizedState=Qo,s);if(0===(1&t.mode))t=ni(e,t,n,null);else if(Be(r))t=ni(e,t,n,Error(i(419)));else if(o=0!==(n&e.childLanes),Bo||o){if(null!==(o=Qi)){switch(n&-n){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(o=0!==(s&(o.suspendedLanes|n))?0:s)&&o!==a.retryLane&&(a.retryLane=o,Ea(e,o,-1))}ja(),t=ni(e,t,n,Error(i(421)))}else je(r)?(t.flags|=128,t.child=e.child,t=Ya.bind(null,e),De(r,t),t=null):(n=a.treeContext,$&&(Gn=Ve(r),Vn=t,qn=!0,Xn=null,Wn=!1,null!==n&&(zn[Nn++]=jn,zn[Nn++]=Bn,zn[Nn++]=On,jn=n.id,Bn=n.overflow,On=t)),(t=Jo(t,t.pendingProps.children)).flags|=4096);return t}return s?(o=ti(e,t,o.children,o.fallback,n),s=t.child,a=e.child.memoizedState,s.memoizedState=null===a?$o(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=Qo,o):(n=ei(e,t,o.children,n),t.memoizedState=null,n)}return s?(o=ti(e,t,o.children,o.fallback,n),s=t.child,a=e.child.memoizedState,s.memoizedState=null===a?$o(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=Qo,o):(n=ei(e,t,o.children,n),t.memoizedState=null,n)}function Jo(e,t){return(t=os({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function ei(e,t,n,r){var o=e.child;return e=o.sibling,n=ts(o,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n}function ti(e,t,n,r,o){var i=t.mode,a=(e=e.child).sibling,s={mode:"hidden",children:n};return 0===(1&i)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=s,t.deletions=null):(n=ts(e,s)).subtreeFlags=14680064&e.subtreeFlags,null!==a?r=ts(a,r):(r=rs(r,i,o,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function ni(e,t,n,r){return null!==r&&tr(r),ar(t,e.child,null,n),(e=Jo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ri(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),cn(e.return,t,n)}function oi(e,t,n,r,o){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function ii(e,t,n){var r=t.pendingProps,o=r.revealOrder,i=r.tail;if(Do(e,t,r.children,n),0!==(2&(r=vr.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ri(e,n,t);else if(19===e.tag)ri(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ut(vr,r),0===(1&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===yr(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),oi(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===yr(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}oi(t,!0,n,null,i);break;case"together":oi(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ai(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ra|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=ts(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=ts(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function si(e,t){switch(Hn(t),t.tag){case 1:return mt(t.type)&&gt(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return pr(),lt(ft),lt(dt),xr(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return gr(t),null;case 13:if(lt(vr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));er()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return lt(vr),null;case 4:return pr(),null;case 10:return un(t.type._context),null;case 22:case 23:return ka(),null;default:return null}}var li=!1,ui=!1,ci="function"==typeof WeakSet?WeakSet:Set,di=null;function fi(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(r){Wa(e,t,r)}else n.current=null}function hi(e,t,n){try{n()}catch(r){Wa(e,t,r)}}var pi=!1;function mi(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,void 0!==i&&hi(t,n,i)}o=o.next}while(o!==r)}}function gi(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function vi(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=z(n);else e=n;"function"==typeof t?t(e):t.current=e}}function yi(e,t,n){if(qt&&"function"==typeof qt.onCommitFiberUnmount)try{qt.onCommitFiberUnmount(Gt,t)}catch{}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var o=r,i=o.destroy;o=o.tag,void 0!==i&&(0!==(2&o)||0!==(4&o))&&hi(t,n,i),r=r.next}while(r!==e)}break;case 1:if(fi(t,n),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(a){Wa(t,n,a)}break;case 5:fi(t,n);break;case 4:Y?Ti(e,t,n):Q&&Q&&(t=t.stateNode.containerInfo,n=Ce(t),Ie(t,n))}}function bi(e,t,n){for(var r=t;;)if(yi(e,r,n),null===r.child||Y&&4===r.tag){if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function xi(e){var t=e.alternate;null!==t&&(e.alternate=null,xi(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&te(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function wi(e){return 5===e.tag||3===e.tag||4===e.tag}function Si(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||wi(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags||null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function _i(e){if(Y){e:{for(var t=e.return;null!==t;){if(wi(t))break e;t=t.return}throw Error(i(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(we(t),n.flags&=-33),Ai(e,n=Si(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,Ei(e,n=Si(e),t);break;default:throw Error(i(161))}}}function Ei(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ye(n,e,t):he(n,e);else if(4!==r&&null!==(e=e.child))for(Ei(e,t,n),e=e.sibling;null!==e;)Ei(e,t,n),e=e.sibling}function Ai(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ve(n,e,t):fe(n,e);else if(4!==r&&null!==(e=e.child))for(Ai(e,t,n),e=e.sibling;null!==e;)Ai(e,t,n),e=e.sibling}function Ti(e,t,n){for(var r,o,a=t,s=!1;;){if(!s){s=a.return;e:for(;;){if(null===s)throw Error(i(160));switch(r=s.stateNode,s.tag){case 5:o=!1;break e;case 3:case 4:r=r.containerInfo,o=!0;break e}s=s.return}s=!0}if(5===a.tag||6===a.tag)bi(e,a,n),o?xe(r,a.stateNode):be(r,a.stateNode);else if(18===a.tag)o?$e(r,a.stateNode):Qe(r,a.stateNode);else if(4===a.tag){if(null!==a.child){r=a.stateNode.containerInfo,o=!0,a.child.return=a,a=a.child;continue}}else if(yi(e,a,n),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(s=!1)}a.sibling.return=a.return,a=a.sibling}}function Pi(e,t){if(Y){switch(t.tag){case 0:case 11:case 14:case 15:return mi(3,t,t.return),gi(3,t),void mi(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var o=t.type,a=t.updateQueue;t.updateQueue=null,null!==a&&ge(n,a,o,e,r,t)}return;case 6:if(null===t.stateNode)throw Error(i(162));return n=t.memoizedProps,void pe(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void($&&null!==e&&e.memoizedState.isDehydrated&&Ke(t.stateNode.containerInfo));case 13:case 19:return void Ci(t)}throw Error(i(163))}switch(t.tag){case 0:case 11:case 14:case 15:return mi(3,t,t.return),gi(3,t),void mi(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void Ci(t);case 3:$&&null!==e&&e.memoizedState.isDehydrated&&Ke(t.stateNode.containerInfo)}e:if(Q){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Ie(t.containerInfo,t.pendingChildren);break e}throw Error(i(163))}}function Ci(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ci),t.forEach(function(t){var r=Qa.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function Mi(e,t,n){di=e,Li(e)}function Li(e,t,n){for(var r=0!==(1&e.mode);null!==di;){var o=di,i=o.child;if(22===o.tag&&r){var a=null!==o.memoizedState||li;if(!a){var s=o.alternate,l=null!==s&&null!==s.memoizedState||ui;s=li;var u=ui;if(li=a,(ui=l)&&!u)for(di=o;null!==di;)l=(a=di).child,22===a.tag&&null!==a.memoizedState?ki(o):null!==l?(l.return=a,di=l):ki(o);for(;null!==i;)di=i,Li(i),i=i.sibling;di=o,li=s,ui=u}Ii(e)}else 0!==(8772&o.subtreeFlags)&&null!==i?(i.return=o,di=i):Ii(e)}}function Ii(e){for(;null!==di;){var t=di;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:ui||gi(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!ui)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:tn(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Sn(t,a,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=z(t.child.stateNode);break;case 1:n=t.child.stateNode}Sn(t,s,n)}break;case 5:var l=t.stateNode;null===n&&4&t.flags&&me(l,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if($&&null===t.memoizedState){var u=t.alternate;if(null!==u){var c=u.memoizedState;if(null!==c){var d=c.dehydrated;null!==d&&Ye(d)}}}break;default:throw Error(i(163))}ui||512&t.flags&&vi(t)}catch(f){Wa(t,t.return,f)}}if(t===e){di=null;break}if(null!==(n=t.sibling)){n.return=t.return,di=n;break}di=t.return}}function Ri(e){for(;null!==di;){var t=di;if(t===e){di=null;break}var n=t.sibling;if(null!==n){n.return=t.return,di=n;break}di=t.return}}function ki(e){for(;null!==di;){var t=di;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{gi(4,t)}catch(l){Wa(t,n,l)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(l){Wa(t,o,l)}}var i=t.return;try{vi(t)}catch(l){Wa(t,i,l)}break;case 5:var a=t.return;try{vi(t)}catch(l){Wa(t,a,l)}}}catch(l){Wa(t,t.return,l)}if(t===e){di=null;break}var s=t.sibling;if(null!==s){s.return=t.return,di=s;break}di=t.return}}var zi=0,Ni=1,Oi=2,ji=3,Bi=4;if("function"==typeof Symbol&&Symbol.for){var Di=Symbol.for;zi=Di("selector.component"),Ni=Di("selector.has_pseudo_class"),Oi=Di("selector.role"),ji=Di("selector.test_id"),Bi=Di("selector.text")}function Ui(e){var t=Z(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw Error(i(364));return t}if(null===(e=ie(e)))throw Error(i(362));return e.stateNode.current}function Fi(e,t){switch(t.$$typeof){case zi:if(e.type===t.value)return!0;break;case Ni:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var r=e[n++],o=e[n++],a=t[o];if(5!==r.tag||!le(r)){for(;null!=a&&Fi(r,a);)a=t[++o];if(o===t.length){t=!0;break e}for(r=r.child;null!==r;)e.push(r,o),r=r.sibling}}t=!1}return t;case Oi:if(5===e.tag&&ue(e.stateNode,t.value))return!0;break;case Bi:if((5===e.tag||6===e.tag)&&(null!==(e=se(e))&&0<=e.indexOf(t.value)))return!0;break;case ji:if(5===e.tag&&("string"==typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function Hi(e){switch(e.$$typeof){case zi:return"<"+(E(e.value)||"Unknown")+">";case Ni:return":has("+(Hi(e)||"")+")";case Oi:return'[role="'+e.value+'"]';case Bi:return'"'+e.value+'"';case ji:return'[data-testname="'+e.value+'"]';default:throw Error(i(365))}}function Vi(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var o=e[r++],i=e[r++],a=t[i];if(5!==o.tag||!le(o)){for(;null!=a&&Fi(o,a);)a=t[++i];if(i===t.length)n.push(o);else for(o=o.child;null!==o;)e.push(o,i),o=o.sibling}}return n}function Gi(e,t){if(!oe)throw Error(i(363));e=Vi(e=Ui(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var r=e[n++];if(5===r.tag)le(r)||t.push(r.stateNode);else for(r=r.child;null!==r;)e.push(r),r=r.sibling}return t}var qi=Math.ceil,Wi=s.ReactCurrentDispatcher,Xi=s.ReactCurrentOwner,Ki=s.ReactCurrentBatchConfig,Yi=0,Qi=null,$i=null,Zi=0,Ji=0,ea=st(0),ta=0,na=null,ra=0,oa=0,ia=0,aa=null,sa=null,la=0,ua=1/0;function ca(){ua=Dt()+500}var da,fa=!1,ha=null,pa=null,ma=!1,ga=null,va=0,ya=0,ba=null,xa=-1,wa=0;function Sa(){return 0!==(6&Yi)?Dt():-1!==xa?xa:xa=Dt()}function _a(e){return 0===(1&e.mode)?1:0!==(2&Yi)&&0!==Zi?Zi&-Zi:null!==Zt.transition?(0===wa&&(e=Et,0===(4194240&(Et<<=1))&&(Et=64),wa=e),wa):0!==(e=kt)?e:ee()}function Ea(e,t,n){if(50<ya)throw ya=0,ba=null,Error(i(185));var r=Aa(e,t);return null===r?null:(It(r,t,n),(0===(2&Yi)||r!==Qi)&&(r===Qi&&(0===(2&Yi)&&(oa|=t),4===ta&&La(r,Zi)),Ta(r,n),1===t&&0===Yi&&0===(1&e.mode)&&(ca(),Kt&&$t())),r)}function Aa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Ta(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-wt(i),s=1<<a,l=o[a];-1===l?(0===(s&n)||0!==(s&r))&&(o[a]=Ct(s,t)):l<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=Pt(e,e===Qi?Zi:0);if(0===r)null!==n&&Ot(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ot(n),1===t)0===e.tag?function(e){Kt=!0,Qt(e)}(Ia.bind(null,e)):Qt(Ia.bind(null,e)),ne?re(function(){0===Yi&&$t()}):Nt(Ut,$t),n=null;else{switch(zt(r)){case 1:n=Ut;break;case 4:n=Ft;break;case 16:default:n=Ht;break;case 536870912:n=Vt}n=$a(n,Pa.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Pa(e,t){if(xa=-1,wa=0,0!==(6&Yi))throw Error(i(327));var n=e.callbackNode;if(Ga()&&e.callbackNode!==n)return null;var r=Pt(e,e===Qi?Zi:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=Ba(e,r);else{t=r;var o=Yi;Yi|=2;var a=Oa();for((Qi!==e||Zi!==t)&&(ca(),za(e,t));;)try{Ua();break}catch(l){Na(e,l)}sn(),Wi.current=a,Yi=o,null!==$i?t=0:(Qi=null,Zi=0,t=ta)}if(0!==t){if(2===t&&(0!==(o=Mt(e))&&(r=o,t=Ca(e,o))),1===t)throw n=na,za(e,0),La(e,r),Ta(e,Dt()),n;if(6===t)La(e,r);else{if(o=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!Wt(i(),o))return!1}catch{return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)&&(2===(t=Ba(e,r))&&(0!==(a=Mt(e))&&(r=a,t=Ca(e,a))),1===t))throw n=na,za(e,0),La(e,r),Ta(e,Dt()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:Va(e,sa);break;case 3:if(La(e,r),(130023424&r)===r&&10<(t=la+500-Dt())){if(0!==Pt(e,0))break;if(((o=e.suspendedLanes)&r)!==r){Sa(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=q(Va.bind(null,e,sa),t);break}Va(e,sa);break;case 4:if(La(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var s=31-wt(r);a=1<<s,(s=t[s])>o&&(o=s),r&=~a}if(r=o,10<(r=(120>(r=Dt()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*qi(r/1960))-r)){e.timeoutHandle=q(Va.bind(null,e,sa),r);break}Va(e,sa);break;default:throw Error(i(329))}}}return Ta(e,Dt()),e.callbackNode===n?Pa.bind(null,e):null}function Ca(e,t){var n=aa;return e.current.memoizedState.isDehydrated&&(za(e,t).flags|=256),2!==(e=Ba(e,t))&&(t=sa,sa=n,null!==t&&Ma(t)),e}function Ma(e){null===sa?sa=e:sa.push.apply(sa,e)}function La(e,t){for(t&=~ia,t&=~oa,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-wt(t),r=1<<n;e[n]=-1,t&=~r}}function Ia(e){if(0!==(6&Yi))throw Error(i(327));Ga();var t=Pt(e,0);if(0===(1&t))return Ta(e,Dt()),null;var n=Ba(e,t);if(0!==e.tag&&2===n){var r=Mt(e);0!==r&&(t=r,n=Ca(e,r))}if(1===n)throw n=na,za(e,0),La(e,t),Ta(e,Dt()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Va(e,sa),Ta(e,Dt()),null}function Ra(e){null!==ga&&0===ga.tag&&0===(6&Yi)&&Ga();var t=Yi;Yi|=1;var n=Ki.transition,r=kt;try{if(Ki.transition=null,kt=1,e)return e()}finally{kt=r,Ki.transition=n,0===(6&(Yi=t))&&$t()}}function ka(){Ji=ea.current,lt(ea)}function za(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==X&&(e.timeoutHandle=X,W(n)),null!==$i)for(n=$i.return;null!==n;){var r=n;switch(Hn(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&gt();break;case 3:pr(),lt(ft),lt(dt),xr();break;case 5:gr(r);break;case 4:pr();break;case 13:case 19:lt(vr);break;case 10:un(r.type._context);break;case 22:case 23:ka()}n=n.return}if(Qi=e,$i=e=ts(e.current,null),Zi=Ji=t,ta=0,na=null,ia=oa=ra=0,sa=aa=null,null!==hn){for(t=0;t<hn.length;t++)if(null!==(r=(n=hn[t]).interleaved)){n.interleaved=null;var o=r.next,i=n.pending;if(null!==i){var a=i.next;i.next=o,r.next=a}n.pending=r}hn=null}return e}function Na(e,t){for(;;){var n=$i;try{if(sn(),wr.current=mo,Pr){for(var r=Er.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}Pr=!1}if(_r=0,Tr=Ar=Er=null,Cr=!1,Mr=0,Xi.current=null,null===n||null===n.return){ta=1,na=t,$i=null;break}e:{var a=e,s=n.return,l=n,u=t;if(t=Zi,l.flags|=32768,null!==u&&"object"==typeof u&&"function"==typeof u.then){var c=u,d=l,f=d.tag;if(0===(1&d.mode)&&(0===f||11===f||15===f)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=Mo(s);if(null!==p){p.flags&=-257,Lo(p,s,l,0,t),1&p.mode&&Co(a,c,t),u=c;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(u),t.updateQueue=g}else m.add(u);break e}if(0===(1&t)){Co(a,c,t),ja();break e}u=Error(i(426))}else if(qn&&1&l.mode){var v=Mo(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),Lo(v,s,l,0,t),tr(u);break e}}a=u,4!==ta&&(ta=2),null===aa?aa=[a]:aa.push(a),u=bo(u,l),l=s;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,xn(l,To(0,u,t));break e;case 1:a=u;var y=l.type,b=l.stateNode;if(0===(128&l.flags)&&("function"==typeof y.getDerivedStateFromError||null!==b&&"function"==typeof b.componentDidCatch&&(null===pa||!pa.has(b)))){l.flags|=65536,t&=-t,l.lanes|=t,xn(l,Po(l,a,t));break e}}l=l.return}while(null!==l)}Ha(n)}catch(x){t=x,$i===n&&null!==n&&($i=n=n.return);continue}break}}function Oa(){var e=Wi.current;return Wi.current=mo,null===e?mo:e}function ja(){(0===ta||3===ta||2===ta)&&(ta=4),null===Qi||0===(268435455&ra)&&0===(268435455&oa)||La(Qi,Zi)}function Ba(e,t){var n=Yi;Yi|=2;var r=Oa();for(Qi===e&&Zi===t||za(e,t);;)try{Da();break}catch(o){Na(e,o)}if(sn(),Yi=n,Wi.current=r,null!==$i)throw Error(i(261));return Qi=null,Zi=0,ta}function Da(){for(;null!==$i;)Fa($i)}function Ua(){for(;null!==$i&&!jt();)Fa($i)}function Fa(e){var t=da(e.alternate,e,Ji);e.memoizedProps=e.pendingProps,null===t?Ha(e):$i=t,Xi.current=null}function Ha(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Oo(n,t,Ji)))return void($i=n)}else{if(null!==(n=si(n,t)))return n.flags&=32767,void($i=n);if(null===e)return ta=6,void($i=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void($i=t);$i=t=e}while(null!==t);0===ta&&(ta=5)}function Va(e,t){var n=kt,r=Ki.transition;try{Ki.transition=null,kt=1,function(e,t,n){do{Ga()}while(null!==ga);if(0!==(6&Yi))throw Error(i(327));var r=e.finishedWork,o=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=r.lanes|r.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-wt(n),i=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~i}}(e,a),e===Qi&&($i=Qi=null,Zi=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||ma||(ma=!0,$a(Ht,function(){return Ga(),null})),a=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||a){a=Ki.transition,Ki.transition=null;var s=kt;kt=1;var l=Yi;Yi|=4,Xi.current=null,function(e,t){for(j(e.containerInfo),di=t;null!==di;)if(t=(e=di).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,di=t;else for(;null!==di;){e=di;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var r=n.memoizedProps,o=n.memoizedState,a=e.stateNode,s=a.getSnapshotBeforeUpdate(e.elementType===e.type?r:tn(e.type,r),o);a.__reactInternalSnapshotBeforeUpdate=s}break;case 3:Y&&Te(e.stateNode.containerInfo);break;default:throw Error(i(163))}}catch(l){Wa(e,e.return,l)}if(null!==(t=e.sibling)){t.return=e.return,di=t;break}di=e.return}n=pi,pi=!1}(e,r),function(e,t){for(di=t;null!==di;){var n=(t=di).deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e;Y?Ti(i,o,t):bi(i,o,t);var a=o.alternate;null!==a&&(a.return=null),o.return=null}catch(w){Wa(o,t,w)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,di=n;else for(;null!==di;){t=di;try{var s=t.flags;if(32&s&&Y&&we(t.stateNode),512&s){var l=t.alternate;if(null!==l){var u=l.ref;null!==u&&("function"==typeof u?u(null):u.current=null)}}if(8192&s)switch(t.tag){case 13:if(null!==t.memoizedState){var c=t.alternate;(null===c||null===c.memoizedState)&&(la=Dt())}break;case 22:var d=null!==t.memoizedState,f=t.alternate,h=null!==f&&null!==f.memoizedState;if(n=t,Y)e:if(r=n,o=d,i=null,Y)for(var p=r;;){if(5===p.tag){if(null===i){i=p;var m=p.stateNode;o?Se(m):Ee(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===i){var g=p.stateNode;o?_e(g):Ae(g,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===r)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===r)break;for(;null===p.sibling;){if(null===p.return||p.return===r)break e;i===p&&(i=null),p=p.return}i===p&&(i=null),p.sibling.return=p.return,p=p.sibling}if(d&&!h&&0!==(1&n.mode)){di=n;for(var v=n.child;null!==v;){for(n=di=v;null!==di;){var y=(r=di).child;switch(r.tag){case 0:case 11:case 14:case 15:mi(4,r,r.return);break;case 1:fi(r,r.return);var b=r.stateNode;if("function"==typeof b.componentWillUnmount){var x=r.return;try{b.props=r.memoizedProps,b.state=r.memoizedState,b.componentWillUnmount()}catch(w){Wa(r,x,w)}}break;case 5:fi(r,r.return);break;case 22:if(null!==r.memoizedState){Ri(n);continue}}null!==y?(y.return=r,di=y):Ri(n)}v=v.sibling}}}switch(4102&s){case 2:_i(t),t.flags&=-3;break;case 6:_i(t),t.flags&=-3,Pi(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Pi(t.alternate,t);break;case 4:Pi(t.alternate,t)}}catch(w){Wa(t,t.return,w)}if(null!==(n=t.sibling)){n.return=t.return,di=n;break}di=t.return}}}(e,r),B(e.containerInfo),e.current=r,Mi(r),Bt(),Yi=l,kt=s,Ki.transition=a}else e.current=r;if(ma&&(ma=!1,ga=e,va=o),a=e.pendingLanes,0===a&&(pa=null),function(e){if(qt&&"function"==typeof qt.onCommitFiberRoot)try{qt.onCommitFiberRoot(Gt,e,void 0,128===(128&e.current.flags))}catch{}}(r.stateNode),Ta(e,Dt()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)n(t[r]);if(fa)throw fa=!1,e=ha,ha=null,e;0!==(1&va)&&0!==e.tag&&Ga(),a=e.pendingLanes,0!==(1&a)?e===ba?ya++:(ya=0,ba=e):ya=0,$t()}(e,t,n)}finally{Ki.transition=r,kt=n}return null}function Ga(){if(null!==ga){var e=zt(va),t=Ki.transition,n=kt;try{if(Ki.transition=null,kt=16>e?16:e,null===ga)var r=!1;else{if(e=ga,ga=null,va=0,0!==(6&Yi))throw Error(i(331));var o=Yi;for(Yi|=4,di=e.current;null!==di;){var a=di,s=a.child;if(0!==(16&di.flags)){var l=a.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for(di=c;null!==di;){var d=di;switch(d.tag){case 0:case 11:case 15:mi(8,d,a)}var f=d.child;if(null!==f)f.return=d,di=f;else for(;null!==di;){var h=(d=di).sibling,p=d.return;if(xi(d),d===c){di=null;break}if(null!==h){h.return=p,di=h;break}di=p}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}di=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,di=s;else e:for(;null!==di;){if(0!==(2048&(a=di).flags))switch(a.tag){case 0:case 11:case 15:mi(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,di=y;break e}di=a.return}}var b=e.current;for(di=b;null!==di;){var x=(s=di).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,di=x;else e:for(s=b;null!==di;){if(0!==(2048&(l=di).flags))try{switch(l.tag){case 0:case 11:case 15:gi(9,l)}}catch(S){Wa(l,l.return,S)}if(l===s){di=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,di=w;break e}di=l.return}}if(Yi=o,$t(),qt&&"function"==typeof qt.onPostCommitFiberRoot)try{qt.onPostCommitFiberRoot(Gt,e)}catch{}r=!0}return r}finally{kt=n,Ki.transition=t}}return!1}function qa(e,t,n){yn(e,t=To(0,t=bo(n,t),1)),t=Sa(),null!==(e=Aa(e,1))&&(It(e,1,t),Ta(e,t))}function Wa(e,t,n){if(3===e.tag)qa(e,e,n);else for(;null!==t;){if(3===t.tag){qa(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===pa||!pa.has(r))){yn(t,e=Po(t,e=bo(n,e),1)),e=Sa(),null!==(t=Aa(t,1))&&(It(t,1,e),Ta(t,e));break}}t=t.return}}function Xa(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Sa(),e.pingedLanes|=e.suspendedLanes&n,Qi===e&&(Zi&n)===n&&(4===ta||3===ta&&(130023424&Zi)===Zi&&500>Dt()-la?za(e,0):ia|=n),Ta(e,t)}function Ka(e,t){0===t&&(0===(1&e.mode)?t=1:(t=At,0===(130023424&(At<<=1))&&(At=4194304)));var n=Sa();null!==(e=Aa(e,t))&&(It(e,t,n),Ta(e,n))}function Ya(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ka(e,n)}function Qa(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Ka(e,n)}function $a(e,t){return Nt(e,t)}function Za(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ja(e,t,n,r){return new Za(e,t,n,r)}function es(e){return!(!(e=e.prototype)||!e.isReactComponent)}function ts(e,t){var n=e.alternate;return null===n?((n=Ja(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ns(e,t,n,r,o,a){var s=2;if(r=e,"function"==typeof e)es(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case c:return rs(n.children,o,a,t);case d:s=8,o|=8;break;case f:return(e=Ja(12,n,t,2|o)).elementType=f,e.lanes=a,e;case g:return(e=Ja(13,n,t,o)).elementType=g,e.lanes=a,e;case v:return(e=Ja(19,n,t,o)).elementType=v,e.lanes=a,e;case x:return os(n,o,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case h:s=10;break e;case p:s=9;break e;case m:s=11;break e;case y:s=14;break e;case b:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Ja(s,n,t,o)).elementType=e,t.type=r,t.lanes=a,t}function rs(e,t,n,r){return(e=Ja(7,e,r,t)).lanes=n,e}function os(e,t,n,r){return(e=Ja(22,e,r,t)).elementType=x,e.lanes=n,e.stateNode={},e}function is(e,t,n){return(e=Ja(6,e,null,t)).lanes=n,e}function as(e,t,n){return(t=Ja(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ss(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=X,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Lt(0),this.expirationTimes=Lt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Lt(0),this.identifierPrefix=r,this.onRecoverableError=o,$&&(this.mutableSourceEagerHydrationData=null)}function ls(e,t,n,r,o,i,a,s,l){return e=new ss(e,t,n,s,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Ja(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null},mn(i),e}function us(e){if(!e)return ct;e:{if(T(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(mt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(mt(n))return yt(e,n,t)}return t}function cs(e){var t=e._reactInternals;if(void 0===t)throw"function"==typeof e.render?Error(i(188)):(e=Object.keys(e).join(","),Error(i(268,e)));return null===(e=M(t))?null:e.stateNode}function ds(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function fs(e,t){ds(e,t),(e=e.alternate)&&ds(e,t)}function hs(e){return null===(e=M(e))?null:e.stateNode}function ps(){return null}return da=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ft.current)Bo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Bo=!1,function(e,t,n){switch(t.tag){case 3:Ko(t),er();break;case 5:mr(t);break;case 1:mt(t.type)&&bt(t);break;case 4:hr(t,t.stateNode.containerInfo);break;case 10:ln(0,t.type._context,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(ut(vr,1&vr.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Zo(e,t,n):(ut(vr,1&vr.current),null!==(e=ai(e,t,n))?e.sibling:null);ut(vr,1&vr.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return ii(e,t,n);t.flags|=128}var o=t.memoizedState;if(null!==o&&(o.rendering=null,o.tail=null,o.lastEffect=null),ut(vr,vr.current),r)break;return null;case 22:case 23:return t.lanes=0,Vo(e,t,n)}return ai(e,t,n)}(e,t,n);Bo=0!==(131072&e.flags)}else Bo=!1,qn&&0!==(1048576&t.flags)&&Un(t,kn,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var o=pt(t,dt.current);dn(t,n),o=kr(null,t,r,e,o,n);var a=zr();return t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,mt(r)?(a=!0,bt(t)):a=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,mn(t),o.updater=An,t.stateNode=o,o._reactInternals=t,Mn(t,r,e,n),t=Xo(null,t,r,!0,a,n)):(t.tag=0,qn&&a&&Fn(t),Do(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"==typeof e)return es(e)?1:0;if(null!=e){if((e=e.$$typeof)===m)return 11;if(e===y)return 14}return 2}(r),e=tn(r,e),o){case 0:t=qo(null,t,r,e,n);break e;case 1:t=Wo(null,t,r,e,n);break e;case 11:t=Uo(null,t,r,e,n);break e;case 14:t=Fo(null,t,r,tn(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,qo(e,t,r,o=t.elementType===r?o:tn(r,o),n);case 1:return r=t.type,o=t.pendingProps,Wo(e,t,r,o=t.elementType===r?o:tn(r,o),n);case 3:e:{if(Ko(t),null===e)throw Error(i(387));r=t.pendingProps,o=(a=t.memoizedState).element,gn(e,t),wn(t,r,null,n);var s=t.memoizedState;if(r=s.element,$&&a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Yo(e,t,r,n,o=Error(i(423)));break e}if(r!==o){t=Yo(e,t,r,n,o=Error(i(424)));break e}for($&&(Gn=He(t.stateNode.containerInfo),Vn=t,qn=!0,Xn=null,Wn=!1),n=sr(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(er(),r===o){t=ai(e,t,n);break e}Do(e,t,r,n)}t=t.child}return t;case 5:return mr(t),null===e&&$n(t),r=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,s=o.children,V(r,o)?s=null:null!==a&&V(r,a)&&(t.flags|=32),Go(e,t),Do(e,t,s,n),t.child;case 6:return null===e&&$n(t),null;case 13:return Zo(e,t,n);case 4:return hr(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ar(t,null,r,n):Do(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,Uo(e,t,r,o=t.elementType===r?o:tn(r,o),n);case 7:return Do(e,t,t.pendingProps,n),t.child;case 8:case 12:return Do(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,a=t.memoizedProps,ln(0,r,s=o.value),null!==a)if(Wt(a.value,s)){if(a.children===o.children&&!ft.current){t=ai(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){s=a.child;for(var u=l.firstContext;null!==u;){if(u.context===r){if(1===a.tag){(u=vn(-1,n&-n)).tag=2;var c=a.updateQueue;if(null!==c){var d=(c=c.shared).pending;null===d?u.next=u:(u.next=d.next,d.next=u),c.pending=u}}a.lanes|=n,null!==(u=a.alternate)&&(u.lanes|=n),cn(a.return,n,t),l.lanes|=n;break}u=u.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(i(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),cn(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}Do(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,dn(t,n),r=r(o=fn(o)),t.flags|=1,Do(e,t,r,n),t.child;case 14:return o=tn(r=t.type,t.pendingProps),Fo(e,t,r,o=tn(r.type,o),n);case 15:return Ho(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:tn(r,o),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,mt(r)?(e=!0,bt(t)):e=!1,dn(t,n),Pn(t,r,o),Mn(t,r,o,n),Xo(null,t,r,!0,e,n);case 19:return ii(e,t,n);case 22:return Vo(e,t,n)}throw Error(i(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(Ea(e,134217728,Sa()),fs(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=Sa(),n=_a(e);Ea(e,n,t),fs(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Tt(t.pendingLanes);0!==n&&(Rt(t,1|n),Ta(t,Dt()),0===(6&Yi)&&(ca(),$t()))}break;case 13:var r=Sa();Ra(function(){return Ea(e,1,r)}),fs(e,1)}},t.batchedUpdates=function(e,t){var n=Yi;Yi|=1;try{return e(t)}finally{0===(Yi=n)&&(ca(),Kt&&$t())}},t.createComponentSelector=function(e){return{$$typeof:zi,value:e}},t.createContainer=function(e,t,n,r,o,i,a){return ls(e,t,!1,null,0,r,0,i,a)},t.createHasPseudoClassSelector=function(e){return{$$typeof:Ni,value:e}},t.createHydrationContainer=function(e,t,n,r,o,i,a,s,l){return(e=ls(n,r,!0,e,0,i,0,s,l)).context=us(null),n=e.current,(i=vn(r=Sa(),o=_a(n))).callback=t??null,yn(n,i),e.current.lanes=o,It(e,o,r),Ta(e,r),e},t.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:u,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Oi,value:e}},t.createTestNameSelector=function(e){return{$$typeof:ji,value:e}},t.createTextSelector=function(e){return{$$typeof:Bi,value:e}},t.deferredUpdates=function(e){var t=kt,n=Ki.transition;try{return Ki.transition=null,kt=16,e()}finally{kt=t,Ki.transition=n}},t.discreteUpdates=function(e,t,n,r,o){var i=kt,a=Ki.transition;try{return Ki.transition=null,kt=1,e(t,n,r,o)}finally{kt=i,Ki.transition=a,0===Yi&&ca()}},t.findAllNodes=Gi,t.findBoundingRects=function(e,t){if(!oe)throw Error(i(363));t=Gi(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ae(t[n]));for(t=e.length-1;0<t;t--)for(var r=(n=e[t]).x,o=r+n.width,a=n.y,s=a+n.height,l=t-1;0<=l;l--)if(t!==l){var u=e[l],c=u.x,d=c+u.width,f=u.y,h=f+u.height;if(r>=c&&a>=f&&o<=d&&s<=h){e.splice(t,1);break}if(!(r!==c||n.width!==u.width||h<a||f>s)){f>a&&(u.height+=f-a,u.y=a),h<s&&(u.height=s-f),e.splice(t,1);break}if(!(a!==f||n.height!==u.height||d<r||c>o)){c>r&&(u.width+=c-r,u.x=r),d<o&&(u.width=o-c),e.splice(t,1);break}}return e},t.findHostInstance=cs,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=C(e))?I(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return cs(e)},t.flushControlled=function(e){var t=Yi;Yi|=1;var n=Ki.transition,r=kt;try{Ki.transition=null,kt=1,e()}finally{kt=r,Ki.transition=n,0===(Yi=t)&&(ca(),$t())}},t.flushPassiveEffects=Ga,t.flushSync=Ra,t.focusWithin=function(e,t){if(!oe)throw Error(i(363));for(t=Vi(e=Ui(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!le(n)){if(5===n.tag&&ce(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return kt},t.getFindAllNodesFailureDescription=function(e,t){if(!oe)throw Error(i(363));var n=0,r=[];e=[Ui(e),0];for(var o=0;o<e.length;){var a=e[o++],s=e[o++],l=t[s];if((5!==a.tag||!le(a))&&(Fi(a,l)&&(r.push(Hi(l)),++s>n&&(n=s)),s<t.length))for(a=a.child;null!==a;)e.push(a,s),a=a.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(Hi(t[n]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?z(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:hs,findFiberByHostInstance:e.findFiberByHostInstance||ps,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Gt=t.inject(e),qt=t}catch{}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,r){if(!oe)throw Error(i(363));e=Gi(e,t);var o=de(e,n,r).disconnect;return{disconnect:function(){o()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=kt;try{return kt=e,t()}finally{kt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,r){var o=t.current,i=Sa(),a=_a(o);return n=us(n),null===t.context?t.context=n:t.pendingContext=n,(t=vn(i,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),yn(o,t),null!==(e=Ea(o,a,i))&&bn(e,o,a),a},t}),m}var _=(v||(v=1,y.exports=S()),y.exports);const E=(0,i.g)(_);var A=w();const T=e=>"object"==typeof e&&"function"==typeof e.then,P=[];function C(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>e===t;if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let o=0;o<r;o++)if(!n(e[o],t[o]))return!1;return!0}const M=(e,t,n)=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===t&&(t=[e]);for(const i of P)if(C(t,i.keys,i.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(i,"error"))throw i.error;if(Object.prototype.hasOwnProperty.call(i,"response"))return r.lifespan&&r.lifespan>0&&(i.timeout&&clearTimeout(i.timeout),i.timeout=setTimeout(i.remove,r.lifespan)),i.response;if(!n)throw i.promise}const o={keys:t,equal:r.equal,remove:()=>{const e=P.indexOf(o);-1!==e&&P.splice(e,1)},promise:(T(e)?e:e(...t)).then(e=>{o.response=e,r.lifespan&&r.lifespan>0&&(o.timeout=setTimeout(o.remove,r.lifespan))}).catch(e=>o.error=e)};if(P.push(o),!n)throw o.promise}(e,t,!1,n),L={},I=e=>{Object.assign(L,e)};var R,k;const z=e=>"colorSpace"in e||"outputColorSpace"in e,N=()=>{var e;return null!=(e=L.ColorManagement)?e:null},O=e=>e&&e.isOrthographicCamera,j=typeof window<"u"&&(null!=(R=window.document)&&R.createElement||"ReactNative"===(null==(k=window.navigator)?void 0:k.product))?a.useLayoutEffect:a.useEffect;function B(e){const t=a.useRef(e);return j(()=>{t.current=e},[e]),t}function D(e){let{set:t}=e;return j(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class U extends a.Component{constructor(){super(...arguments),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}U.getDerivedStateFromError=()=>({error:!0});const F="__default",H=new Map,V=e=>e&&!!e.memoized&&!!e.changes;function G(e){var t;const n=typeof window<"u"?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const q=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function W(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const X={obj:e=>e===Object(e)&&!X.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t){let{arrays:n="shallow",objects:r="reference",strict:o=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(typeof e!=typeof t||!!e!=!!t)return!1;if(X.str(e)||X.num(e))return e===t;const i=X.obj(e);if(i&&"reference"===r)return e===t;const a=X.arr(e);if(a&&"reference"===n)return e===t;if((a||i)&&e===t)return!0;let s;for(s in e)if(!(s in t))return!1;if(i&&"shallow"===n&&"shallow"===r){for(s in o?t:e)if(!X.equ(e[s],t[s],{strict:o,objects:"reference"}))return!1}else for(s in o?t:e)if(e[s]!==t[s])return!1;if(X.und(s)){if(a&&0===e.length&&0===t.length||i&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function K(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Y(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),o=r.pop();return n=r.reduce((e,t)=>e[t],e),{target:n,key:o}}return{target:n,key:t}}const Q=/-\d+$/;function $(e,t,n){if(X.str(n)){if(Q.test(n)){const t=n.replace(Q,""),{target:r,key:o}=Y(e,t);Array.isArray(r[o])||(r[o]=[])}const{target:r,key:o}=Y(e,n);t.__r3f.previousAttach=r[o],r[o]=t}else t.__r3f.previousAttach=n(e,t)}function Z(e,t,n){var r,o;if(X.str(n)){const{target:r,key:o}=Y(e,n),i=t.__r3f.previousAttach;void 0===i?delete r[o]:r[o]=i}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(o=t.__r3f)||delete o.previousAttach}function J(e,t){let{children:n,key:r,ref:o,...i}=t,{children:a,key:s,ref:l,...u}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var d;const f=null!=(d=e?.__r3f)?d:{},h=Object.entries(i),p=[];if(c){const e=Object.keys(u);for(let t=0;t<e.length;t++)i.hasOwnProperty(e[t])||h.unshift([e[t],F+"remove"])}h.forEach(t=>{let[n,r]=t;var o;if(null!=(o=e.__r3f)&&o.primitive&&"object"===n||X.equ(r,u[n]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(n))return p.push([n,r,!0,[]]);let a=[];n.includes("-")&&(a=n.split("-")),p.push([n,r,!1,a]);for(const e in i){const t=i[e];e.startsWith(`${n}-`)&&p.push([e,t,!1,e.split("-")])}});const m={...i};return f.memoizedProps&&f.memoizedProps.args&&(m.args=f.memoizedProps.args),f.memoizedProps&&f.memoizedProps.attach&&(m.attach=f.memoizedProps.attach),{memoized:m,changes:p}}function ee(e,t){var n,r,o;const a=null!=(n=e.__r3f)?n:{},s=a.root,l=null!=(r=null==s||null==s.getState?void 0:s.getState())?r:{},{memoized:u,changes:c}=V(t)?t:J(e,t),d=a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=u);for(let f=0;f<c.length;f++){let[t,n,r,o]=c[f];if(z(e)){const e="srgb",r="srgb-linear";"encoding"===t?(t="colorSpace",n=3001===n?e:r):"outputEncoding"===t&&(t="outputColorSpace",n=3001===n?e:r)}let s=e,u=s[t];if(o.length&&(u=o.reduce((e,t)=>e[t],e),!u||!u.set)){const[n,...r]=o.reverse();s=r.reverse().reduce((e,t)=>e[t],e),t=n}if(n===F+"remove")if(s.constructor){let e=H.get(s.constructor);e||(e=new s.constructor,H.set(s.constructor,e)),n=e[t]}else n=0;if(r)n?a.handlers[t]=n:delete a.handlers[t],a.eventCount=Object.keys(a.handlers).length;else if(u&&u.set&&(u.copy||u instanceof i.L)){if(Array.isArray(n))u.fromArray?u.fromArray(n):u.set(...n);else if(u.copy&&n&&n.constructor&&u.constructor===n.constructor)u.copy(n);else if(void 0!==n){const e=u instanceof i.i;!e&&u.setScalar?u.setScalar(n):u instanceof i.L&&n instanceof i.L?u.mask=n.mask:u.set(n),!N()&&!l.linear&&e&&u.convertSRGBToLinear()}}else if(s[t]=n,s[t]instanceof i.T&&s[t].format===i.h&&s[t].type===i.U){const e=s[t];z(e)&&z(l.gl)?e.colorSpace=l.gl.outputColorSpace:e.encoding=l.gl.outputEncoding}te(e)}if(a.parent&&e.raycast&&d!==a.eventCount){const t=W(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),a.eventCount&&t.interaction.push(e)}return!(1===c.length&&"onUpdate"===c[0][0])&&c.length&&null!=(o=e.__r3f)&&o.parent&&ne(e),e}function te(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function ne(e){null==e.onUpdate||e.onUpdate(e)}function re(e,t){e.manual||(O(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function oe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function ie(e,t,n,r){const o=n.get(t);o&&(n.delete(t),0===n.size&&(e.delete(r),o.target.releasePointerCapture(r)))}function ae(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){const r=e.eventObject.__r3f,o=r?.handlers;if(n.hovered.delete(oe(e)),null!=r&&r.eventCount){const n={...e,intersections:t};null==o.onPointerOut||o.onPointerOut(n),null==o.onPointerLeave||o.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(o){switch(o){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))})}}return function(a){const{onPointerMissed:s,internal:l}=e.getState();l.lastEvent.current=a;const u="onPointerMove"===o,c="onClick"===o||"onContextMenu"===o||"onDoubleClick"===o,d=function(t,n){const r=e.getState(),o=new Set,i=[],a=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<a.length;e++){const t=q(a[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let s=a.flatMap(function(e){const n=q(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r}).sort((e,t)=>{const n=q(e.object),r=q(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{const t=oe(e);return!o.has(t)&&(o.add(t),!0)});r.events.filter&&(s=r.events.filter(s,r));for(const e of s){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&i.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())o.has(oe(e.intersection))||i.push(e.intersection);return i}(a,u?t:void 0),f=c?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],o=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}(a):0;"onPointerDown"===o&&(l.initialClick=[a.offsetX,a.offsetY],l.initialHits=d.map(e=>e.eventObject)),c&&!d.length&&f<=2&&(r(a,l.interaction),s&&s(a)),u&&n(d),function(t,r,o,a){const s=e.getState();if(t.length){const e={stopped:!1};for(const l of t){const u=q(l.object)||s,{raycaster:c,pointer:d,camera:f,internal:h}=u,p=new i.c(d.x,d.y,0).unproject(f),m=e=>{var t,n;return null!=(t=null==(n=h.capturedMap.get(e))?void 0:n.has(l.eventObject))&&t},g=e=>{const t={intersection:l,target:r.target};h.capturedMap.has(e)?h.capturedMap.get(e).set(l.eventObject,t):h.capturedMap.set(e,new Map([[l.eventObject,t]])),r.target.setPointerCapture(e)},v=e=>{const t=h.capturedMap.get(e);t&&ie(h.capturedMap,l.eventObject,t,e)};let y={};for(let e in r){let t=r[e];"function"!=typeof t&&(y[e]=t)}let b={...l,...y,pointer:d,intersections:t,stopped:e.stopped,delta:o,unprojectedPoint:p,ray:c.ray,camera:f,stopPropagation(){const o="pointerId"in r&&h.capturedMap.get(r.pointerId);(!o||o.has(l.eventObject))&&(b.stopped=e.stopped=!0,h.hovered.size&&Array.from(h.hovered.values()).find(e=>e.eventObject===l.eventObject))&&n([...t.slice(0,t.indexOf(l)),l])},target:{hasPointerCapture:m,setPointerCapture:g,releasePointerCapture:v},currentTarget:{hasPointerCapture:m,setPointerCapture:g,releasePointerCapture:v},nativeEvent:r};if(a(b),!0===e.stopped)break}}}(d,a,f,function(e){const t=e.eventObject,n=t.__r3f,i=n?.handlers;if(null!=n&&n.eventCount)if(u){if(i.onPointerOver||i.onPointerEnter||i.onPointerOut||i.onPointerLeave){const t=oe(e),n=l.hovered.get(t);n?n.stopped&&e.stopPropagation():(l.hovered.set(t,e),null==i.onPointerOver||i.onPointerOver(e),null==i.onPointerEnter||i.onPointerEnter(e))}null==i.onPointerMove||i.onPointerMove(e)}else{const n=i[o];n?(!c||l.initialHits.includes(t))&&(r(a,l.interaction.filter(e=>!l.initialHits.includes(e))),n(e)):c&&l.initialHits.includes(t)&&r(a,l.interaction.filter(e=>!l.initialHits.includes(e)))}})}}}}const se=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],le=e=>!(null==e||!e.render),ue=a.createContext(null);let ce,de,fe,he=new Set,pe=new Set,me=new Set;function ge(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ve(e,t){switch(e){case"before":return ge(he,t);case"after":return ge(pe,t);case"tail":return ge(me,t)}}function ye(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"==typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),de=t.internal.subscribers,ce=0;ce<de.length;ce++)fe=de[ce],fe.ref.current(fe.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function be(){const e=a.useContext(ue);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function xe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,t=arguments.length>1?arguments[1]:void 0;return be()(e,t)}function we(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=be(),r=n.getState().internal.subscribe,o=B(e);return j(()=>r(o,t,n),[t,r,n]),null}const Se=new Map,{invalidate:_e,advance:Ee}=function(e){let t,n,r,o=!1;function i(a){n=requestAnimationFrame(i),o=!0,t=0,ve("before",a);for(const n of e.values()){var s;r=n.store.getState(),r.internal.active&&("always"===r.frameloop||r.internal.frames>0)&&(null==(s=r.gl.xr)||!s.isPresenting)&&(t+=ye(a,r))}if(ve("after",a),0===t)return ve("tail",a),o=!1,cancelAnimationFrame(n)}return{loop:i,invalidate:function t(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var a;if(!n)return e.forEach(e=>t(e.store.getState(),r));null!=(a=n.gl.xr)&&a.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=Math.min(60,n.internal.frames+r),o||(o=!0,requestAnimationFrame(i)))},advance:function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;if(n&&ve("before",t),r)ye(t,r,o);else for(const i of e.values())ye(t,i.store.getState());n&&ve("after",t)}}}(Se),{reconciler:Ae,applyProps:Te}=function(e,t){function n(e,t,n){let r,{args:o=[],attach:a,...s}=t,l=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===s.object)throw new Error("R3F: Primitives without 'object' are invalid!");r=K(s.object,{type:e,root:n,attach:a,primitive:!0})}else{const t=L[l];if(!t)throw new Error(`R3F: ${l} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");r=K(new t(...o),{type:e,root:n,attach:a,memoizedProps:{args:o}})}return void 0===r.__r3f.attach&&(r instanceof i.f?r.__r3f.attach="geometry":r instanceof i.M&&(r.__r3f.attach="material")),"inject"!==l&&ee(r,s),r}function r(e,t){let n=!1;var r,o;t&&(null!=(r=t.__r3f)&&r.attach?$(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(o=e.__r3f)||o.objects.push(t),t.__r3f||K(t,{}),t.__r3f.parent=e,ne(t),te(t))}function o(e,t,n){let r=!1;if(t){var o,i;if(null!=(o=t.__r3f)&&o.attach)$(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});const o=e.children.filter(e=>e!==t),i=o.indexOf(n);e.children=[...o.slice(0,i),t,...o.slice(i)],r=!0}r||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||K(t,{}),t.__r3f.parent=e,ne(t),te(t)}}function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&[...e].forEach(e=>s(t,e,n))}function s(e,t,n){if(t){var r,o,i;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter(e=>e!==t)),null!=(o=t.__r3f)&&o.attach)Z(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,r)=>{(e.eventObject===t||e.object===t)&&n.hovered.delete(r)}),n.capturedMap.forEach((e,r)=>{ie(n.capturedMap,t,e,r)})}(W(t),t)}const u=null==(i=t.__r3f)?void 0:i.primitive,c=!u&&(void 0===n?null!==t.dispose:n);var l;if(!u)a(null==(l=t.__r3f)?void 0:l.objects,t,c),a(t.children,t,c);if(delete t.__r3f,c&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?A.unstable_scheduleCallback(A.unstable_IdlePriority,e):e()}te(e)}}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:E({createInstance:n,removeChild:s,appendChild:r,appendInitialChild:r,insertBefore:o,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&s(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&o(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;return!!(null!=(t=e?.__r3f)?t:{}).handlers},prepareUpdate(e,t,n,r){var o;if((null!=(o=e?.__r3f)?o:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:o,...i}=r,{args:a=[],children:s,...l}=n;if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some((e,t)=>e!==a[t]))return[!0];const u=J(e,i,l,!0);return u.changes.length?[!1,u]:null}},commitUpdate(e,t,o,i,a,l){let[u,c]=t;u?function(e,t,o,i){var a;const l=null==(a=e.__r3f)?void 0:a.parent;if(!l)return;const u=n(t,o,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(u,t);e.children=e.children.filter(e=>!e.__r3f)}e.__r3f.objects.forEach(e=>r(u,e)),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||s(l,e),u.parent&&(u.__r3f.autoRemovedBeforeAppend=!0),r(l,u),u.raycast&&u.__r3f.eventCount&&W(u).getState().internal.interaction.push(u),[i,i.alternate].forEach(e=>{null!==e&&(e.stateNode=u,e.ref&&("function"==typeof e.ref?e.ref(u):e.ref.current=u))})}(e,o,a,l):ee(e,c)},commitMount(e,t,n,r){var o;const i=null!=(o=e.__r3f)?o:{};e.raycast&&i.handlers&&i.eventCount&&W(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>K(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&Z(r,e,n),e.isObject3D&&(e.visible=!1),te(e)},unhideInstance(e,t){var n;const{attach:r,parent:o}=null!=(n=e.__r3f)?n:{};r&&o&&$(o,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),te(e)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():u.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&X.fun(performance.now)?performance.now:X.fun(Date.now)?Date.now:()=>0,scheduleTimeout:X.fun(setTimeout)?setTimeout:void 0,cancelTimeout:X.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ee}}(0,function(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return u.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return u.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return u.ContinuousEventPriority;default:return u.DefaultEventPriority}}),Pe={objects:"shallow",strict:!1},Ce=(e,t)=>{const n="function"==typeof e?e(t):e;return le(n)?n:new i.W({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Me(e){const t=Se.get(e),n=t?.fiber,r=t?.store;t&&console.warn("R3F.createRoot should only be called once!");const o="function"==typeof reportError?reportError:console.error,s=r||((e,t)=>{const n=f((n,r)=>{const o=new i.c,s=new i.c,l=new i.c;function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size;const{width:a,height:u,top:c,left:d}=n,f=a/u;t instanceof i.c?l.copy(t):l.set(...t);const h=e.getWorldPosition(o).distanceTo(l);if(O(e))return{width:a/e.zoom,height:u/e.zoom,top:c,left:d,factor:1,distance:h,aspect:f};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*h,r=n*(a/u);return{width:r,height:n,top:c,left:d,factor:a/r,distance:h,aspect:f}}}let c;const d=e=>n(t=>({performance:{...t.performance,current:e}})),f=new i.d;return{set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:(e,n)=>t(e,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new i.C,pointer:f,mouse:f,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();c&&clearTimeout(c),e.performance.current!==e.performance.min&&d(e.performance.min),c=setTimeout(()=>d(r().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:e=>n(t=>({...t,events:{...t.events,...e}})),setSize:(e,t,o,i,a)=>{const l=r().camera,c={width:e,height:t,top:i||0,left:a||0,updateStyle:o};n(e=>({size:c,viewport:{...e.viewport,...u(l,s,c)}}))},setDpr:e=>n(t=>{const n=G(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}}),setFrameloop:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n(()=>({frameloop:e}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:a.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const o=r().internal;return o.priority=o.priority+(t>0?1:0),o.subscribers.push({ref:e,priority:t,store:n}),o.subscribers=o.subscribers.sort((e,t)=>e.priority-t.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}}}),r=n.getState();let o=r.size,s=r.viewport.dpr,l=r.camera;return n.subscribe(()=>{const{camera:e,size:t,viewport:r,gl:i,set:a}=n.getState();if(t.width!==o.width||t.height!==o.height||r.dpr!==s){var u;o=t,s=r.dpr,re(e,t),i.setPixelRatio(r.dpr);const n=null!=(u=t.updateStyle)?u:typeof HTMLCanvasElement<"u"&&i.domElement instanceof HTMLCanvasElement;i.setSize(t.width,t.height,n)}e!==l&&(l=e,a(t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}})))}),n.subscribe(t=>e(t)),n})(_e,Ee),l=n||Ae.createContainer(s,u.ConcurrentRoot,null,!1,null,"",o,null);t||Se.set(e,{fiber:l,store:s});let c,d,h=!1;return{configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{gl:n,size:r,scene:o,events:a,onCreated:l,shadows:u=!1,linear:f=!1,flat:p=!1,legacy:m=!1,orthographic:g=!1,frameloop:v="always",dpr:y=[1,2],performance:b,raycaster:x,camera:w,onPointerMissed:S}=t,_=s.getState(),E=_.gl;_.gl||_.set({gl:E=Ce(n,e)});let A=_.raycaster;A||_.set({raycaster:A=new i.R});const{params:T,...P}=x||{};if(X.equ(P,A,Pe)||Te(A,{...P}),X.equ(T,A.params,Pe)||Te(A,{params:{...A.params,...T}}),!_.camera||_.camera===d&&!X.equ(d,w,Pe)){d=w;const e=w instanceof i.e,t=e?w:g?new i.O(0,0,0,0,.1,1e3):new i.P(75,0,.1,1e3);e||(t.position.z=5,w&&Te(t,w),!_.camera&&!(null!=w&&w.rotation)&&t.lookAt(0,0,0)),_.set({camera:t}),A.camera=t}if(!_.scene){let e;o instanceof i.S?e=o:(e=new i.S,o&&Te(e,o)),_.set({scene:K(e)})}if(!_.xr){var C;const e=(e,t)=>{const n=s.getState();"never"!==n.frameloop&&Ee(e,!0,n,t)},t=()=>{const t=s.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||_e(t)},n={connect(){const e=s.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=s.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(C=E.xr)?void 0:C.addEventListener)&&n.connect(),_.set({xr:n})}if(E.shadowMap){const e=E.shadowMap.enabled,t=E.shadowMap.type;if(E.shadowMap.enabled=!!u,X.boo(u))E.shadowMap.type=i.a;else if(X.str(u)){var M;const e={basic:i.B,percentage:i.b,soft:i.a,variance:i.V};E.shadowMap.type=null!=(M=e[u])?M:i.a}else X.obj(u)&&Object.assign(E.shadowMap,u);(e!==E.shadowMap.enabled||t!==E.shadowMap.type)&&(E.shadowMap.needsUpdate=!0)}const L=N();L&&("enabled"in L?L.enabled=!m:"legacyMode"in L&&(L.legacyMode=m)),h||Te(E,{outputEncoding:f?3e3:3001,toneMapping:p?i.N:i.A}),_.legacy!==m&&_.set(()=>({legacy:m})),_.linear!==f&&_.set(()=>({linear:f})),_.flat!==p&&_.set(()=>({flat:p})),n&&!X.fun(n)&&!le(n)&&!X.equ(n,E,Pe)&&Te(E,n),a&&!_.events.handlers&&_.set({events:a(s)});const I=function(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:o,left:i,updateStyle:a=n}=t;return{width:e,height:r,top:o,left:i,updateStyle:a}}if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:o,left:i}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:o,left:i,updateStyle:n}}return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,r);return X.equ(I,_.size,Pe)||_.setSize(I.width,I.height,I.updateStyle,I.top,I.left),y&&_.viewport.dpr!==G(y)&&_.setDpr(y),_.frameloop!==v&&_.setFrameloop(v),_.onPointerMissed||_.set({onPointerMissed:S}),b&&!X.equ(b,_.performance,Pe)&&_.set(e=>({performance:{...e.performance,...b}})),c=l,h=!0,this},render(t){return h||this.configure(),Ae.updateContainer(a.createElement(Le,{store:s,children:t,onCreated:c,rootElement:e}),l,null,()=>{}),s},unmount(){Ie(e)}}}function Le(e){let{store:t,children:n,onCreated:r,rootElement:o}=e;return j(()=>{const e=t.getState();e.set(e=>({internal:{...e.internal,active:!0}})),r&&r(e),t.getState().events.connected||null==e.events.connect||e.events.connect(o)},[]),a.createElement(ue.Provider,{value:t},n)}function Ie(e,t){const n=Se.get(e),r=n?.fiber;if(r){const t=n?.store.getState();t&&(t.internal.active=!1),Ae.updateContainer(null,r,null,()=>{t&&setTimeout(()=>{try{var n,r,o,i;null==t.events.disconnect||t.events.disconnect(),null==(n=t.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(o=t.gl)||null==o.forceContextLoss||o.forceContextLoss(),null!=(i=t.gl)&&i.xr&&t.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(t),Se.delete(e)}catch{}},500)})}}function Re(e,t,n){return a.createElement(ke,{key:t.uuid,children:e,container:t,state:n})}function ke(e){let{state:t={},children:n,container:r}=e;const{events:o,size:s,...l}=t,u=be(),[c]=a.useState(()=>new i.R),[d]=a.useState(()=>new i.d),h=a.useCallback((e,t)=>{const n={...e};let a;if(Object.keys(e).forEach(r=>{(se.includes(r)||e[r]!==t[r]&&t[r])&&delete n[r]}),t&&s){const n=t.camera;a=e.viewport.getCurrentViewport(n,new i.c,s),n!==e.camera&&re(n,s)}return{...n,scene:r,raycaster:c,pointer:d,mouse:d,previousRoot:u,events:{...e.events,...t?.events,...o},size:{...e.size,...s},viewport:{...e.viewport,...a},...l}},[t]),[p]=a.useState(()=>{const e=u.getState();return f((t,n)=>({...e,scene:r,raycaster:c,pointer:d,mouse:d,previousRoot:u,events:{...e.events,...o},size:{...e.size,...s},...l,set:t,get:n,setEvents:e=>t(t=>({...t,events:{...t.events,...e}}))}))});return a.useEffect(()=>{const e=u.subscribe(e=>p.setState(t=>h(e,t)));return()=>{e(),p.destroy()}},[]),a.useEffect(()=>{p.setState(e=>h(u.getState(),e))},[h]),a.createElement(a.Fragment,null,Ae.createPortal(a.createElement(ue.Provider,{value:p},n),p,null))}var ze,Ne;Ae.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:a.version});var Oe=function(){if(Ne)return ze;function e(e,t,n){var r,o,i,a,s;function l(){var u=Date.now()-a;u<t&&u>=0?r=setTimeout(l,t-u):(r=null,n||(s=e.apply(i,o),i=o=null))}null==t&&(t=100);var u=function(){i=this,o=arguments,a=Date.now();var u=n&&!r;return r||(r=setTimeout(l,t)),u&&(s=e.apply(i,o),i=o=null),s};return u.clear=function(){r&&(clearTimeout(r),r=null)},u.flush=function(){r&&(s=e.apply(i,o),i=o=null,clearTimeout(r),r=null)},u}return Ne=1,e.debounce=e,ze=e}();const je=(0,i.g)(Oe);function Be(e){let{debounce:t,scroll:n,polyfill:r,offsetSize:o}=void 0===e?{debounce:0,scroll:!1,offsetSize:!1}:e;const i=r||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,l]=(0,a.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),u=(0,a.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s}),c=t?"number"==typeof t?t:t.scroll:null,d=t?"number"==typeof t?t:t.resize:null,f=(0,a.useRef)(!1);(0,a.useEffect)(()=>(f.current=!0,()=>{f.current=!1}));const[h,p,m]=(0,a.useMemo)(()=>{const e=()=>{if(!u.current.element)return;const{left:e,top:t,width:n,height:r,bottom:i,right:a,x:s,y:c}=u.current.element.getBoundingClientRect(),d={left:e,top:t,width:n,height:r,bottom:i,right:a,x:s,y:c};u.current.element instanceof HTMLElement&&o&&(d.height=u.current.element.offsetHeight,d.width=u.current.element.offsetWidth),Object.freeze(d),f.current&&!Fe(u.current.lastBounds,d)&&l(u.current.lastBounds=d)};return[e,d?je(e,d):e,c?je(e,c):e]},[l,o,c,d]);function g(){u.current.scrollContainers&&(u.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",m,!0)),u.current.scrollContainers=null),u.current.resizeObserver&&(u.current.resizeObserver.disconnect(),u.current.resizeObserver=null)}function v(){u.current.element&&(u.current.resizeObserver=new i(m),u.current.resizeObserver.observe(u.current.element),n&&u.current.scrollContainers&&u.current.scrollContainers.forEach(e=>e.addEventListener("scroll",m,{capture:!0,passive:!0})))}return function(e,t){(0,a.useEffect)(()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,t])}(m,!!n),function(e){(0,a.useEffect)(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}(p),(0,a.useEffect)(()=>{g(),v()},[n,m,p]),(0,a.useEffect)(()=>g,[]),[e=>{!e||e===u.current.element||(g(),u.current.element=e,u.current.scrollContainers=De(e),v())},s,h]}function De(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:o}=window.getComputedStyle(e);return[n,r,o].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...De(e.parentElement)]}const Ue=["x","y","top","bottom","left","right","width","height"],Fe=(e,t)=>Ue.every(n=>e[n]===t[n]);var He=Object.defineProperty,Ve=Object.defineProperties,Ge=Object.getOwnPropertyDescriptors,qe=Object.getOwnPropertySymbols,We=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,Ke=(e,t,n)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ye=(e,t)=>{for(var n in t||(t={}))We.call(t,n)&&Ke(e,n,t[n]);if(qe)for(var n of qe(t))Xe.call(t,n)&&Ke(e,n,t[n]);return e};function Qe(e,t,n){if(!e)return;if(!0===n(e))return e;let r=e.child;for(;r;){const e=Qe(r,t,n);if(e)return e;r=r.sibling}}function $e(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch{return e}}const Ze=$e(a.createContext(null));class Je extends a.Component{render(){return a.createElement(Ze.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:et,ReactCurrentDispatcher:tt}=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function nt(){var e,t;const n=function(){const e=a.useContext(Ze);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=a.useId();return a.useMemo(()=>{for(const n of[et?.current,e,e?.alternate]){if(!n)continue;const e=Qe(n,!1,e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}});if(e)return e}},[e,t])}(),[r]=a.useState(()=>new Map);r.clear();let o=n;for(;o;){const n=null==(e=o.type)?void 0:e._context;n&&n!==Ze&&!r.has(n)&&r.set(n,null==(t=tt?.current)?void 0:t.readContext($e(n))),o=o.return}return r}function rt(){const e=nt();return a.useMemo(()=>Array.from(e.keys()).reduce((t,n)=>r=>a.createElement(t,null,a.createElement(n.Provider,((e,t)=>Ve(e,Ge(t)))(Ye({},r),{value:e.get(n)}))),e=>a.createElement(Je,Ye({},e))),[e])}const ot={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function it(e){const{handlePointer:t}=ae(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(ot).reduce((e,n)=>({...e,[n]:t(n)}),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:o}=e.getState();null==o.disconnect||o.disconnect(),r(e=>({events:{...e.events,connected:t}})),Object.entries(null!=(n=o.handlers)?n:[]).forEach(e=>{let[n,r]=e;const[o,i]=ot[n];t.addEventListener(o,r,{passive:i})})},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach(e=>{let[t,r]=e;if(n&&n.connected instanceof HTMLElement){const[e]=ot[t];n.connected.removeEventListener(e,r)}}),t(e=>({events:{...e.events,connected:void 0}})))}}}const at=a.forwardRef(function(e,t){let{children:n,fallback:r,resize:o,style:s,gl:l,events:u=it,eventSource:c,eventPrefix:d,shadows:f,linear:h,flat:p,legacy:m,orthographic:g,frameloop:v,dpr:y,performance:b,raycaster:x,camera:w,scene:S,onPointerMissed:_,onCreated:E,...A}=e;a.useMemo(()=>I(i.j),[]);const T=rt(),[P,C]=Be({scroll:!0,debounce:{scroll:50,resize:0},...o}),M=a.useRef(null),L=a.useRef(null);a.useImperativeHandle(t,()=>M.current);const R=B(_),[k,z]=a.useState(!1),[N,O]=a.useState(!1);if(k)throw k;if(N)throw N;const F=a.useRef(null);j(()=>{const e=M.current;C.width>0&&C.height>0&&e&&(F.current||(F.current=Me(e)),F.current.configure({gl:l,events:u,shadows:f,linear:h,flat:p,legacy:m,orthographic:g,frameloop:v,dpr:y,performance:b,raycaster:x,camera:w,scene:S,size:C,onPointerMissed:function(){return null==R.current?void 0:R.current(...arguments)},onCreated:e=>{var t;null==e.events.connect||e.events.connect(c?(t=c)&&t.hasOwnProperty("current")?c.current:c:L.current),d&&e.setEvents({compute:(e,t)=>{const n=e[d+"X"],r=e[d+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),E?.(e)}}),F.current.render(a.createElement(T,null,a.createElement(U,{set:O},a.createElement(a.Suspense,{fallback:a.createElement(D,{set:z})},n)))))}),a.useEffect(()=>{const e=M.current;if(e)return()=>Ie(e)},[]);const H=c?"none":"auto";return a.createElement("div",(0,i._)({ref:L,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:H,...s}},A),a.createElement("div",{ref:P,style:{width:"100%",height:"100%"}},a.createElement("canvas",{ref:M,style:{display:"block"}},r)))}),st=a.forwardRef(function(e,t){return a.createElement(Je,null,a.createElement(at,(0,i._)({},e,{ref:t})))});class lt extends i.G{constructor(e,t){super(),this.inputSource=null,this.xrControllerModel=null,this.index=e,this.controller=t.xr.getController(e),this.grip=t.xr.getControllerGrip(e),this.hand=t.xr.getHand(e),this.grip.userData.name="grip",this.controller.userData.name="controller",this.hand.userData.name="hand",this.visible=!1,this.add(this.controller,this.grip,this.hand),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.controller.addEventListener("connected",this._onConnected),this.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(e){e.fake||e.data&&(this.visible=!0,this.inputSource=e.data,this.dispatchEvent(e))}_onDisconnected(e){e.fake||(this.visible=!1,this.inputSource=null,this.dispatchEvent(e))}dispose(){this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var ut,ct;const dt=e=>Array.from(new Set(e)),ft=typeof window<"u"&&(null!=(ut=window.document)&&ut.createElement||"ReactNative"===(null==(ct=window.navigator)?void 0:ct.product))?a.useLayoutEffect:a.useEffect;function ht(e){const t=a.useRef(e);return ft(()=>{t.current=e},[e]),t}function pt(e,t){let{handedness:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=ht(t),o=Ct(e=>e.controllers);ft(()=>{const t=o.map(t=>{if(n&&t.inputSource&&t.inputSource.handedness!==n)return;const o=e=>r.current({nativeEvent:e,target:t});return t.controller.addEventListener(e,o),()=>t.controller.removeEventListener(e,o)});return()=>t.forEach(e=>e?.())},[o,n,e])}const mt=new i.k;function gt(e){let{children:t}=e;const n=xe(e=>e.events),r=xe(e=>e.get),o=xe(e=>e.raycaster),i=Ct(e=>e.controllers),s=Ct(e=>e.interactions),l=Ct(e=>e.hoverState),u=Ct(e=>e.hasInteraction),c=Ct(e=>e.getInteraction),d=a.useCallback(e=>{const t=Array.from(s.keys());return mt.identity().extractRotation(e.matrixWorld),o.ray.origin.setFromMatrixPosition(e.matrixWorld),o.ray.direction.set(0,0,-1).applyMatrix4(mt),o.intersectObjects(t,!0)},[s,o]);we(()=>{var e;if(0!==s.size)for(const t of i){if(null==(e=t.inputSource)||!e.handedness)return;const o=l[t.inputSource.handedness],i=new Set;let a=d(t.controller);if(n.filter)a=n.filter(a,r());else{const e=a.find(e=>e?.object);e&&(a=[e])}for(const e of a){let n=e.object;for(;n;){if(u(n,"onHover")&&!o.has(n)){const r=c(n,"onHover");for(const n of r)n({target:t,intersection:e,intersections:a})}const r=c(n,"onMove");r?.forEach(n=>n({target:t,intersection:e,intersections:a})),o.set(n,e),i.add(n.id),n=n.parent}}for(const e of o.keys())if(!i.has(e.id)){o.delete(e);const n=c(e,"onBlur");if(!n)continue;for(const e of n)e({target:t,intersections:a})}}});const f=a.useCallback(e=>t=>{var n;if(null==(n=t.target.inputSource)||!n.handedness)return;const r=l[t.target.inputSource.handedness],o=Array.from(new Set(r.values()));s.forEach((n,i)=>{var a,s,l;if(r.has(i)){if(!n[e])return;for(const s of n[e])null==(a=s.current)||a.call(s,{target:t.target,intersection:r.get(i),intersections:o})}else if("onSelect"===e&&n.onSelectMissed)for(const e of n.onSelectMissed)null==(s=e.current)||s.call(e,{target:t.target,intersections:o});else if("onSqueeze"===e&&n.onSqueezeMissed)for(const e of n.onSqueezeMissed)null==(l=e.current)||l.call(e,{target:t.target,intersections:o})})},[l,s]);return pt("select",f("onSelect")),pt("selectstart",f("onSelectStart")),pt("selectend",f("onSelectEnd")),pt("squeeze",f("onSqueeze")),pt("squeezeend",f("onSqueezeEnd")),pt("squeezestart",f("onSqueezeStart")),a.createElement(a.Fragment,null,t)}function vt(e,t,n){const r=Ct(e=>e.addInteraction),o=Ct(e=>e.removeInteraction),i=ht(n);ft(()=>{const n=e.current;if(n&&i.current)return r(n,t,i),()=>o(n,t,i)},[e,t,r,o])}const yt=a.forwardRef(function(e,t){let{onHover:n,onBlur:r,onSelectStart:o,onSelectEnd:i,onSelectMissed:s,onSelect:l,onSqueezeStart:u,onSqueezeEnd:c,onSqueezeMissed:d,onSqueeze:f,onMove:h,children:p}=e;const m=a.useRef(null);return a.useImperativeHandle(t,()=>m.current),vt(m,"onHover",n),vt(m,"onBlur",r),vt(m,"onSelectStart",o),vt(m,"onSelectEnd",i),vt(m,"onSelectMissed",s),vt(m,"onSelect",l),vt(m,"onSqueezeStart",u),vt(m,"onSqueezeEnd",c),vt(m,"onSqueezeMissed",d),vt(m,"onSqueeze",f),vt(m,"onMove",h),a.createElement("group",{ref:m},p)}),bt=a.forwardRef(function(e,t){let{onSelectStart:n,onSelectEnd:r,children:o,...s}=e;const l=a.useRef(),u=a.useRef(null),c=a.useMemo(()=>new i.k,[]);return a.useImperativeHandle(t,()=>u.current),we(()=>{const e=l.current,t=u.current;e&&(t.applyMatrix4(c),t.applyMatrix4(e.matrixWorld),t.updateMatrixWorld(),c.copy(e.matrixWorld).invert())}),a.createElement(yt,{ref:u,onSelectStart:e=>{l.current=e.target.controller,c.copy(e.target.controller.matrixWorld).invert(),n?.(e)},onSelectEnd:e=>{e.target.controller===l.current&&(l.current=void 0),r?.(e)},...s},o)}),xt=a.createContext(null),wt=f((e,t)=>({set:e,get:t,session:null,referenceSpaceType:null}));function St(e){let{foveation:t=0,frameRate:n,referenceSpace:r="local-floor",onSessionStart:o,onSessionEnd:i,onVisibilityChange:s,onInputSourcesChange:l,children:u}=e;const c=xe(e=>e.gl),d=xe(e=>e.camera),f=Ct(e=>e.player),h=Ct(e=>e.get),p=Ct(e=>e.set),m=Ct(e=>e.session),g=Ct(e=>e.controllers),v=ht(o),y=ht(i),b=ht(s),x=ht(l);return ft(()=>{const e=[0,1].map(e=>{const t=new lt(e,c),n=()=>p(e=>({controllers:[...e.controllers,t]})),r=()=>p(e=>({controllers:e.controllers.filter(e=>e!==t)}));return t.addEventListener("connected",n),t.addEventListener("disconnected",r),()=>{t.removeEventListener("connected",n),t.removeEventListener("disconnected",r)}});return()=>e.forEach(e=>e())},[c,p]),ft(()=>wt.subscribe(e=>{let{session:t}=e;return p(()=>({session:t}))}),[c.xr,p]),ft(()=>{c.xr.setFoveation(t),p(()=>({foveation:t}))},[c.xr,t,p]),ft(()=>{var e;try{n&&(null==(e=m?.updateTargetFrameRate)||e.call(m,n))}catch{}p(()=>({frameRate:n}))},[m,n,p]),ft(()=>{const e=wt.getState();c.xr.setReferenceSpaceType(r),p(()=>({referenceSpace:r})),e.set({referenceSpaceType:r})},[c.xr,r,p]),ft(()=>{if(!m)return void c.xr.setSession(null);const e=e=>{var t;p(()=>({isPresenting:!0})),null==(t=v.current)||t.call(v,{nativeEvent:{...e,target:m},target:m})},t=e=>{var t;p(()=>({isPresenting:!1,session:null})),wt.setState(()=>({session:null})),null==(t=y.current)||t.call(y,{nativeEvent:{...e,target:m},target:m})},n=e=>{var t;null==(t=b.current)||t.call(b,{nativeEvent:e,target:m})},r=e=>{var t;const n=Object.values(m.inputSources).some(e=>e.hand);p(()=>({isHandTracking:n})),null==(t=x.current)||t.call(x,{nativeEvent:e,target:m})};return c.xr.addEventListener("sessionstart",e),c.xr.addEventListener("sessionend",t),m.addEventListener("visibilitychange",n),m.addEventListener("inputsourceschange",r),c.xr.setSession(m).then(()=>{c.xr.setFoveation(h().foveation)}),()=>{c.xr.removeEventListener("sessionstart",e),c.xr.removeEventListener("sessionend",t),m.removeEventListener("visibilitychange",n),m.removeEventListener("inputsourceschange",r)}},[m,c.xr,p,h]),a.createElement(gt,null,a.createElement("primitive",{object:f},a.createElement("primitive",{object:d}),g.map(e=>a.createElement("primitive",{key:e.index,object:e}))),u)}function _t(e){const t=a.useMemo(()=>f((e,t)=>({set:e,get:t,controllers:[],isPresenting:!1,isHandTracking:!1,player:new i.G,session:null,foveation:0,referenceSpace:"local-floor",hoverState:{left:new Map,right:new Map,none:new Map},interactions:new Map,hasInteraction(e,n){var r;return!(null==(r=t().interactions.get(e))||!r[n].some(e=>e.current))},getInteraction(e,n){var r;return null==(r=t().interactions.get(e))?void 0:r[n].reduce((e,t)=>(t.current&&e.push(t.current),e),[])},addInteraction(e,n,r){const o=t().interactions;o.has(e)||o.set(e,{onHover:[],onBlur:[],onSelect:[],onSelectEnd:[],onSelectStart:[],onSelectMissed:[],onSqueeze:[],onSqueezeEnd:[],onSqueezeStart:[],onSqueezeMissed:[],onMove:[]}),o.get(e)[n].push(r)},removeInteraction(e,n,r){const o=t().interactions.get(e);if(o){const e=o[n].indexOf(r);-1!==e&&o[n].splice(e,1)}}})),[]);return a.createElement(xt.Provider,{value:t},a.createElement(St,{...e}))}const Et=async(e,t)=>{const n=wt.getState();if(n.session)return void console.warn("@react-three/xr: session already started, please stop it first");const r=((e,t)=>{var n;if(e||t)return e&&!t?{optionalFeatures:[e]}:e&&t?{...t,optionalFeatures:dt([...null!=(n=t.optionalFeatures)?n:[],e])}:t})(n.referenceSpaceType,t),o=await navigator.xr.requestSession(e,r);return n.set(()=>({session:o})),o},At=async function(e){let{sessionInit:t,enterOnly:n,exitOnly:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=wt.getState();if((!o.session||!n)&&(o.session||!r))return o.session?await(async()=>{const e=wt.getState();e.session?(await e.session.end(),e.set({session:null})):console.warn("@react-three/xr: no session to stop, please start it first")})():await Et(e,t)},Tt=a.forwardRef(function(e,t){let{mode:n,sessionInit:r,enterOnly:o=!1,exitOnly:i=!1,onClick:s,onError:l,children:u,...c}=e;var d;const[f,h]=a.useState("exited"),[p,m]=a.useState("unknown"),g=((e,t,n)=>{switch(e){case"entered":return`Exit ${t}`;case"exited":return`Enter ${t}`;default:switch(n){case"https":return"HTTPS needed";case"security":return`${t} blocked`;default:return`${t} unsupported`}}})(f,n,p),v="inline"===n?n:`immersive-${n.toLowerCase()}`,y=ht(l);ft(()=>{navigator?.xr?navigator.xr.isSessionSupported(v).then(e=>{if(e)h("exited");else{const e="https:"===location.protocol;h("unsupported"),m(e?"unknown":"https")}}).catch(e=>{h("unsupported"),"name"in e&&"SecurityError"===e.name?m("security"):m("unknown")}):h("unsupported")},[v]),ft(()=>wt.subscribe(e=>{e.session?h("entered"):"unsupported"!==f&&h("exited")}),[f]);const b=a.useCallback(async e=>{s?.(e);try{At(v,{sessionInit:r,enterOnly:o,exitOnly:i})}catch(t){const e=y.current;if(!(e&&t instanceof Error))throw t;e(t)}},[s,v,r,o,i,y]);return a.createElement("button",{...c,ref:t,onClick:"unsupported"===f?s:b},null!=(d="function"==typeof u?u(f):u)?d:g)}),Pt={position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",border:"1px solid white",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",zIndex:99999,cursor:"pointer"};function Ct(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,t=arguments.length>1?arguments[1]:void 0;const n=a.useContext(xt);if(!n)throw new Error("useXR must be used within an <XR /> component!");return n(e,t)}function Mt(e,t){if(t===i.l)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===i.m||t===i.n){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,o=[];if(n)if(t===i.m)for(let e=1;e<=r;e++)o.push(n.getX(0)),o.push(n.getX(e)),o.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2===0?(o.push(n.getX(e)),o.push(n.getX(e+1)),o.push(n.getX(e+2))):(o.push(n.getX(e+2)),o.push(n.getX(e+1)),o.push(n.getX(e)));o.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(o),a.clearGroups(),a}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}a.forwardRef((e,t)=>{let{style:n=Pt,sessionInit:r={domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]},children:o,...i}=e;return a.createElement(Tt,{...i,ref:t,mode:"AR",style:n,sessionInit:r},o)}),a.forwardRef((e,t)=>{let{style:n=Pt,sessionInit:r={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]},children:o,...i}=e;return a.createElement(Tt,{...i,ref:t,mode:"VR",style:n,sessionInit:r},o)});const Lt=parseInt(i.o.replace(/\D+/g,""));var It=Object.defineProperty,Rt=(e,t,n)=>(((e,t,n)=>{t in e?It(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const kt=new i.s,zt=new i.t,Nt=Math.cos(Math.PI/180*70),Ot=(e,t)=>(e%t+t)%t;let jt=class extends i.E{constructor(e,t){super(),Rt(this,"object"),Rt(this,"domElement"),Rt(this,"enabled",!0),Rt(this,"target",new i.c),Rt(this,"minDistance",0),Rt(this,"maxDistance",1/0),Rt(this,"minZoom",0),Rt(this,"maxZoom",1/0),Rt(this,"minPolarAngle",0),Rt(this,"maxPolarAngle",Math.PI),Rt(this,"minAzimuthAngle",-1/0),Rt(this,"maxAzimuthAngle",1/0),Rt(this,"enableDamping",!1),Rt(this,"dampingFactor",.05),Rt(this,"enableZoom",!0),Rt(this,"zoomSpeed",1),Rt(this,"enableRotate",!0),Rt(this,"rotateSpeed",1),Rt(this,"enablePan",!0),Rt(this,"panSpeed",1),Rt(this,"screenSpacePanning",!0),Rt(this,"keyPanSpeed",7),Rt(this,"zoomToCursor",!1),Rt(this,"autoRotate",!1),Rt(this,"autoRotateSpeed",2),Rt(this,"reverseOrbit",!1),Rt(this,"reverseHorizontalOrbit",!1),Rt(this,"reverseVerticalOrbit",!1),Rt(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Rt(this,"mouseButtons",{LEFT:i.p.ROTATE,MIDDLE:i.p.DOLLY,RIGHT:i.p.PAN}),Rt(this,"touches",{ONE:i.q.ROTATE,TWO:i.q.DOLLY_PAN}),Rt(this,"target0"),Rt(this,"position0"),Rt(this,"zoom0"),Rt(this,"_domElementKeyEvents",null),Rt(this,"getPolarAngle"),Rt(this,"getAzimuthalAngle"),Rt(this,"setPolarAngle"),Rt(this,"setAzimuthalAngle"),Rt(this,"getDistance"),Rt(this,"listenToKeyEvents"),Rt(this,"stopListenToKeyEvents"),Rt(this,"saveState"),Rt(this,"reset"),Rt(this,"update"),Rt(this,"connect"),Rt(this,"dispose"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=Ot(e,2*Math.PI),r=c.phi;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let o=Math.abs(t-r);2*Math.PI-o<o&&(t<r?t+=2*Math.PI:r+=2*Math.PI),d.phi=t-r,n.update()},this.setAzimuthalAngle=e=>{let t=Ot(e,2*Math.PI),r=c.theta;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let o=Math.abs(t-r);2*Math.PI-o<o&&(t<r?t+=2*Math.PI:r+=2*Math.PI),d.theta=t-r,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",$),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",$),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),l=s.NONE},this.update=(()=>{const t=new i.c,o=new i.c(0,1,0),a=(new i.Q).setFromUnitVectors(e.up,o),p=a.clone().invert(),m=new i.c,g=new i.Q,v=2*Math.PI;return function(){const y=n.object.position;a.setFromUnitVectors(e.up,o),p.copy(a).invert(),t.copy(y).sub(n.target),t.applyQuaternion(a),c.setFromVector3(t),n.autoRotate&&l===s.NONE&&M(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=d.theta*n.dampingFactor,c.phi+=d.phi*n.dampingFactor):(c.theta+=d.theta,c.phi+=d.phi);let b=n.minAzimuthAngle,x=n.maxAzimuthAngle;isFinite(b)&&isFinite(x)&&(b<-Math.PI?b+=v:b>Math.PI&&(b-=v),x<-Math.PI?x+=v:x>Math.PI&&(x-=v),c.theta=b<=x?Math.max(b,Math.min(x,c.theta)):c.theta>(b+x)/2?Math.max(b,c.theta):Math.min(x,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),n.zoomToCursor&&A||n.object.isOrthographicCamera?c.radius=j(c.radius):c.radius=j(c.radius*f),t.setFromSpherical(c),t.applyQuaternion(p),y.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(d.theta*=1-n.dampingFactor,d.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(d.set(0,0,0),h.set(0,0,0));let w=!1;if(n.zoomToCursor&&A){let r=null;if(n.object instanceof i.P&&n.object.isPerspectiveCamera){const e=t.length();r=j(e*f);const o=e-r;n.object.position.addScaledVector(_,o),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new i.c(E.x,E.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix(),w=!0;const o=new i.c(E.x,E.y,0);o.unproject(n.object),n.object.position.sub(o).add(e),n.object.updateMatrixWorld(),r=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==r&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(kt.origin.copy(n.object.position),kt.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(kt.direction))<Nt?e.lookAt(n.target):(zt.setFromNormalAndCoplanarPoint(n.object.up,n.target),kt.intersectPlane(zt,n.target))))}else n.object instanceof i.O&&n.object.isOrthographicCamera&&(w=1!==f,w&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix()));return f=1,A=!1,!!(w||m.distanceToSquared(n.object.position)>u||8*(1-g.dot(n.object.quaternion))>u)&&(n.dispatchEvent(r),m.copy(n.object.position),g.copy(n.object.quaternion),w=!1,!0)}})(),this.connect=e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Z),n.domElement.addEventListener("pointerdown",W),n.domElement.addEventListener("pointercancel",Y),n.domElement.addEventListener("wheel",Q)},this.dispose=()=>{var e,t,r,o,i,a;null==(e=n.domElement)||e.removeEventListener("contextmenu",Z),null==(t=n.domElement)||t.removeEventListener("pointerdown",W),null==(r=n.domElement)||r.removeEventListener("pointercancel",Y),null==(o=n.domElement)||o.removeEventListener("wheel",Q),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointermove",X),null==(a=n.domElement)||a.ownerDocument.removeEventListener("pointerup",K),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",$)};const n=this,r={type:"change"},o={type:"start"},a={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=s.NONE;const u=1e-6,c=new i.r,d=new i.r;let f=1;const h=new i.c,p=new i.d,m=new i.d,g=new i.d,v=new i.d,y=new i.d,b=new i.d,x=new i.d,w=new i.d,S=new i.d,_=new i.c,E=new i.d;let A=!1;const T=[],P={};function C(){return Math.pow(.95,n.zoomSpeed)}function M(e){n.reverseOrbit||n.reverseHorizontalOrbit?d.theta+=e:d.theta-=e}function L(e){n.reverseOrbit||n.reverseVerticalOrbit?d.phi+=e:d.phi-=e}const I=(()=>{const e=new i.c;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),h.add(e)}})(),R=(()=>{const e=new i.c;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),h.add(e)}})(),k=(()=>{const e=new i.c;return function(t,r){const o=n.domElement;if(o&&n.object instanceof i.P&&n.object.isPerspectiveCamera){const i=n.object.position;e.copy(i).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),I(2*t*a/o.clientHeight,n.object.matrix),R(2*r*a/o.clientHeight,n.object.matrix)}else o&&n.object instanceof i.O&&n.object.isOrthographicCamera?(I(t*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),R(r*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function z(e){n.object instanceof i.P&&n.object.isPerspectiveCamera||n.object instanceof i.O&&n.object.isOrthographicCamera?f/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function N(e){n.object instanceof i.P&&n.object.isPerspectiveCamera||n.object instanceof i.O&&n.object.isOrthographicCamera?f*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function O(e){if(!n.zoomToCursor||!n.domElement)return;A=!0;const t=n.domElement.getBoundingClientRect(),r=e.clientX-t.left,o=e.clientY-t.top,i=t.width,a=t.height;E.x=r/i*2-1,E.y=-o/a*2+1,_.set(E.x,E.y,1).unproject(n.object).sub(n.object.position).normalize()}function j(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function B(e){p.set(e.clientX,e.clientY)}function D(e){v.set(e.clientX,e.clientY)}function U(){if(1==T.length)p.set(T[0].pageX,T[0].pageY);else{const e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);p.set(e,t)}}function F(){if(1==T.length)v.set(T[0].pageX,T[0].pageY);else{const e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);v.set(e,t)}}function H(){const e=T[0].pageX-T[1].pageX,t=T[0].pageY-T[1].pageY,n=Math.sqrt(e*e+t*t);x.set(0,n)}function V(e){if(1==T.length)m.set(e.pageX,e.pageY);else{const t=te(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);m.set(n,r)}g.subVectors(m,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(M(2*Math.PI*g.x/t.clientHeight),L(2*Math.PI*g.y/t.clientHeight)),p.copy(m)}function G(e){if(1==T.length)y.set(e.pageX,e.pageY);else{const t=te(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);y.set(n,r)}b.subVectors(y,v).multiplyScalar(n.panSpeed),k(b.x,b.y),v.copy(y)}function q(e){const t=te(e),r=e.pageX-t.x,o=e.pageY-t.y,i=Math.sqrt(r*r+o*o);w.set(0,i),S.set(0,Math.pow(w.y/x.y,n.zoomSpeed)),z(S.y),x.copy(w)}function W(e){var t,r;!1!==n.enabled&&(0===T.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",X),null==(r=n.domElement)||r.ownerDocument.addEventListener("pointerup",K)),function(e){T.push(e)}(e),"touch"===e.pointerType?function(e){switch(ee(e),T.length){case 1:switch(n.touches.ONE){case i.q.ROTATE:if(!1===n.enableRotate)return;U(),l=s.TOUCH_ROTATE;break;case i.q.PAN:if(!1===n.enablePan)return;F(),l=s.TOUCH_PAN;break;default:l=s.NONE}break;case 2:switch(n.touches.TWO){case i.q.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&H(),n.enablePan&&F(),l=s.TOUCH_DOLLY_PAN;break;case i.q.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&H(),n.enableRotate&&U(),l=s.TOUCH_DOLLY_ROTATE;break;default:l=s.NONE}break;default:l=s.NONE}l!==s.NONE&&n.dispatchEvent(o)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i.p.DOLLY:if(!1===n.enableZoom)return;(function(e){O(e),x.set(e.clientX,e.clientY)})(e),l=s.DOLLY;break;case i.p.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;D(e),l=s.PAN}else{if(!1===n.enableRotate)return;B(e),l=s.ROTATE}break;case i.p.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;B(e),l=s.ROTATE}else{if(!1===n.enablePan)return;D(e),l=s.PAN}break;default:l=s.NONE}l!==s.NONE&&n.dispatchEvent(o)}(e))}function X(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(ee(e),l){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;V(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;G(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;(function(e){n.enableZoom&&q(e),n.enablePan&&G(e)})(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;(function(e){n.enableZoom&&q(e),n.enableRotate&&V(e)})(e),n.update();break;default:l=s.NONE}}(e):function(e){if(!1!==n.enabled)switch(l){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),g.subVectors(m,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(M(2*Math.PI*g.x/t.clientHeight),L(2*Math.PI*g.y/t.clientHeight)),p.copy(m),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),S.subVectors(w,x),S.y>0?z(C()):S.y<0&&N(C()),x.copy(w),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){y.set(e.clientX,e.clientY),b.subVectors(y,v).multiplyScalar(n.panSpeed),k(b.x,b.y),v.copy(y),n.update()}(e)}}(e))}function K(e){var t,r,o;J(e),0===T.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointermove",X),null==(o=n.domElement)||o.ownerDocument.removeEventListener("pointerup",K)),n.dispatchEvent(a),l=s.NONE}function Y(e){J(e)}function Q(e){!1===n.enabled||!1===n.enableZoom||l!==s.NONE&&l!==s.ROTATE||(e.preventDefault(),n.dispatchEvent(o),function(e){O(e),e.deltaY<0?N(C()):e.deltaY>0&&z(C()),n.update()}(e),n.dispatchEvent(a))}function $(e){!1===n.enabled||!1===n.enablePan||function(e){let t=!1;switch(e.code){case n.keys.UP:k(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:k(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:k(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:k(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function Z(e){!1!==n.enabled&&e.preventDefault()}function J(e){delete P[e.pointerId];for(let t=0;t<T.length;t++)if(T[t].pointerId==e.pointerId)return void T.splice(t,1)}function ee(e){let t=P[e.pointerId];void 0===t&&(t=new i.d,P[e.pointerId]=t),t.set(e.pageX,e.pageY)}function te(e){const t=e.pointerId===T[0].pointerId?T[1]:T[0];return P[t.pointerId]}void 0!==t&&this.connect(t),this.update()}};class Bt extends i.u{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Gt(e)}),this.register(function(e){return new Zt(e)}),this.register(function(e){return new Jt(e)}),this.register(function(e){return new en(e)}),this.register(function(e){return new Wt(e)}),this.register(function(e){return new Xt(e)}),this.register(function(e){return new Kt(e)}),this.register(function(e){return new Yt(e)}),this.register(function(e){return new Vt(e)}),this.register(function(e){return new Qt(e)}),this.register(function(e){return new qt(e)}),this.register(function(e){return new $t(e)}),this.register(function(e){return new Ft(e)}),this.register(function(e){return new tn(e)}),this.register(function(e){return new nn(e)})}load(e,t,n,r){const o=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:i.v.extractUrlBase(e),this.manager.itemStart(e);const s=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new i.F(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(n){try{o.parse(n,a,function(n){t(n),o.manager.itemEnd(e)},s)}catch(r){s(r)}},n,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let o;const a={},s={};if("string"==typeof e)o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(i.v.decodeText(new Uint8Array(e.slice(0,4)))===rn){try{a[Ut.KHR_BINARY_GLTF]=new sn(e)}catch(u){return void(r&&r(u))}o=JSON.parse(a[Ut.KHR_BINARY_GLTF].content)}else o=JSON.parse(i.v.decodeText(new Uint8Array(e)));else o=e;if(void 0===o.asset||o.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new kn(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let i=0;i<this.pluginCallbacks.length;i++){const e=this.pluginCallbacks[i](l);s[e.name]=e,a[e.name]=!0}if(o.extensionsUsed)for(let i=0;i<o.extensionsUsed.length;++i){const e=o.extensionsUsed[i],t=o.extensionsRequired||[];switch(e){case Ut.KHR_MATERIALS_UNLIT:a[e]=new Ht;break;case Ut.KHR_DRACO_MESH_COMPRESSION:a[e]=new ln(o,this.dracoLoader);break;case Ut.KHR_TEXTURE_TRANSFORM:a[e]=new un;break;case Ut.KHR_MESH_QUANTIZATION:a[e]=new cn;break;default:t.indexOf(e)>=0&&void 0===s[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(a),l.setPlugins(s),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,o){n.parse(e,t,r,o)})}}function Dt(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Ut={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ft{constructor(e){this.parser=e,this.name=Ut.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let s;const l=new i.i(16777215);void 0!==a.color&&l.fromArray(a.color);const u=void 0!==a.range?a.range:0;switch(a.type){case"directional":s=new i.D(l),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new i.y(l),s.distance=u;break;case"spot":s=new i.x(l),s.distance=u,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,s.angle=a.spot.outerConeAngle,s.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return s.position.set(0,0,0),s.decay=2,Pn(s,a),void 0!==a.intensity&&(s.intensity=a.intensity),s.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(s),t.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then(function(e){return n._getNodeRef(t.cache,o,e)})}}class Ht{constructor(){this.name=Ut.KHR_MATERIALS_UNLIT}getMaterialType(){return i.aa}extendParams(e,t,n){const r=[];e.color=new i.i(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const t=o.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==o.baseColorTexture&&r.push(n.assignTexture(e,"map",o.baseColorTexture,3001))}return Promise.all(r)}}class Vt{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return void 0!==r&&(t.emissiveIntensity=r),Promise.resolve()}}class Gt{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.w:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&o.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(o.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.d(e,e)}return Promise.all(o)}}class qt{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.w:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],i=r.extensions[this.name];return void 0!==i.iridescenceFactor&&(t.iridescence=i.iridescenceFactor),void 0!==i.iridescenceTexture&&o.push(n.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),void 0!==i.iridescenceIor&&(t.iridescenceIOR=i.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==i.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),void 0!==i.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),void 0!==i.iridescenceThicknessTexture&&o.push(n.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(o)}}class Wt{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.w:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new i.i(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=r.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&o.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,3001)),void 0!==a.sheenRoughnessTexture&&o.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(o)}}class Xt{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.w:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],i=r.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&o.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(o)}}class Kt{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.w:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&o.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const s=a.attenuationColor||[1,1,1];return t.attenuationColor=new i.i(s[0],s[1],s[2]),Promise.all(o)}}class Yt{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.w:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class Qt{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.w:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&o.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const s=a.specularColorFactor||[1,1,1];return t.specularColor=new i.i(s[0],s[1],s[2]),void 0!==a.specularColorTexture&&o.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,3001)),Promise.all(o)}}class $t{constructor(e){this.parser=e,this.name=Ut.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.w:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],i=r.extensions[this.name];return void 0!==i.anisotropyStrength&&(t.anisotropy=i.anisotropyStrength),void 0!==i.anisotropyRotation&&(t.anisotropyRotation=i.anisotropyRotation),void 0!==i.anisotropyTexture&&o.push(n.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(o)}}class Zt{constructor(e){this.parser=e,this.name=Ut.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=r.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,i)}}class Jt{constructor(e){this.parser=e,this.name=Ut.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=o.extensions[t],a=r.images[i.source];let s=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(s=e)}return this.detectSupport().then(function(o){if(o)return n.loadTextureImage(e,i.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class en{constructor(e){this.parser=e,this.name=Ut.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=o.extensions[t],a=r.images[i.source];let s=n.textureLoader;if(a.uri){const e=n.options.manager.getHandler(a.uri);null!==e&&(s=e)}return this.detectSupport().then(function(o){if(o)return n.loadTextureImage(e,i.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class tn{constructor(e){this.name=Ut.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(t){const n=e.byteOffset||0,r=e.byteLength||0,i=e.count,a=e.byteStride,s=new Uint8Array(t,n,r);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(i,a,s,e.mode,e.filter).then(function(e){return e.buffer}):o.ready.then(function(){const t=new ArrayBuffer(i*a);return o.decodeGltfBuffer(new Uint8Array(t),i,a,s,e.mode,e.filter),t})})}return null}}class nn{constructor(e){this.name=Ut.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const r=t.meshes[n.mesh];for(const i of r.primitives)if(i.mode!==pn.TRIANGLES&&i.mode!==pn.TRIANGLE_STRIP&&i.mode!==pn.TRIANGLE_FAN&&void 0!==i.mode)return null;const o=n.extensions[this.name].attributes,a=[],s={};for(const i in o)a.push(this.parser.getDependency("accessor",o[i]).then(e=>(s[i]=e,s[i])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],r=e[0].count,o=[];for(const a of n){const e=new i.k,t=new i.c,n=new i.Q,l=new i.c(1,1,1),u=new i.I(a.geometry,a.material,r);for(let o=0;o<r;o++)s.TRANSLATION&&t.fromBufferAttribute(s.TRANSLATION,o),s.ROTATION&&n.fromBufferAttribute(s.ROTATION,o),s.SCALE&&l.fromBufferAttribute(s.SCALE,o),u.setMatrixAt(o,e.compose(t,n,l));for(const r in s)"TRANSLATION"!==r&&"ROTATION"!==r&&"SCALE"!==r&&a.geometry.setAttribute(r,s[r]);i.z.prototype.copy.call(u,a),this.parser.assignFinalMaterial(u),o.push(u)}return t.isGroup?(t.clear(),t.add(...o),t):o[0]}))}}const rn="glTF",on=1313821514,an=5130562;class sn{constructor(e){this.name=Ut.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:i.v.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==rn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let o=0;for(;o<n;){const t=r.getUint32(o,!0);o+=4;const n=r.getUint32(o,!0);if(o+=4,n===on){const n=new Uint8Array(e,12+o,t);this.content=i.v.decodeText(n)}else if(n===an){const n=12+o;this.body=e.slice(n,n+t)}o+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ln{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ut.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},s={},l={};for(const u in i){const e=bn[u]||u.toLowerCase();a[e]=i[u]}for(const u in e.attributes){const t=bn[u]||u.toLowerCase();if(void 0!==i[u]){const r=n.accessors[e.attributes[u]],o=mn[r.componentType];l[t]=o.name,s[t]=!0===r.normalized}}return t.getDependency("bufferView",o).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],r=s[t];void 0!==r&&(n.normalized=r)}t(e)},a,l)})})}}class un{constructor(){this.name=Ut.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class cn{constructor(){this.name=Ut.KHR_MESH_QUANTIZATION}}class dn extends i.at{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let i=0;i!==r;i++)t[i]=n[o+i];return t}interpolate_(e,t,n,r){const o=this.resultBuffer,i=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,u=r-t,c=(n-t)/u,d=c*c,f=d*c,h=e*l,p=h-l,m=-2*f+3*d,g=f-d,v=1-m,y=g-d+c;for(let b=0;b!==a;b++){const e=i[p+b+a],t=i[p+b+s]*u,n=i[h+b+a],r=i[h+b]*u;o[b]=v*e+y*t+m*n+g*r}return o}}const fn=new i.Q;class hn extends dn{interpolate_(e,t,n,r){const o=super.interpolate_(e,t,n,r);return fn.fromArray(o).normalize().toArray(o),o}}const pn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},mn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},gn={9728:i.a2,9729:i.a1,9984:i.a0,9985:i.$,9986:i.Z,9987:i.Y},vn={33071:i.a5,33648:i.a4,10497:i.a3},yn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Lt>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},xn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},wn={CUBICSPLINE:void 0,LINEAR:i.al,STEP:i.ak},Sn="OPAQUE",_n="MASK",En="BLEND";function An(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new i.a8({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.as})),e.DefaultMaterial}function Tn(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function Pn(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Cn(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Mn(e){let t;const n=e.extensions&&e.extensions[Ut.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+Ln(n.attributes):e.indices+":"+Ln(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,o=e.targets.length;r<o;r++)t+=":"+Ln(e.targets[r]);return t}function Ln(e){let t="";const n=Object.keys(e).sort();for(let r=0,o=n.length;r<o;r++)t+=n[r]+":"+e[n[r]]+";";return t}function In(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Rn=new i.k;class kn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Dt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,o=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,o=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&o<98?this.textureLoader=new i.H(this.options.manager):this.textureLoader=new i.J(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new i.F(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};Tn(o,i,r),Pn(i,r),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(i)})).then(function(){e(i)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,o=t.length;r<o;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let r=0,o=e.length;r<o;r++){const t=e[r];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),o=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[r,i]of e.children.entries())o(i,t.children[r])};return o(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const o=e(t[r]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Ut.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(e,o){n.load(i.v.resolveURL(t.uri,r.path),e,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const e=yn[r.type],t=mn[r.componentType],n=!0===r.normalized,o=new t(r.count*e);return Promise.resolve(new i.K(o,e,n))}const o=[];return void 0!==r.bufferView?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),void 0!==r.sparse&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(e){const o=e[0],a=yn[r.type],s=mn[r.componentType],l=s.BYTES_PER_ELEMENT,u=l*a,c=r.byteOffset||0,d=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;let h,p;if(d&&d!==u){const e=Math.floor(c/d),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let u=t.cache.get(n);u||(h=new s(o,e*d,r.count*d/l),u=new i.X(h,d/l),t.cache.add(n,u)),p=new i.ao(u,a,c%d/l,f)}else h=null===o?new s(r.count*a):new s(o,c,r.count*a),p=new i.K(h,a,f);if(void 0!==r.sparse){const t=yn.SCALAR,n=mn[r.sparse.indices.componentType],l=r.sparse.indices.byteOffset||0,u=r.sparse.values.byteOffset||0,c=new n(e[1],l,r.sparse.count*t),d=new s(e[2],u,r.sparse.count*a);null!==o&&(p=new i.K(p.array.slice(),p.itemSize,p.normalized));for(let e=0,r=c.length;e<r;e++){const t=c[e];if(p.setX(t,d[e*a]),a>=2&&p.setY(t,d[e*a+1]),a>=3&&p.setZ(t,d[e*a+2]),a>=4&&p.setW(t,d[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let i=this.textureLoader;if(o.uri){const e=n.manager.getHandler(o.uri);null!==e&&(i=e)}return this.loadTextureImage(e,r,i)}loadTextureImage(e,t,n){const r=this,o=this.json,a=o.textures[e],s=o.images[t],l=(s.uri||s.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const u=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=a.name||s.name||"",""===t.name&&"string"==typeof s.uri&&!1===s.uri.startsWith("data:image/")&&(t.name=s.uri);const n=(o.samplers||{})[a.sampler]||{};return t.magFilter=gn[n.magFilter]||i.a1,t.minFilter=gn[n.minFilter]||i.Y,t.wrapS=vn[n.wrapS]||i.a3,t.wrapT=vn[n.wrapT]||i.a3,r.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(e,t){const n=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const o=n.images[e],a=self.URL||self.webkitURL;let s=o.uri||"",l=!1;if(void 0!==o.bufferView)s=this.getDependency("bufferView",o.bufferView).then(function(e){l=!0;const t=new Blob([e],{type:o.mimeType});return s=a.createObjectURL(t),s});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(s).then(function(e){return new Promise(function(n,o){let a=n;!0===t.isImageBitmapLoader&&(a=function(e){const t=new i.T(e);t.needsUpdate=!0,n(t)}),t.load(i.v.resolveURL(e,r.path),a,void 0,o)})}).then(function(e){return!0===l&&a.revokeObjectURL(s),e.userData.mimeType=o.mimeType||((t=o.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e;var t}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",s),e});return this.sourceCache[e]=u,u}assignTexture(e,t,n,r){const o=this;return this.getDependency("texture",n.index).then(function(i){if(!i)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((i=i.clone()).channel=n.texCoord),o.extensions[Ut.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Ut.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=o.associations.get(i);i=o.extensions[Ut.KHR_TEXTURE_TRANSFORM].extendTexture(i,e),o.associations.set(i,t)}}return void 0!==r&&("colorSpace"in i?i.colorSpace=3001===r?"srgb":"srgb-linear":i.encoding=r),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,o=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new i.a6,i.M.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new i.a7,i.M.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(r||o||a){let e="ClonedMaterial:"+n.uuid+":";r&&(e+="derivative-tangents:"),o&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),o&&(t.vertexColors=!0),a&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return i.a8}loadMaterial(e){const t=this,n=this.json,r=this.extensions,o=n.materials[e];let a;const s={},l=[];if((o.extensions||{})[Ut.KHR_MATERIALS_UNLIT]){const e=r[Ut.KHR_MATERIALS_UNLIT];a=e.getMaterialType(),l.push(e.extendParams(s,o,t))}else{const n=o.pbrMetallicRoughness||{};if(s.color=new i.i(1,1,1),s.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;s.color.fromArray(e),s.opacity=e[3]}void 0!==n.baseColorTexture&&l.push(t.assignTexture(s,"map",n.baseColorTexture,3001)),s.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,s.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(t.assignTexture(s,"metalnessMap",n.metallicRoughnessTexture)),l.push(t.assignTexture(s,"roughnessMap",n.metallicRoughnessTexture))),a=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)})))}!0===o.doubleSided&&(s.side=i.a9);const u=o.alphaMode||Sn;if(u===En?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,u===_n&&(s.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&a!==i.aa&&(l.push(t.assignTexture(s,"normalMap",o.normalTexture)),s.normalScale=new i.d(1,1),void 0!==o.normalTexture.scale)){const e=o.normalTexture.scale;s.normalScale.set(e,e)}return void 0!==o.occlusionTexture&&a!==i.aa&&(l.push(t.assignTexture(s,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(s.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&a!==i.aa&&(s.emissive=(new i.i).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&a!==i.aa&&l.push(t.assignTexture(s,"emissiveMap",o.emissiveTexture,3001)),Promise.all(l).then(function(){const n=new a(s);return o.name&&(n.name=o.name),Pn(n,o),t.associations.set(n,{materials:e}),o.extensions&&Tn(r,n,o),n})}createUniqueName(e){const t=i.ab.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function o(e){return n[Ut.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return zn(n,e,t)})}const a=[];for(let s=0,l=e.length;s<l;s++){const n=e[s],l=Mn(n),u=r[l];if(u)a.push(u.promise);else{let e;e=n.extensions&&n.extensions[Ut.KHR_DRACO_MESH_COMPRESSION]?o(n):zn(new i.f,n,t),r[l]={primitive:n,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,r=this.extensions,o=n.meshes[e],a=o.primitives,s=[];for(let i=0,l=a.length;i<l;i++){const e=void 0===a[i].material?An(this.cache):this.getDependency("material",a[i].material);s.push(e)}return s.push(t.loadGeometries(a)),Promise.all(s).then(function(n){const s=n.slice(0,n.length-1),l=n[n.length-1],u=[];for(let d=0,f=l.length;d<f;d++){const n=l[d],c=a[d];let f;const h=s[d];if(c.mode===pn.TRIANGLES||c.mode===pn.TRIANGLE_STRIP||c.mode===pn.TRIANGLE_FAN||void 0===c.mode)f=!0===o.isSkinnedMesh?new i.ac(n,h):new i.ad(n,h),!0===f.isSkinnedMesh&&f.normalizeSkinWeights(),c.mode===pn.TRIANGLE_STRIP?f.geometry=Mt(f.geometry,i.n):c.mode===pn.TRIANGLE_FAN&&(f.geometry=Mt(f.geometry,i.m));else if(c.mode===pn.LINES)f=new i.ae(n,h);else if(c.mode===pn.LINE_STRIP)f=new i.af(n,h);else if(c.mode===pn.LINE_LOOP)f=new i.ag(n,h);else{if(c.mode!==pn.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);f=new i.ah(n,h)}Object.keys(f.geometry.morphAttributes).length>0&&Cn(f,o),f.name=t.createUniqueName(o.name||"mesh_"+e),Pn(f,o),c.extensions&&Tn(r,f,c),t.assignFinalMaterial(f),u.push(f)}for(let r=0,o=u.length;r<o;r++)t.associations.set(u[r],{meshes:e,primitives:r});if(1===u.length)return o.extensions&&Tn(r,u[0],o),u[0];const c=new i.G;o.extensions&&Tn(r,c,o),t.associations.set(c,{meshes:e});for(let e=0,t=u.length;e<t;e++)c.add(u[e]);return c})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new i.P(i.ai.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new i.O(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Pn(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,o=t.joints.length;r<o;r++)n.push(this._loadNodeShallow(t.joints[r]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const n=e.pop(),r=e,o=[],a=[];for(let s=0,l=r.length;s<l;s++){const e=r[s];if(e){o.push(e);const t=new i.k;null!==n&&t.fromArray(n.array,16*s),a.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[s])}return new i.aj(o,a)})}loadAnimation(e){const t=this.json.animations[e],n=t.name?t.name:"animation_"+e,r=[],o=[],a=[],s=[],l=[];for(let i=0,u=t.channels.length;i<u;i++){const e=t.channels[i],n=t.samplers[e.sampler],u=e.target,c=u.node,d=void 0!==t.parameters?t.parameters[n.input]:n.input,f=void 0!==t.parameters?t.parameters[n.output]:n.output;void 0!==u.node&&(r.push(this.getDependency("node",c)),o.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",f)),s.push(n),l.push(u))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(s),Promise.all(l)]).then(function(e){const t=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=[];for(let n=0,u=t.length;n<u;n++){const e=t[n],u=r[n],c=o[n],d=a[n],f=s[n];if(void 0===e)continue;let h;switch(e.updateMatrix(),xn[f.path]){case xn.weights:h=i.ar;break;case xn.rotation:h=i.aq;break;default:h=i.ap}const p=e.name?e.name:e.uuid,m=void 0!==d.interpolation?wn[d.interpolation]:i.al,g=[];xn[f.path]===xn.weights?e.traverse(function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)}):g.push(p);let v=c.array;if(c.normalized){const e=In(v.constructor),t=new Float32Array(v.length);for(let n=0,r=v.length;n<r;n++)t[n]=v[n]*e;v=t}for(let t=0,n=g.length;t<n;t++){const e=new h(g[t]+"."+xn[f.path],u.array,v,m);"CUBICSPLINE"===d.interpolation&&(e.createInterpolant=function(e){return new(this instanceof i.aq?hn:dn)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}return new i.am(n,void 0,l)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],r=t._loadNodeShallow(e),o=[],i=n.children||[];for(let s=0,l=i.length;s<l;s++)o.push(t.getDependency("node",i[s]));const a=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([r,Promise.all(o),a]).then(function(e){const t=e[0],n=e[1],r=e[2];null!==r&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(r,Rn)});for(let o=0,i=n.length;o<i;o++)t.add(n[o]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const o=t.nodes[e],a=o.name?r.createUniqueName(o.name):"",s=[],l=r._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return l&&s.push(l),void 0!==o.camera&&s.push(r.getDependency("camera",o.camera).then(function(e){return r._getNodeRef(r.cameraCache,o.camera,e)})),r._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){s.push(e)}),this.nodeCache[e]=Promise.all(s).then(function(t){let s;if(s=!0===o.isBone?new i.an:t.length>1?new i.G:1===t.length?t[0]:new i.z,s!==t[0])for(let e=0,n=t.length;e<n;e++)s.add(t[e]);if(o.name&&(s.userData.name=o.name,s.name=a),Pn(s,o),o.extensions&&Tn(n,s,o),void 0!==o.matrix){const e=new i.k;e.fromArray(o.matrix),s.applyMatrix4(e)}else void 0!==o.translation&&s.position.fromArray(o.translation),void 0!==o.rotation&&s.quaternion.fromArray(o.rotation),void 0!==o.scale&&s.scale.fromArray(o.scale);return r.associations.has(s)||r.associations.set(s,{}),r.associations.get(s).nodes=e,s}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,o=new i.G;n.name&&(o.name=r.createUniqueName(n.name)),Pn(o,n),n.extensions&&Tn(t,o,n);const a=n.nodes||[],s=[];for(let i=0,l=a.length;i<l;i++)s.push(r.getDependency("node",a[i]));return Promise.all(s).then(function(e){for(let t=0,n=e.length;t<n;t++)o.add(e[t]);return r.associations=(e=>{const t=new Map;for(const[n,o]of r.associations)(n instanceof i.M||n instanceof i.T)&&t.set(n,o);return e.traverse(e=>{const n=r.associations.get(e);null!=n&&t.set(e,n)}),t})(o),o})}}function zn(e,t,n){const r=t.attributes,o=[];function a(t,r){return n.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(const i in r){const t=bn[i]||i.toLowerCase();t in e.attributes||o.push(a(r[i],t))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(r)}return Pn(e,t),function(e,t,n){const r=t.attributes,o=new i.au;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new i.c(t[0],t[1],t[2]),new i.c(a[0],a[1],a[2])),e.normalized){const t=In(mn[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new i.c,t=new i.c;for(let r=0,o=a.length;r<o;r++){const o=a[r];if(void 0!==o.POSITION){const r=n.json.accessors[o.POSITION],i=r.min,a=r.max;if(void 0!==i&&void 0!==a){if(t.setX(Math.max(Math.abs(i[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(i[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(i[2]),Math.abs(a[2]))),r.normalized){const e=In(mn[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;const s=new i.av;o.getCenter(s.center),s.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=s}(e,t,n),Promise.all(o).then(function(){return void 0!==t.targets?function(e,t,n){let r=!1,o=!1,i=!1;for(let u=0,c=t.length;u<c;u++){const e=t[u];if(void 0!==e.POSITION&&(r=!0),void 0!==e.NORMAL&&(o=!0),void 0!==e.COLOR_0&&(i=!0),r&&o&&i)break}if(!r&&!o&&!i)return Promise.resolve(e);const a=[],s=[],l=[];for(let u=0,c=t.length;u<c;u++){const c=t[u];if(r){const t=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;a.push(t)}if(o){const t=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;s.push(t)}if(i){const t=void 0!==c.COLOR_0?n.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(l)]).then(function(t){const n=t[0],a=t[1],s=t[2];return r&&(e.morphAttributes.position=n),o&&(e.morphAttributes.normal=a),i&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}var Nn=Object.defineProperty,On=(e,t,n)=>(((e,t,n)=>{t in e?Nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const jn={DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"},Bn={BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"},Dn={TOUCHPAD:"touchpad"},Un=.05,Fn=.1,Hn={TRANSFORM:"transform",VISIBILITY:"visibility"};async function Vn(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function Gn(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const o=await async function(e){if(!e)throw new Error("No basePath supplied");return await Vn(`${e}/profilesList.json`)}(t);let i;if(e.profiles.some(e=>{const n=o[e];return n&&(i={profileId:e,profilePath:`${t}/${n.path}`,deprecated:!!n.deprecated}),!!i}),!i){if(!n)throw new Error("No matching profile name found");const e=o[n];if(!e)throw new Error(`No matching profile name found and default profile "${n}" missing.`);i={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const a=await Vn(i.profilePath);let s;if(r){let t;if(t="any"===e.handedness?a.layouts[Object.keys(a.layouts)[0]]:a.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${i.profileId}`);t.assetPath&&(s=i.profilePath.replace("profile.json",t.assetPath))}return{profile:a,assetPath:s}}const qn={xAxis:0,yAxis:0,button:0,state:jn.DEFAULT};class Wn{constructor(e){On(this,"value"),On(this,"componentProperty"),On(this,"states"),On(this,"valueNodeName"),On(this,"valueNodeProperty"),On(this,"minNodeName"),On(this,"maxNodeName"),On(this,"valueNode"),On(this,"minNode"),On(this,"maxNode"),this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Hn.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(qn)}updateFromComponent(e){let{xAxis:t,yAxis:n,button:r,state:o}=e;const{normalizedXAxis:i,normalizedYAxis:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e,r=t;if(Math.sqrt(e*e+t*t)>1){const o=Math.atan2(t,e);n=Math.cos(o),r=Math.sin(o)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*r+.5}}(t,n);switch(this.componentProperty){case Bn.X_AXIS:this.value=this.states.includes(o)?i:.5;break;case Bn.Y_AXIS:this.value=this.states.includes(o)?a:.5;break;case Bn.BUTTON:this.value=this.states.includes(o)&&r?r:0;break;case Bn.STATE:this.valueNodeProperty===Hn.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Xn{constructor(e,t){if(On(this,"id"),On(this,"values"),On(this,"type"),On(this,"gamepadIndices"),On(this,"rootNodeName"),On(this,"visualResponses"),On(this,"touchPointNodeName"),On(this,"touchPointNode"),!e||!t||!t.visualResponses||!t.gamepadIndices||0===Object.keys(t.gamepadIndices).length)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(e=>{const n=new Wn(t.visualResponses[e]);this.visualResponses[e]=n}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:jn.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=jn.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=jn.PRESSED:(t.touched||this.values.button>Un)&&(this.values.state=jn.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===jn.DEFAULT&&Math.abs(this.values.xAxis)>Fn&&(this.values.state=jn.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===jn.DEFAULT&&Math.abs(this.values.yAxis)>Fn&&(this.values.state=jn.TOUCHED)),Object.values(this.visualResponses).forEach(e=>{e.updateFromComponent(this.values)})}}class Kn{constructor(e,t,n){if(On(this,"xrInputSource"),On(this,"assetUrl"),On(this,"layoutDescription"),On(this,"id"),On(this,"components"),!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");if(!t.layouts[e.handedness])throw new Error("No layout for "+e.handedness+" handedness");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(e=>{const t=this.layoutDescription.components[e];this.components[e]=new Xn(e,t)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const Yn=new i.au,Qn=new i.c;class $n extends i.aw{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new i.ax([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new i.ax([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new i.ay(t,6,1);return this.setAttribute("instanceStart",new i.ao(n,3,0)),this.setAttribute("instanceEnd",new i.ao(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new i.ay(t,2*n,1);return this.setAttribute("instanceColorStart",new i.ao(r,n,0)),this.setAttribute("instanceColorEnd",new i.ao(r,n,n)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new i.az(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new i.au);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),Yn.setFromBufferAttribute(t),this.boundingBox.union(Yn))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new i.av),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let o=0,i=e.count;o<i;o++)Qn.fromBufferAttribute(e,o),r=Math.max(r,n.distanceToSquared(Qn)),Qn.fromBufferAttribute(t,o),r=Math.max(r,n.distanceToSquared(Qn));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class Zn extends $n{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const n=e.length-t,r=new Float32Array(2*n);if(3===t)for(let o=0;o<n;o+=t)r[2*o]=e[o],r[2*o+1]=e[o+1],r[2*o+2]=e[o+2],r[2*o+3]=e[o+3],r[2*o+4]=e[o+4],r[2*o+5]=e[o+5];else for(let o=0;o<n;o+=t)r[2*o]=e[o],r[2*o+1]=e[o+1],r[2*o+2]=e[o+2],r[2*o+3]=e[o+3],r[2*o+4]=e[o+4],r[2*o+5]=e[o+5],r[2*o+6]=e[o+6],r[2*o+7]=e[o+7];return super.setColors(r,t),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Jn extends i.aA{constructor(e){super({type:"LineMaterial",uniforms:i.aB.clone(i.aB.merge([i.aC.common,i.aC.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new i.d(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\t\tuniform float linewidth;\n\t\t\t\tuniform vec2 resolution;\n\n\t\t\t\tattribute vec3 instanceStart;\n\t\t\t\tattribute vec3 instanceEnd;\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t\tattribute vec4 instanceColorStart;\n\t\t\t\t\t\tattribute vec4 instanceColorEnd;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t\tattribute vec3 instanceColorStart;\n\t\t\t\t\t\tattribute vec3 instanceColorEnd;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashScale;\n\t\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#endif\n\n\t\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t\t// conservative estimate of the near plane\n\t\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\t\tvLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t\t// camera space\n\t\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// clip space\n\t\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t\t// ndc space\n\t\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t\t// direction\n\t\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\t\tdir.x *= aspect;\n\t\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\t\tvec3 offset;\n\t\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t\t// set the world position\n\t\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t\t// project the worldpos\n\t\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t\t// select end\n\t\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t\t// back to clip space\n\t\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tgl_Position = clip;\n\n\t\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:`\n\t\t\t\tuniform vec3 diffuse;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform float linewidth;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashOffset;\n\t\t\t\t\tuniform float dashSize;\n\t\t\t\t\tuniform float gapSize;\n\n\t\t\t\t#endif\n\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\t\tfloat mua;\n\t\t\t\t\tfloat mub;\n\n\t\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\t\tmua = numer / denom;\n\t\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\t\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\t\tdiffuseColor *= vLineColor;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tdiffuseColor.rgb *= vLineColor;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\t\t\tgl_FragColor = diffuseColor;\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <${parseInt(i.o.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\t\t\t`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(e){!!e!="USE_DASH"in this.defines&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(e){!!e!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const er=new i.c,tr=new i.c,nr=new i.aD,rr=new i.aD,or=new i.aD,ir=new i.c,ar=new i.k,sr=new i.aE,lr=new i.c,ur=new i.au,cr=new i.av,dr=new i.aD;let fr,hr,pr,mr;function gr(e,t,n){return dr.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),dr.multiplyScalar(1/dr.w),dr.x=mr/n.width,dr.y=mr/n.height,dr.applyMatrix4(e.projectionMatrixInverse),dr.multiplyScalar(1/dr.w),Math.abs(Math.max(dr.x,dr.y))}class vr extends i.ad{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new $n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jn({color:16777215*Math.random()})),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let i=0,a=0,s=t.count;i<s;i++,a+=2)er.fromBufferAttribute(t,i),tr.fromBufferAttribute(n,i),r[a]=0===a?0:r[a-1],r[a+1]=r[a]+er.distanceTo(tr);const o=new i.ay(r,2,1);return e.setAttribute("instanceDistanceStart",new i.ao(o,1,0)),e.setAttribute("instanceDistanceEnd",new i.ao(o,1,1)),this}raycast(e,t){const n=this.material.worldUnits,r=e.camera;null===r&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=void 0!==e.params.Line2&&e.params.Line2.threshold||0;fr=e.ray;const a=this.matrixWorld,s=this.geometry,l=this.material;let u,c;if(mr=l.linewidth+o,hr=s.attributes.instanceStart,pr=s.attributes.instanceEnd,null===s.boundingSphere&&s.computeBoundingSphere(),cr.copy(s.boundingSphere).applyMatrix4(a),n)u=.5*mr;else{u=gr(r,Math.max(r.near,cr.distanceToPoint(fr.origin)),l.resolution)}if(cr.radius+=u,!1!==fr.intersectsSphere(cr)){if(null===s.boundingBox&&s.computeBoundingBox(),ur.copy(s.boundingBox).applyMatrix4(a),n)c=.5*mr;else{c=gr(r,Math.max(r.near,ur.distanceToPoint(fr.origin)),l.resolution)}ur.expandByScalar(c),!1!==fr.intersectsBox(ur)&&(n?function(e,t){for(let n=0,r=hr.count;n<r;n++){sr.start.fromBufferAttribute(hr,n),sr.end.fromBufferAttribute(pr,n);const r=new i.c,o=new i.c;fr.distanceSqToSegment(sr.start,sr.end,o,r),o.distanceTo(r)<.5*mr&&t.push({point:o,pointOnLine:r,distance:fr.origin.distanceTo(o),object:e,face:null,faceIndex:n,uv:null,uv2:null})}}(this,t):function(e,t,n){const r=t.projectionMatrix,o=e.material.resolution,a=e.matrixWorld,s=e.geometry,l=s.attributes.instanceStart,u=s.attributes.instanceEnd,c=-t.near;fr.at(1,or),or.w=1,or.applyMatrix4(t.matrixWorldInverse),or.applyMatrix4(r),or.multiplyScalar(1/or.w),or.x*=o.x/2,or.y*=o.y/2,or.z=0,ir.copy(or),ar.multiplyMatrices(t.matrixWorldInverse,a);for(let d=0,f=l.count;d<f;d++){if(nr.fromBufferAttribute(l,d),rr.fromBufferAttribute(u,d),nr.w=1,rr.w=1,nr.applyMatrix4(ar),rr.applyMatrix4(ar),nr.z>c&&rr.z>c)continue;if(nr.z>c){const e=nr.z-rr.z,t=(nr.z-c)/e;nr.lerp(rr,t)}else if(rr.z>c){const e=rr.z-nr.z,t=(rr.z-c)/e;rr.lerp(nr,t)}nr.applyMatrix4(r),rr.applyMatrix4(r),nr.multiplyScalar(1/nr.w),rr.multiplyScalar(1/rr.w),nr.x*=o.x/2,nr.y*=o.y/2,rr.x*=o.x/2,rr.y*=o.y/2,sr.start.copy(nr),sr.start.z=0,sr.end.copy(rr),sr.end.z=0;const t=sr.closestPointToPointParameter(ir,!0);sr.at(t,lr);const s=i.ai.lerp(nr.z,rr.z,t),f=s>=-1&&s<=1,h=ir.distanceTo(lr)<.5*mr;if(f&&h){sr.start.fromBufferAttribute(l,d),sr.end.fromBufferAttribute(u,d),sr.start.applyMatrix4(a),sr.end.applyMatrix4(a);const t=new i.c,r=new i.c;fr.distanceSqToSegment(sr.start,sr.end,r,t),n.push({point:r,pointOnLine:t,distance:fr.origin.distanceTo(r),object:e,face:null,faceIndex:d,uv:null,uv2:null})}}}(this,r,t))}}}class yr extends vr{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Zn,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jn({color:16777215*Math.random()})),this.isLine2=!0,this.type="Line2"}}const br=e=>"envMap"in e,xr=(e,t)=>{e.envMap=t,e.needsUpdate=!0},wr=(e,t)=>{t instanceof i.ad&&(Array.isArray(t.material)?t.material.forEach(t=>br(t)?xr(t,e):void 0):br(t.material)&&xr(t.material,e))},Sr=e=>"envMapIntensity"in e,_r=(e,t)=>{e.envMapIntensity=t,e.needsUpdate=!0},Er=(e,t)=>{t instanceof i.ad&&(Array.isArray(t.material)?t.material.forEach(t=>Sr(t)?_r(t,e):void 0):Sr(t.material)&&_r(t.material,e))};function Ar(e,t){(function(e,t){Object.values(e.components).forEach(e=>{const{type:n,touchPointNodeName:r,visualResponses:o}=e;if(n===Dn.TOUCHPAD&&r)if(e.touchPointNode=t.getObjectByName(r),e.touchPointNode){const t=new i.aF(.001),n=new i.aa({color:255}),r=new i.ad(t,n);e.touchPointNode.add(r)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(o).forEach(e=>{const{valueNodeName:n,minNodeName:r,maxNodeName:o,valueNodeProperty:i}=e;if(i===Hn.TRANSFORM&&r&&o){if(e.minNode=t.getObjectByName(r),e.maxNode=t.getObjectByName(o),!e.minNode)return void console.warn(`Could not find ${r} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${o} in the model`)}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn(`Could not find ${n} in the model`)})})})(e.motionController,t),(e.envMap||null!=e.envMapIntensity)&&t.traverse(t=>{e.envMap&&wr(e.envMap,t),null!=e.envMapIntensity&&Er(e.envMapIntensity,t)}),e.add(t)}class Tr extends i.G{constructor(){super(),this.motionController=null,this.envMap=null,this.envMapIntensity=1,this.scene=null}setEnvironmentMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var n;return this.envMap===e&&this.envMapIntensity===t||(this.envMap=e,this.envMapIntensity=t,null==(n=this.scene)||n.traverse(n=>{wr(e,n),Er(t,n)})),this}setEnvironmentMapIntensity(e){var t;return this.envMapIntensity===e||(this.envMapIntensity=e,null==(t=this.scene)||t.traverse(t=>Er(e,t))),this}connectModel(e){this.motionController?(this.scene=e,Ar(this,e),this.dispatchEvent({type:"modelconnected",data:e})):console.warn("scene tried to add, but no motion controller")}connectMotionController(e){this.motionController=e,this.dispatchEvent({type:"motionconnected",data:e})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(e=>{Object.values(e.visualResponses).forEach(e=>{const{valueNode:t,minNode:n,maxNode:r,value:o,valueNodeProperty:i}=e;t&&(i===Hn.VISIBILITY&&"boolean"==typeof o?t.visible=o:i===Hn.TRANSFORM&&n&&r&&"number"==typeof o&&(t.quaternion.slerpQuaternions(n.quaternion,r.quaternion,o),t.position.lerpVectors(n.position,r.position,o)))})}))}disconnect(){this.dispatchEvent({type:"motiondisconnected",data:this.motionController}),this.dispatchEvent({type:"modeldisconnected",data:this.scene}),this.motionController=null,this.scene&&this.remove(this.scene),this.scene=null}dispose(){this.disconnect()}}const Pr=a.forwardRef(function(e,t){let{target:n,hideOnBlur:r=!1,...o}=e;const s=Ct(e=>e.hoverState),l=a.useRef(null),u=a.useMemo(()=>(new i.f).setFromPoints([new i.c(0,0,0),new i.c(0,0,-1)]),[]);return a.useImperativeHandle(t,()=>l.current),we(()=>{if(!n.inputSource)return;let e=1;const t=s[n.inputSource.handedness].values().next().value;t&&"none"!==n.inputSource.handedness?(e=t.distance,r&&(l.current.visible=!1)):r&&(l.current.visible=!0);l.current.scale.z=e+-.01}),a.createElement("line",{ref:l,geometry:u,"material-opacity":.8,"material-transparent":!0,...o})}),Cr=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles";this.gltfLoader=e??new Bt,this.path=t,this._assetCache={}}initializeControllerModel(e,t){return"tracked-pointer"===t.targetRayMode&&t.gamepad?Gn(t,this.path,"generic-trigger").then(n=>{let{profile:r,assetPath:o}=n;if(!o)throw new Error("no asset path");const i=new Kn(t,r,o);e.connectMotionController(i);const a=i.assetUrl,s=this._assetCache[a];if(s){const t=s.scene.clone();e.connectModel(t)}else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(a,t=>{if(!e.motionController)return void console.warn("motionController gone while gltf load, bailing...");this._assetCache[a]=t;const n=t.scene.clone();e.connectModel(n)},void 0,()=>{throw new Error(`Asset ${a} missing or malformed.`)})}}).catch(e=>{console.warn(e)}):Promise.resolve()}},Mr=e=>{let{target:t,envMap:n,envMapIntensity:r}=e;const o=a.useRef(null),i=ht(e=>{null!=n&&e.setEnvironmentMap(n)}),s=ht(e=>e.setEnvironmentMap(null)),l=ht(e=>{null!=r&&e.setEnvironmentMapIntensity(r)}),u=a.useCallback(e=>{var n,r,a;if(o.current=e,e){if(t.xrControllerModel=e,null!=(n=t.inputSource)&&n.hand)return;i.current(e),l.current(e),t.inputSource?Cr.initializeControllerModel(e,t.inputSource):console.warn("no input source on XRController when handleControllerModel")}else{if(null!=(r=t.inputSource)&&r.hand)return;null==(a=t.xrControllerModel)||a.disconnect(),t.xrControllerModel=null}},[t,l,i]);return a.useLayoutEffect(()=>{o.current&&(n?i.current(o.current):s.current(o.current))},[n,i,s]),a.useLayoutEffect(()=>{o.current&&l.current(o.current)},[r,l]),a.createElement("xRControllerModel",{ref:u})};function Lr(e){let{rayMaterial:t={},hideRaysOnBlur:n=!1,envMap:r,envMapIntensity:o}=e;const i=Ct(e=>e.controllers),s=Ct(e=>e.isHandTracking),l=a.useMemo(()=>Object.entries(t).reduce((e,t)=>{let[n,r]=t;return{...e,[`material-${n}`]:r}},{}),[JSON.stringify(t)]);return a.useMemo(()=>I({XRControllerModel:Tr}),[]),a.createElement(a.Fragment,null,i.map((e,t)=>a.createElement(a.Fragment,{key:t},Re(a.createElement(Mr,{target:e,envMap:r,envMapIntensity:o}),e.grip),Re(a.createElement(Pr,{visible:!s,hideOnBlur:n,target:e,...l}),e.controller))))}class Ir{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/",r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;this.controller=t,this.handModel=e,this.bones=[];const i=new Bt;o||i.setPath(n),i.load(o??`${r}.glb`,e=>{const t=e.scene.children[0];this.handModel.add(t),this.scene=t;const n=t.getObjectByProperty("type","SkinnedMesh");n.frustumCulled=!1,n.castShadow=!0,n.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(e=>{const n=t.getObjectByName(e);void 0!==n?n.jointName=e:console.warn(`Couldn't find ${e} in ${r} hand mesh`),this.bones.push(n)})})}updateMesh(){const e=this.controller.joints;let t=!0;for(let n=0;n<this.bones.length;n++){const r=this.bones[n];if(r){const n=e[r.jointName];if(n.visible){const e=n.position;r.position.copy(e),r.quaternion.copy(n.quaternion),t=!1}}}t&&this.scene?this.scene.visible=!1:this.scene&&(this.scene.visible=!0)}dispose(){this.scene&&this.handModel.remove(this.scene)}}class Rr extends i.z{constructor(e,t,n){super(),this._onConnected=e=>{const t=e.data;t.hand&&!this.motionController&&(this.xrInputSource=t,this.motionController=new Ir(this,this.controller,void 0,t.handedness,"left"===t.handedness?this.leftModelPath:this.rightModelPath))},this._onDisconnected=()=>{var e;null!=(e=this.xrInputSource)&&e.hand&&this.motionControllerCleanup()},this.controller=e,this.motionController=null,this.envMap=null,this.leftModelPath=t,this.rightModelPath=n,this.mesh=null,this.xrInputSource=null,e.addEventListener("connected",this._onConnected),e.addEventListener("disconnected",this._onDisconnected)}motionControllerCleanup(){var e;this.clear(),null==(e=this.motionController)||e.dispose(),this.motionController=null}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){const e=this.controller.joints["index-finger-tip"];return e?e.position:null}intersectBoxObject(e){const t=this.getPointerPosition();if(t){const n=new i.av(t,.01),r=(new i.au).setFromObject(e);return n.intersectsBox(r)}return!1}checkButton(e){this.intersectBoxObject(e)?e.onPress():e.onClear(),e.isPressed()&&e.whilePressed()}dispose(){this.motionControllerCleanup(),this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}function kr(e){let{modelLeft:t,modelRight:n}=e;const r=Ct(e=>e.controllers);return a.useMemo(()=>I({OculusHandModel:Rr}),[]),ft(()=>{for(const e of r)e.hand.dispatchEvent({type:"connected",data:e.inputSource,fake:!0})},[r,t,n]),a.createElement(a.Fragment,null,r.map(e=>{let{hand:r}=e;return Re(a.createElement("oculusHandModel",{args:[r,t,n]}),r)}))}const zr=a.forwardRef(function(e,t){let{points:n,color:r=16777215,vertexColors:o,linewidth:s,lineWidth:l,segments:u,dashed:c,...d}=e;var f;const h=xe(e=>e.size),p=a.useMemo(()=>u?new vr:new yr,[u]),[m]=a.useState(()=>new Jn),g=4===(null==o||null==(f=o[0])?void 0:f.length)?4:3,v=a.useMemo(()=>{const e=u?new $n:new Zn,t=n.map(e=>{const t=Array.isArray(e);return e instanceof i.c||e instanceof i.aD?[e.x,e.y,e.z]:e instanceof i.d?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e});if(e.setPositions(t.flat()),o){r=16777215;const t=o.map(e=>e instanceof i.i?e.toArray():e);e.setColors(t.flat(),g)}return e},[n,u,o,g]);return a.useLayoutEffect(()=>{p.computeLineDistances()},[n,p]),a.useLayoutEffect(()=>{c?m.defines.USE_DASH="":delete m.defines.USE_DASH,m.needsUpdate=!0},[c,m]),a.useEffect(()=>()=>v.dispose(),[v]),a.createElement("primitive",(0,i._)({object:p,ref:t},d),a.createElement("primitive",{object:v,attach:"geometry"}),a.createElement("primitive",(0,i._)({object:m,attach:"material",color:r,vertexColors:!!o,resolution:[h.width,h.height],linewidth:s??l,dashed:c,transparent:4===g},d)))}),Nr=a.forwardRef((e,t)=>{let{sdfGlyphSize:r=64,anchorX:o="center",anchorY:s="middle",font:l,fontSize:u=1,children:c,characters:d,onSync:f,...h}=e;const{Text:p,preloadFont:m}=M(async()=>n.e(849).then(n.bind(n,849)),[]),g=xe(e=>{let{invalidate:t}=e;return t}),[v]=a.useState(()=>new p),[y,b]=a.useMemo(()=>{const e=[];let t="";return a.Children.forEach(c,n=>{"string"==typeof n||"number"==typeof n?t+=n:e.push(n)}),[e,t]},[c]);return M(()=>new Promise(e=>m({font:l,characters:d},e)),["troika-text",l,d]),a.useLayoutEffect(()=>{v.sync(()=>{g(),f&&f(v)})}),a.useEffect(()=>()=>v.dispose(),[v]),a.createElement("primitive",(0,i._)({object:v,ref:t,font:l,text:b,anchorX:o,anchorY:s,fontSize:u,sdfGlyphSize:r},h),y)}),Or=a.forwardRef((e,t)=>{let{makeDefault:n,camera:r,regress:o,domElement:s,enableDamping:l=!0,keyEvents:u=!1,onChange:c,onStart:d,onEnd:f,...h}=e;const p=xe(e=>e.invalidate),m=xe(e=>e.camera),g=xe(e=>e.gl),v=xe(e=>e.events),y=xe(e=>e.setEvents),b=xe(e=>e.set),x=xe(e=>e.get),w=xe(e=>e.performance),S=r||m,_=s||v.connected||g.domElement,E=a.useMemo(()=>new jt(S),[S]);return we(()=>{E.enabled&&E.update()},-1),a.useEffect(()=>(u&&E.connect(!0===u?_:u),E.connect(_),()=>{E.dispose()}),[u,_,o,E,p]),a.useEffect(()=>{const e=e=>{p(),o&&w.regress(),c&&c(e)},t=e=>{d&&d(e)},n=e=>{f&&f(e)};return E.addEventListener("change",e),E.addEventListener("start",t),E.addEventListener("end",n),()=>{E.removeEventListener("start",t),E.removeEventListener("end",n),E.removeEventListener("change",e)}},[c,d,f,E,p,y]),a.useEffect(()=>{if(n){const e=x().controls;return b({controls:E}),()=>b({controls:e})}},[n,E]),a.createElement("primitive",(0,i._)({ref:t,object:E,enableDamping:l},h))}),jr=2,Br=1.25,Dr=65535,Ur=Math.pow(2,-24),Fr=Symbol("SKIP_GENERATION");function Hr(e){return function(e){return e.index?e.index.count:e.attributes.position.count}(e)/3}function Vr(e,t){if(!e.index){const n=e.attributes.position.count,r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ArrayBuffer;return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}(n,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new i.K(r,1));for(let e=0;e<n;e++)r[e]=e}}function Gr(e){const t=Hr(e),n=e.drawRange,r=n.start/3,o=(n.start+n.count)/3,i=Math.max(0,r),a=Math.min(t,o)-i;return[{offset:Math.floor(i),count:Math.floor(a)}]}function qr(e){if(!e.groups||!e.groups.length)return Gr(e);const t=[],n=new Set,r=e.drawRange,o=r.start/3,i=(r.start+r.count)/3;for(const s of e.groups){const e=s.start/3,t=(s.start+s.count)/3;n.add(Math.max(o,e)),n.add(Math.min(i,t))}const a=Array.from(n.values()).sort((e,t)=>e-t);for(let s=0;s<a.length-1;s++){const e=a[s],n=a[s+1];t.push({offset:Math.floor(e),count:Math.floor(n-e)})}return t}function Wr(e,t,n,r,o){let i=1/0,a=1/0,s=1/0,l=-1/0,u=-1/0,c=-1/0,d=1/0,f=1/0,h=1/0,p=-1/0,m=-1/0,g=-1/0;for(let v=6*t,y=6*(t+n);v<y;v+=6){const t=e[v+0],n=e[v+1],r=t-n,o=t+n;r<i&&(i=r),o>l&&(l=o),t<d&&(d=t),t>p&&(p=t);const y=e[v+2],b=e[v+3],x=y-b,w=y+b;x<a&&(a=x),w>u&&(u=w),y<f&&(f=y),y>m&&(m=y);const S=e[v+4],_=e[v+5],E=S-_,A=S+_;E<s&&(s=E),A>c&&(c=A),S<h&&(h=S),S>g&&(g=S)}r[0]=i,r[1]=a,r[2]=s,r[3]=l,r[4]=u,r[5]=c,o[0]=d,o[1]=f,o[2]=h,o[3]=p,o[4]=m,o[5]=g}function Xr(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function Kr(e){let t=-1,n=-1/0;for(let r=0;r<3;r++){const o=e[r+3]-e[r];o>n&&(n=o,t=r)}return t}function Yr(e,t){t.set(e)}function Qr(e,t,n){let r,o;for(let i=0;i<3;i++){const a=i+3;r=e[i],o=t[i],n[i]=r<o?r:o,r=e[a],o=t[a],n[a]=r>o?r:o}}function $r(e,t,n){for(let r=0;r<3;r++){const o=t[e+2*r],i=t[e+2*r+1],a=o-i,s=o+i;a<n[r]&&(n[r]=a),s>n[r+3]&&(n[r+3]=s)}}function Zr(e){const t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return 2*(t*n+n*r+r*t)}const Jr=32,eo=(e,t)=>e.candidate-t.candidate,to=new Array(Jr).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),no=new Float32Array(6);class ro{constructor(){this.boundingData=new Float32Array(6)}}function oo(e,t,n,r,o,i){let a=r,s=r+o-1;const l=i.pos,u=2*i.axis;for(;;){for(;a<=s&&n[6*a+u]<l;)a++;for(;a<=s&&n[6*s+u]>=l;)s--;if(!(a<s))return a;for(let e=0;e<3;e++){let n=t[3*a+e];t[3*a+e]=t[3*s+e],t[3*s+e]=n}for(let e=0;e<6;e++){let t=n[6*a+e];n[6*a+e]=n[6*s+e],n[6*s+e]=t}a++,s--}}function io(e,t,n,r,o,i){let a=r,s=r+o-1;const l=i.pos,u=2*i.axis;for(;;){for(;a<=s&&n[6*a+u]<l;)a++;for(;a<=s&&n[6*s+u]>=l;)s--;if(!(a<s))return a;{let t=e[a];e[a]=e[s],e[s]=t;for(let e=0;e<6;e++){let t=n[6*a+e];n[6*a+e]=n[6*s+e],n[6*s+e]=t}a++,s--}}}function ao(e,t){return 65535===t[e+15]}function so(e,t){return t[e+6]}function lo(e,t){return t[e+14]}function uo(e){return e+8}function co(e,t){return t[e+6]}function fo(e,t){return t[e+7]}let ho,po,mo,go;const vo=Math.pow(2,32);function yo(e){return"count"in e?1:1+yo(e.left)+yo(e.right)}function bo(e,t,n){return ho=new Float32Array(n),po=new Uint32Array(n),mo=new Uint16Array(n),go=new Uint8Array(n),xo(e,t)}function xo(e,t){const n=e/4,r=e/2,o="count"in t,i=t.boundingData;for(let a=0;a<6;a++)ho[n+a]=i[a];if(o){if(t.buffer){const r=t.buffer;go.set(new Uint8Array(r),e);for(let t=e,o=e+r.byteLength;t<o;t+=32){ao(t/2,mo)||(po[t/4+6]+=n)}return e+r.byteLength}{const o=t.offset,i=t.count;return po[n+6]=o,mo[r+14]=i,mo[r+15]=Dr,e+32}}{const r=t.left,o=t.right,i=t.splitAxis;let a;if(a=xo(e+32,r),a/4>vo)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return po[n+6]=a/4,a=xo(a,o),po[n+7]=i,a}}function wo(e,t,n,r,o){const{maxDepth:i,verbose:a,maxLeafTris:s,strategy:l,onProgress:u,indirect:c}=o,d=e._indirectBuffer,f=e.geometry,h=f.index?f.index.array:null,p=c?io:oo,m=Hr(f),g=new Float32Array(6);let v=!1;const y=new ro;return Wr(t,n,r,y.boundingData,g),function e(n,r,o){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!v&&c>=i&&(v=!0,a&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(f))),o<=s||c>=i)return b(r+o),n.offset=r,n.count=o,n;const m=function(e,t,n,r,o,i){let a=-1,s=0;if(0===i)a=Kr(t),-1!==a&&(s=(t[a]+t[a+3])/2);else if(1===i)a=Kr(e),-1!==a&&(s=function(e,t,n,r){let o=0;for(let i=t,a=t+n;i<a;i++)o+=e[6*i+2*r];return o/n}(n,r,o,a));else if(i===jr){const i=Zr(e);let l=Br*o;const u=6*r,c=6*(r+o);for(let e=0;e<3;e++){const r=t[e],d=(t[e+3]-r)/Jr;if(o<8){const t=[...to];t.length=o;let r=0;for(let o=u;o<c;o+=6,r++){const i=t[r];i.candidate=n[o+2*e],i.count=0;const{bounds:a,leftCacheBounds:s,rightCacheBounds:l}=i;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0;$r(o,n,a)}t.sort(eo);let d=o;for(let e=0;e<d;e++){const n=t[e];for(;e+1<d&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),d--}for(let o=u;o<c;o+=6){const r=n[o+2*e];for(let e=0;e<d;e++){const i=t[e];r>=i.candidate?$r(o,n,i.rightCacheBounds):($r(o,n,i.leftCacheBounds),i.count++)}}for(let n=0;n<d;n++){const r=t[n],u=r.count,c=o-r.count,d=r.leftCacheBounds,f=r.rightCacheBounds;let h=0;0!==u&&(h=Zr(d)/i);let p=0;0!==c&&(p=Zr(f)/i);const m=1+Br*(h*u+p*c);m<l&&(a=e,l=m,s=r.candidate)}}else{for(let e=0;e<Jr;e++){const t=to[e];t.count=0,t.candidate=r+d+e*d;const n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let o=u;o<c;o+=6){let t=~~((n[o+2*e]-r)/d);t>=Jr&&(t=31);const i=to[t];i.count++,$r(o,n,i.bounds)}const t=to[31];Yr(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){const t=to[e],n=to[e+1];Qr(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let f=0;for(let n=0;n<31;n++){const t=to[n],r=t.count,u=t.bounds,c=to[n+1].rightCacheBounds;0!==r&&(0===f?Yr(u,no):Qr(u,no,no)),f+=r;let d=0,h=0;0!==f&&(d=Zr(no)/i);const p=o-f;0!==p&&(h=Zr(c)/i);const m=1+Br*(d*f+h*p);m<l&&(a=e,l=m,s=t.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${i} used.`);return{axis:a,pos:s}}(n.boundingData,u,t,r,o,l);if(-1===m.axis)return b(r+o),n.offset=r,n.count=o,n;const y=p(d,h,t,r,o,m);if(y===r||y===r+o)b(r+o),n.offset=r,n.count=o;else{n.splitAxis=m.axis;const i=new ro,a=r,s=y-r;n.left=i,Wr(t,a,s,i.boundingData,g),e(i,a,s,g,c+1);const l=new ro,u=y,d=o-s;n.right=l,Wr(t,u,d,l.boundingData,g),e(l,u,d,g,c+1)}return n}(y,n,r,g),y;function b(e){u&&u(e/m)}}function So(e,t){const n=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){const n=(e.index?e.index.count:e.attributes.position.count)/3,r=n>65536,o=r?4:2,i=t?new SharedArrayBuffer(n*o):new ArrayBuffer(n*o),a=r?new Uint32Array(i):new Uint16Array(i);for(let s=0,l=a.length;s<l;s++)a[s]=s;return a}(n,t.useSharedArrayBuffer),function(e){if(0===e.groups.length)return!1;const t=Hr(e),n=qr(e).sort((e,t)=>e.offset-t.offset),r=n[n.length-1];r.count=Math.min(t-r.offset,r.count);let o=0;return n.forEach(e=>{let{count:t}=e;return o+=t}),t!==o}(n)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||Vr(n,t);const r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=e.attributes.position,i=e.index?e.index.array:null,a=Hr(e),s=o.normalized;let l;null===t?(l=new Float32Array(6*a*4),n=0,r=a):(l=t,n=n||0,r=r||a);const u=o.array,c=o.offset||0;let d=3;o.isInterleavedBufferAttribute&&(d=o.data.stride);const f=["getX","getY","getZ"];for(let h=n;h<n+r;h++){const e=3*h,t=6*h;let n=e+0,r=e+1,a=e+2;i&&(n=i[n],r=i[r],a=i[a]),s||(n=n*d+c,r=r*d+c,a=a*d+c);for(let i=0;i<3;i++){let e,c,d;s?(e=o[f[i]](n),c=o[f[i]](r),d=o[f[i]](a)):(e=u[n+i],c=u[r+i],d=u[a+i]);let h=e;c<h&&(h=c),d<h&&(h=d);let p=e;c>p&&(p=c),d>p&&(p=d);const m=(p-h)/2,g=2*i;l[t+g+0]=h+m,l[t+g+1]=m+(Math.abs(h)+m)*Ur}}return l}(n),i=t.indirect?Gr(n):qr(n);e._roots=i.map(n=>{const i=wo(e,o,n.offset,n.count,t),a=yo(i),s=new r(32*a);return bo(0,i,s),s})}class _o{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let o=0,i=e.length;o<i;o++){const i=e[o][t];n=i<n?i:n,r=i>r?i:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let o=0,i=t.length;o<i;o++){const i=t[o],a=e.dot(i);n=a<n?a:n,r=a>r?a:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}_o.prototype.setFromBox=function(){const e=new i.c;return function(t,n){const r=n.min,o=n.max;let i=1/0,a=-1/0;for(let s=0;s<=1;s++)for(let n=0;n<=1;n++)for(let l=0;l<=1;l++){e.x=r.x*s+o.x*(1-s),e.y=r.y*n+o.y*(1-n),e.z=r.z*l+o.z*(1-l);const u=t.dot(e);i=Math.min(u,i),a=Math.max(u,a)}this.min=i,this.max=a}}();const Eo=function(){const e=new i.c,t=new i.c,n=new i.c;return function(r,o,i){const a=r.start,s=e,l=o.start,u=t;n.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(o.end,o.start);const c=n.dot(u),d=u.dot(s),f=u.dot(u),h=n.dot(s),p=s.dot(s)*f-d*d;let m,g;m=0!==p?(c*d-h*f)/p:0,g=(c+m*d)/f,i.x=m,i.y=g}}(),Ao=function(){const e=new i.d,t=new i.c,n=new i.c;return function(r,o,i,a){Eo(r,o,e);let s=e.x,l=e.y;if(s>=0&&s<=1&&l>=0&&l<=1)return r.at(s,i),void o.at(l,a);if(s>=0&&s<=1)return l<0?o.at(0,a):o.at(1,a),void r.closestPointToPoint(a,!0,i);if(l>=0&&l<=1)return s<0?r.at(0,i):r.at(1,i),void o.closestPointToPoint(i,!0,a);{let e,u;e=s<0?r.start:r.end,u=l<0?o.start:o.end;const c=t,d=n;return r.closestPointToPoint(u,!0,t),o.closestPointToPoint(e,!0,n),c.distanceToSquared(u)<=d.distanceToSquared(e)?(i.copy(c),void a.copy(u)):(i.copy(e),void a.copy(d))}}}(),To=function(){const e=new i.c,t=new i.c,n=new i.t,r=new i.aE;return function(o,i){const{radius:a,center:s}=o,{a:l,b:u,c:c}=i;if(r.start=l,r.end=u,r.closestPointToPoint(s,!0,e).distanceTo(s)<=a||(r.start=l,r.end=c,r.closestPointToPoint(s,!0,e).distanceTo(s)<=a)||(r.start=u,r.end=c,r.closestPointToPoint(s,!0,e).distanceTo(s)<=a))return!0;const d=i.getPlane(n);if(Math.abs(d.distanceToPoint(s))<=a){const e=d.projectPoint(s,t);if(i.containsPoint(e))return!0}return!1}}();function Po(e){return Math.abs(e)<1e-15}class Co extends i.aG{constructor(){super(...arguments),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new i.c),this.satBounds=new Array(4).fill().map(()=>new _o),this.points=[this.a,this.b,this.c],this.sphere=new i.av,this.plane=new i.t,this.needsUpdate=!0}intersectsSphere(e){return To(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,o=this.satAxes,i=this.satBounds,a=o[0],s=i[0];this.getNormal(a),s.setFromPoints(a,r);const l=o[1],u=i[1];l.subVectors(e,t),u.setFromPoints(l,r);const c=o[2],d=i[2];c.subVectors(t,n),d.setFromPoints(c,r);const f=o[3],h=i[3];f.subVectors(n,e),h.setFromPoints(f,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}Co.prototype.closestPointToSegment=function(){const e=new i.c,t=new i.c,n=new i.aE;return function(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const{start:a,end:s}=r,l=this.points;let u,c=1/0;for(let d=0;d<3;d++){const a=(d+1)%3;n.start.copy(l[d]),n.end.copy(l[a]),Ao(n,r,e,t),u=e.distanceToSquared(t),u<c&&(c=u,o&&o.copy(e),i&&i.copy(t))}return this.closestPointToPoint(a,e),u=a.distanceToSquared(e),u<c&&(c=u,o&&o.copy(e),i&&i.copy(a)),this.closestPointToPoint(s,e),u=s.distanceToSquared(e),u<c&&(c=u,o&&o.copy(e),i&&i.copy(s)),Math.sqrt(c)}}(),Co.prototype.intersectsTriangle=function(){const e=new Co,t=new Array(3),n=new Array(3),r=new _o,o=new _o,a=new i.c,s=new i.c,l=new i.c,u=new i.c,c=new i.c,d=new i.aE,f=new i.aE,h=new i.aE,p=new i.c;function m(e,t,n){const r=e.points;let o=0,i=-1;for(let a=0;a<3;a++){const{start:e,end:l}=d;e.copy(r[a]),l.copy(r[(a+1)%3]),d.delta(s);const u=Po(t.distanceToPoint(e));if(Po(t.normal.dot(s))&&u){n.copy(d),o=2;break}const c=t.intersectLine(d,p);if(!c&&u&&p.copy(e),(c||u)&&!Po(p.distanceTo(l))){if(o<=1)(1===o?n.start:n.end).copy(p),u&&(i=o);else if(o>=2){(1===i?n.start:n.end).copy(p),o=2;break}if(o++,2===o&&-1===i)break}}return o}return function(i){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);const p=this.plane,g=i.plane;if(Math.abs(p.normal.dot(g.normal))>1-1e-10){const e=this.satBounds,l=this.satAxes;n[0]=i.a,n[1]=i.b,n[2]=i.c;for(let t=0;t<4;t++){const o=e[t],i=l[t];if(r.setFromPoints(i,n),o.isSeparated(r))return!1}const u=i.satBounds,c=i.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let n=0;n<4;n++){const e=u[n],o=c[n];if(r.setFromPoints(o,t),e.isSeparated(r))return!1}for(let i=0;i<4;i++){const e=l[i];for(let i=0;i<4;i++){const s=c[i];if(a.crossVectors(e,s),r.setFromPoints(a,t),o.setFromPoints(a,n),r.isSeparated(o))return!1}}return s&&(d||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),s.start.set(0,0,0),s.end.set(0,0,0)),!0}{const e=m(this,g,f);if(1===e&&i.containsPoint(f.end))return s&&(s.start.copy(f.end),s.end.copy(f.end)),!0;if(2!==e)return!1;const t=m(i,p,h);if(1===t&&this.containsPoint(h.end))return s&&(s.start.copy(h.end),s.end.copy(h.end)),!0;if(2!==t)return!1;if(f.delta(l),h.delta(u),l.dot(u)<0){let e=h.start;h.start=h.end,h.end=e}const n=f.start.dot(l),r=f.end.dot(l),o=h.start.dot(l),a=h.end.dot(l);return(n===a||o===r||r<o!==n<a)&&(s&&(c.subVectors(f.start,h.start),c.dot(l)>0?s.start.copy(f.start):s.start.copy(h.start),c.subVectors(f.end,h.end),c.dot(l)<0?s.end.copy(f.end):s.end.copy(h.end)),!0)}}}(),Co.prototype.distanceToPoint=function(){const e=new i.c;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Co.prototype.distanceToTriangle=function(){const e=new i.c,t=new i.c,n=["a","b","c"],r=new i.aE,o=new i.aE;return function(i){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const l=a||s?r:null;if(this.intersectsTriangle(i,l))return(a||s)&&(a&&l.getCenter(a),s&&l.getCenter(s)),0;let u=1/0;for(let t=0;t<3;t++){let r;const o=n[t],l=i[o];this.closestPointToPoint(l,e),r=l.distanceToSquared(e),r<u&&(u=r,a&&a.copy(e),s&&s.copy(l));const c=this[o];i.closestPointToPoint(c,e),r=c.distanceToSquared(e),r<u&&(u=r,a&&a.copy(c),s&&s.copy(e))}for(let c=0;c<3;c++){const l=n[c],d=n[(c+1)%3];r.set(this[l],this[d]);for(let c=0;c<3;c++){const l=n[c],d=n[(c+1)%3];o.set(i[l],i[d]),Ao(r,o,e,t);const f=e.distanceToSquared(t);f<u&&(u=f,a&&a.copy(e),s&&s.copy(t))}}return Math.sqrt(u)}}();class Mo{constructor(e,t,n){this.isOrientedBox=!0,this.min=new i.c,this.max=new i.c,this.matrix=new i.k,this.invMatrix=new i.k,this.points=new Array(8).fill().map(()=>new i.c),this.satAxes=new Array(3).fill().map(()=>new i.c),this.satBounds=new Array(3).fill().map(()=>new _o),this.alignedSatBounds=new Array(3).fill().map(()=>new _o),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Mo.prototype.update=function(){return function(){const e=this.matrix,t=this.min,n=this.max,r=this.points;for(let l=0;l<=1;l++)for(let o=0;o<=1;o++)for(let i=0;i<=1;i++){const a=r[1*l|2*o|4*i];a.x=l?n.x:t.x,a.y=o?n.y:t.y,a.z=i?n.z:t.z,a.applyMatrix4(e)}const o=this.satBounds,i=this.satAxes,a=r[0];for(let l=0;l<3;l++){const e=i[l],t=o[l],n=r[1<<l];e.subVectors(a,n),t.setFromPoints(e,r)}const s=this.alignedSatBounds;s[0].setFromPointsField(r,"x"),s[1].setFromPointsField(r,"y"),s[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),Mo.prototype.intersectsBox=function(){const e=new _o;return function(t){this.needsUpdate&&this.update();const n=t.min,r=t.max,o=this.satBounds,i=this.satAxes,a=this.alignedSatBounds;if(e.min=n.x,e.max=r.x,a[0].isSeparated(e)||(e.min=n.y,e.max=r.y,a[1].isSeparated(e))||(e.min=n.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let s=0;s<3;s++){const n=i[s],r=o[s];if(e.setFromBox(n,t),r.isSeparated(e))return!1}return!0}}(),Mo.prototype.intersectsTriangle=function(){const e=new Co,t=new Array(3),n=new _o,r=new _o,o=new i.c;return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);const a=this.satBounds,s=this.satAxes;t[0]=i.a,t[1]=i.b,t[2]=i.c;for(let e=0;e<3;e++){const r=a[e],o=s[e];if(n.setFromPoints(o,t),r.isSeparated(n))return!1}const l=i.satBounds,u=i.satAxes,c=this.points;for(let e=0;e<3;e++){const t=l[e],r=u[e];if(n.setFromPoints(r,c),t.isSeparated(n))return!1}for(let e=0;e<3;e++){const i=s[e];for(let e=0;e<4;e++){const a=u[e];if(o.crossVectors(i,a),n.setFromPoints(o,t),r.setFromPoints(o,c),n.isSeparated(r))return!1}}return!0}}(),Mo.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}(),Mo.prototype.distanceToPoint=function(){const e=new i.c;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Mo.prototype.distanceToBox=function(){const e=["x","y","z"],t=new Array(12).fill().map(()=>new i.aE),n=new Array(12).fill().map(()=>new i.aE),r=new i.c,o=new i.c;return function(i){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(s||l)&&(i.getCenter(o),this.closestPointToPoint(o,r),i.closestPointToPoint(r,o),s&&s.copy(r),l&&l.copy(o)),0;const u=a*a,c=i.min,d=i.max,f=this.points;let h=1/0;for(let e=0;e<8;e++){const t=f[e];o.copy(t).clamp(c,d);const n=t.distanceToSquared(o);if(n<h&&(h=n,s&&s.copy(t),l&&l.copy(o),n<u))return Math.sqrt(n)}let p=0;for(let r=0;r<3;r++)for(let o=0;o<=1;o++)for(let i=0;i<=1;i++){const a=(r+1)%3,s=(r+2)%3,l=1<<r|o<<a|i<<s,u=f[o<<a|i<<s],h=f[l];t[p].set(u,h);const m=e[r],g=e[a],v=e[s],y=n[p],b=y.start,x=y.end;b[m]=c[m],b[g]=o?c[g]:d[g],b[v]=i?c[v]:d[g],x[m]=d[m],x[g]=o?c[g]:d[g],x[v]=i?c[v]:d[g],p++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){o.x=e?d.x:c.x,o.y=t?d.y:c.y,o.z=n?d.z:c.z,this.closestPointToPoint(o,r);const i=o.distanceToSquared(r);if(i<h&&(h=i,s&&s.copy(r),l&&l.copy(o),i<u))return Math.sqrt(i)}for(let e=0;e<12;e++){const i=t[e];for(let e=0;e<12;e++){const t=n[e];Ao(i,t,r,o);const a=r.distanceToSquared(o);if(a<h&&(h=a,s&&s.copy(r),l&&l.copy(o),a<u))return Math.sqrt(a)}}return Math.sqrt(h)}}();class Lo{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class Io extends Lo{constructor(){super(()=>new Co)}}const Ro=new Io;const ko=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=n=>{t&&e.push(t),t=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}};let zo,No;const Oo=[],jo=new Lo(()=>new i.au);function Bo(e,t,n,r,o,i){zo=jo.getPrimitive(),No=jo.getPrimitive(),Oo.push(zo,No),ko.setBuffer(e._roots[t]);const a=Do(0,e.geometry,n,r,o,i);ko.clearBuffer(),jo.releasePrimitive(zo),jo.releasePrimitive(No),Oo.pop(),Oo.pop();const s=Oo.length;return s>0&&(No=Oo[s-1],zo=Oo[s-2]),a}function Do(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const{float32Array:s,uint16Array:l,uint32Array:u}=ko;let c=2*e;if(ao(c,l)){const t=so(e,u),n=lo(c,l);return Xr(e,s,zo),r(t,n,!1,a,i+e,zo)}{let c=function(e){const{uint16Array:t,uint32Array:n}=ko;let r=2*e;for(;!ao(r,t);)r=2*(e=uo(e));return so(e,n)},d=function(e){const{uint16Array:t,uint32Array:n}=ko;let r=2*e;for(;!ao(r,t);)r=2*(e=co(e,n));return so(e,n)+lo(r,t)};const f=uo(e),h=co(e,u);let p,m,g,v,y=f,b=h;if(o&&(g=zo,v=No,Xr(y,s,g),Xr(b,s,v),p=o(g),m=o(v),m<p)){y=h,b=f;const e=p;p=m,m=e,g=v}g||(g=zo,Xr(y,s,g));const x=n(g,ao(2*y,l),p,a+1,i+y);let w;if(2===x){const e=c(y);w=r(e,d(y)-e,!0,a+1,i+y,g)}else w=x&&Do(y,t,n,r,o,i,a+1);if(w)return!0;v=No,Xr(b,s,v);const S=n(v,ao(2*b,l),m,a+1,i+b);let _;if(2===S){const e=c(b);_=r(e,d(b)-e,!0,a+1,i+b,v)}else _=S&&Do(b,t,n,r,o,i,a+1);return!!_}}const Uo=new i.c,Fo=new i.c;const Ho=new i.c,Vo=new i.c,Go=new i.c,qo=new i.d,Wo=new i.d,Xo=new i.d,Ko=new i.c,Yo=new i.c,Qo=new i.c,$o=new i.c;function Zo(e,t,n,r,o,a,s,l,u){Ho.fromBufferAttribute(t,a),Vo.fromBufferAttribute(t,s),Go.fromBufferAttribute(t,l);const c=function(e,t,n,r,o,a){let s;return s=a===i.aH?e.intersectTriangle(r,n,t,!0,o):e.intersectTriangle(t,n,r,a!==i.a9,o),null===s?null:{distance:e.origin.distanceTo(o),point:o.clone()}}(e,Ho,Vo,Go,$o,u);if(c){r&&(qo.fromBufferAttribute(r,a),Wo.fromBufferAttribute(r,s),Xo.fromBufferAttribute(r,l),c.uv=i.aG.getInterpolation($o,Ho,Vo,Go,qo,Wo,Xo,new i.d)),o&&(qo.fromBufferAttribute(o,a),Wo.fromBufferAttribute(o,s),Xo.fromBufferAttribute(o,l),c.uv1=i.aG.getInterpolation($o,Ho,Vo,Go,qo,Wo,Xo,new i.d)),n&&(Ko.fromBufferAttribute(n,a),Yo.fromBufferAttribute(n,s),Qo.fromBufferAttribute(n,l),c.normal=i.aG.getInterpolation($o,Ho,Vo,Go,Ko,Yo,Qo,new i.c),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));const t={a:a,b:s,c:l,normal:new i.c,materialIndex:0};i.aG.getNormal(Ho,Vo,Go,t.normal),c.face=t,c.faceIndex=a}return c}function Jo(e,t,n,r,o){const i=3*r;let a=i+0,s=i+1,l=i+2;const u=e.index;e.index&&(a=u.getX(a),s=u.getX(s),l=u.getX(l));const{position:c,normal:d,uv:f,uv1:h}=e.attributes,p=Zo(n,c,d,f,h,a,s,l,t);return p?(p.faceIndex=r,o&&o.push(p),p):null}function ei(e,t,n,r){const o=e.a,i=e.b,a=e.c;let s=t,l=t+1,u=t+2;n&&(s=n.getX(s),l=n.getX(l),u=n.getX(u)),o.x=r.getX(s),o.y=r.getY(s),o.z=r.getZ(s),i.x=r.getX(l),i.y=r.getY(l),i.z=r.getZ(l),a.x=r.getX(u),a.y=r.getY(u),a.z=r.getZ(u)}function ti(e,t,n,r,o,i,a){const{geometry:s}=n,{index:l}=s,u=s.attributes.position;for(let c=e,d=t+e;c<d;c++){let e;if(e=c,ei(a,3*e,l,u),a.needsUpdate=!0,r(a,e,o,i))return!0}return!1}function ni(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&Array.isArray(t)&&(t=new Set(t));const n=e.geometry,r=n.index?n.index.array:null,o=n.attributes.position;let i,a,s,l,u=0;const c=e._roots;for(let f=0,h=c.length;f<h;f++)i=c[f],a=new Uint32Array(i),s=new Uint16Array(i),l=new Float32Array(i),d(0,u),u+=i.byteLength;function d(e,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u=2*e;if(s[u+15]===Dr){const t=a[e+6];let n=1/0,i=1/0,c=1/0,d=-1/0,f=-1/0,h=-1/0;for(let e=3*t,a=3*(t+s[u+14]);e<a;e++){let t=r[e];const a=o.getX(t),s=o.getY(t),l=o.getZ(t);a<n&&(n=a),a>d&&(d=a),s<i&&(i=s),s>f&&(f=s),l<c&&(c=l),l>h&&(h=l)}return(l[e+0]!==n||l[e+1]!==i||l[e+2]!==c||l[e+3]!==d||l[e+4]!==f||l[e+5]!==h)&&(l[e+0]=n,l[e+1]=i,l[e+2]=c,l[e+3]=d,l[e+4]=f,l[e+5]=h,!0)}{const r=e+8,o=a[e+6],s=r+n,u=o+n;let c=i,f=!1,h=!1;t?c||(f=t.has(s),h=t.has(u),c=!f&&!h):(f=!0,h=!0);const p=c||h;let m=!1;(c||f)&&(m=d(r,n,c));let g=!1;p&&(g=d(o,n,c));const v=m||g;if(v)for(let t=0;t<3;t++){const n=r+t,i=o+t,a=l[n],s=l[n+3],u=l[i],c=l[i+3];l[e+t]=a<u?a:u,l[e+t+3]=s>c?s:c}return v}}}const ri=new i.au;function oi(e,t,n,r){return Xr(e,t,ri),n.intersectBox(ri,r)}function ii(e,t,n,r,o,i,a){const{geometry:s}=n,{index:l}=s,u=s.attributes.position;for(let c=e,d=t+e;c<d;c++){let e;if(e=n.resolveTriangleIndex(c),ei(a,3*e,l,u),a.needsUpdate=!0,r(a,e,o,i))return!0}return!1}const ai=new i.c;function si(e,t,n,r,o){ko.setBuffer(e._roots[t]),li(0,e,n,r,o),ko.clearBuffer()}function li(e,t,n,r,o){const{float32Array:i,uint16Array:a,uint32Array:s}=ko,l=2*e;if(ao(l,a)){!function(e,t,n,r,o,i){const{geometry:a,_indirectBuffer:s}=e;for(let l=r,u=r+o;l<u;l++)Jo(a,t,n,l,i)}(t,n,r,so(e,s),lo(l,a),o)}else{const a=uo(e);oi(a,i,r,ai)&&li(a,t,n,r,o);const l=co(e,s);oi(l,i,r,ai)&&li(l,t,n,r,o)}}const ui=new i.c,ci=["x","y","z"];function di(e,t,n,r){ko.setBuffer(e._roots[t]);const o=fi(0,e,n,r);return ko.clearBuffer(),o}function fi(e,t,n,r){const{float32Array:o,uint16Array:i,uint32Array:a}=ko;let s=2*e;if(ao(s,i)){return function(e,t,n,r,o){const{geometry:i,_indirectBuffer:a}=e;let s=1/0,l=null;for(let u=r,c=r+o;u<c;u++){let e;e=Jo(i,t,n,u),e&&e.distance<s&&(l=e,s=e.distance)}return l}(t,n,r,so(e,a),lo(s,i))}{const i=fo(e,a),s=ci[i],l=r.direction[s]>=0;let u,c;l?(u=uo(e),c=co(e,a)):(u=co(e,a),c=uo(e));const d=oi(u,o,r,ui)?fi(u,t,n,r):null;if(d){const e=d.point[s];if(l?e<=o[c+i]:e>=o[c+i+3])return d}const f=oi(c,o,r,ui)?fi(c,t,n,r):null;return d&&f?d.distance<=f.distance?d:f:d||f||null}}const hi=new i.au,pi=new Co,mi=new Co,gi=new i.k,vi=new Mo,yi=new Mo;function bi(e,t,n,r){ko.setBuffer(e._roots[t]);const o=xi(0,e,n,r);return ko.clearBuffer(),o}function xi(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const{float32Array:i,uint16Array:a,uint32Array:s}=ko;let l=2*e;if(null===o&&(n.boundingBox||n.computeBoundingBox(),vi.set(n.boundingBox.min,n.boundingBox.max,r),o=vi),!ao(l,a)){const a=e+8,l=s[e+6];return Xr(a,i,hi),!!(o.intersectsBox(hi)&&xi(a,t,n,r,o)||(Xr(l,i,hi),o.intersectsBox(hi)&&xi(l,t,n,r,o)))}{const o=t.geometry,u=o.index,c=o.attributes.position,d=n.index,f=n.attributes.position,h=so(e,s),p=lo(l,a);if(gi.copy(r).invert(),n.boundsTree)return Xr(e,i,yi),yi.matrix.copy(gi),yi.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:e=>yi.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let t=3*h,n=3*(p+h);t<n;t+=3)if(ei(mi,t,u,c),mi.needsUpdate=!0,e.intersectsTriangle(mi))return!0;return!1}});for(let e=3*h,t=3*(p+h);e<t;e+=3){ei(pi,e,u,c),pi.a.applyMatrix4(gi),pi.b.applyMatrix4(gi),pi.c.applyMatrix4(gi),pi.needsUpdate=!0;for(let e=0,t=d.count;e<t;e+=3)if(ei(mi,e,d,f),mi.needsUpdate=!0,pi.intersectsTriangle(mi))return!0}}}const wi=new i.k,Si=new Mo,_i=new Mo,Ei=new i.c,Ai=new i.c,Ti=new i.c,Pi=new i.c;function Ci(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;t.boundingBox||t.computeBoundingBox(),Si.set(t.boundingBox.min,t.boundingBox.max,n),Si.needsUpdate=!0;const s=e.geometry,l=s.attributes.position,u=s.index,c=t.attributes.position,d=t.index,f=Ro.getPrimitive(),h=Ro.getPrimitive();let p=Ei,m=Ai,g=null,v=null;o&&(g=Ti,v=Pi);let y=1/0,b=null,x=null;return wi.copy(n).invert(),_i.matrix.copy(wi),e.shapecast({boundsTraverseOrder:e=>Si.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<a&&(t&&(_i.min.copy(e.min),_i.max.copy(e.max),_i.needsUpdate=!0),!0),intersectsRange:(e,r)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>_i.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<a,intersectsRange:(t,o)=>{for(let a=t,s=t+o;a<s;a++){ei(h,3*a,d,c),h.a.applyMatrix4(n),h.b.applyMatrix4(n),h.c.applyMatrix4(n),h.needsUpdate=!0;for(let t=e,n=e+r;t<n;t++){ei(f,3*t,u,l),f.needsUpdate=!0;const e=f.distanceToTriangle(h,p,g);if(e<y&&(m.copy(p),v&&v.copy(g),y=e,b=t,x=a),e<i)return!0}}}});for(let o=0,a=Hr(t);o<a;o++){ei(h,3*o,d,c),h.a.applyMatrix4(n),h.b.applyMatrix4(n),h.c.applyMatrix4(n),h.needsUpdate=!0;for(let t=e,n=e+r;t<n;t++){ei(f,3*t,u,l),f.needsUpdate=!0;const e=f.distanceToTriangle(h,p,g);if(e<y&&(m.copy(p),v&&v.copy(g),y=e,b=t,x=o),e<i)return!0}}}}),Ro.releasePrimitive(f),Ro.releasePrimitive(h),y===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=y,r.faceIndex=b,o&&(o.point?o.point.copy(v):o.point=v.clone(),o.point.applyMatrix4(wi),m.applyMatrix4(wi),o.distance=m.sub(o.point).length(),o.faceIndex=x),r)}function Mi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t&&Array.isArray(t)&&(t=new Set(t));const n=e.geometry,r=n.index?n.index.array:null,o=n.attributes.position;let i,a,s,l,u=0;const c=e._roots;for(let f=0,h=c.length;f<h;f++)i=c[f],a=new Uint32Array(i),s=new Uint16Array(i),l=new Float32Array(i),d(0,u),u+=i.byteLength;function d(n,i){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c=2*n;if(s[c+15]===Dr){const t=a[n+6];let i=1/0,u=1/0,d=1/0,f=-1/0,h=-1/0,p=-1/0;for(let n=t,a=t+s[c+14];n<a;n++){const t=3*e.resolveTriangleIndex(n);for(let e=0;e<3;e++){let n=t+e;n=r?r[n]:n;const a=o.getX(n),s=o.getY(n),l=o.getZ(n);a<i&&(i=a),a>f&&(f=a),s<u&&(u=s),s>h&&(h=s),l<d&&(d=l),l>p&&(p=l)}}return(l[n+0]!==i||l[n+1]!==u||l[n+2]!==d||l[n+3]!==f||l[n+4]!==h||l[n+5]!==p)&&(l[n+0]=i,l[n+1]=u,l[n+2]=d,l[n+3]=f,l[n+4]=h,l[n+5]=p,!0)}{const e=n+8,r=a[n+6],o=e+i,s=r+i;let c=u,f=!1,h=!1;t?c||(f=t.has(o),h=t.has(s),c=!f&&!h):(f=!0,h=!0);const p=c||h;let m=!1;(c||f)&&(m=d(e,i,c));let g=!1;p&&(g=d(r,i,c));const v=m||g;if(v)for(let t=0;t<3;t++){const o=e+t,i=r+t,a=l[o],s=l[o+3],u=l[i],c=l[i+3];l[n+t]=a<u?a:u,l[n+t+3]=s>c?s:c}return v}}}const Li=new i.c;function Ii(e,t,n,r,o){ko.setBuffer(e._roots[t]),Ri(0,e,n,r,o),ko.clearBuffer()}function Ri(e,t,n,r,o){const{float32Array:i,uint16Array:a,uint32Array:s}=ko,l=2*e;if(ao(l,a)){!function(e,t,n,r,o,i){const{geometry:a,_indirectBuffer:s}=e;for(let l=r,u=r+o;l<u;l++)Jo(a,t,n,s?s[l]:l,i)}(t,n,r,so(e,s),lo(l,a),o)}else{const a=uo(e);oi(a,i,r,Li)&&Ri(a,t,n,r,o);const l=co(e,s);oi(l,i,r,Li)&&Ri(l,t,n,r,o)}}const ki=new i.c,zi=["x","y","z"];function Ni(e,t,n,r){ko.setBuffer(e._roots[t]);const o=Oi(0,e,n,r);return ko.clearBuffer(),o}function Oi(e,t,n,r){const{float32Array:o,uint16Array:i,uint32Array:a}=ko;let s=2*e;if(ao(s,i)){return function(e,t,n,r,o){const{geometry:i,_indirectBuffer:a}=e;let s=1/0,l=null;for(let u=r,c=r+o;u<c;u++){let e;e=Jo(i,t,n,a?a[u]:u),e&&e.distance<s&&(l=e,s=e.distance)}return l}(t,n,r,so(e,a),lo(s,i))}{const i=fo(e,a),s=zi[i],l=r.direction[s]>=0;let u,c;l?(u=uo(e),c=co(e,a)):(u=co(e,a),c=uo(e));const d=oi(u,o,r,ki)?Oi(u,t,n,r):null;if(d){const e=d.point[s];if(l?e<=o[c+i]:e>=o[c+i+3])return d}const f=oi(c,o,r,ki)?Oi(c,t,n,r):null;return d&&f?d.distance<=f.distance?d:f:d||f||null}}const ji=new i.au,Bi=new Co,Di=new Co,Ui=new i.k,Fi=new Mo,Hi=new Mo;function Vi(e,t,n,r){ko.setBuffer(e._roots[t]);const o=Gi(0,e,n,r);return ko.clearBuffer(),o}function Gi(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const{float32Array:i,uint16Array:a,uint32Array:s}=ko;let l=2*e;if(null===o&&(n.boundingBox||n.computeBoundingBox(),Fi.set(n.boundingBox.min,n.boundingBox.max,r),o=Fi),!ao(l,a)){const a=e+8,l=s[e+6];return Xr(a,i,ji),!!(o.intersectsBox(ji)&&Gi(a,t,n,r,o)||(Xr(l,i,ji),o.intersectsBox(ji)&&Gi(l,t,n,r,o)))}{const o=t.geometry,u=o.index,c=o.attributes.position,d=n.index,f=n.attributes.position,h=so(e,s),p=lo(l,a);if(Ui.copy(r).invert(),n.boundsTree)return Xr(e,i,Hi),Hi.matrix.copy(Ui),Hi.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:e=>Hi.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let n=h,r=p+h;n<r;n++)if(ei(Di,3*t.resolveTriangleIndex(n),u,c),Di.needsUpdate=!0,e.intersectsTriangle(Di))return!0;return!1}});for(let e=h,n=p+h;e<n;e++){const n=t.resolveTriangleIndex(e);ei(Bi,3*n,u,c),Bi.a.applyMatrix4(Ui),Bi.b.applyMatrix4(Ui),Bi.c.applyMatrix4(Ui),Bi.needsUpdate=!0;for(let e=0,t=d.count;e<t;e+=3)if(ei(Di,e,d,f),Di.needsUpdate=!0,Bi.intersectsTriangle(Di))return!0}}}const qi=new i.k,Wi=new Mo,Xi=new Mo,Ki=new i.c,Yi=new i.c,Qi=new i.c,$i=new i.c;function Zi(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0;t.boundingBox||t.computeBoundingBox(),Wi.set(t.boundingBox.min,t.boundingBox.max,n),Wi.needsUpdate=!0;const s=e.geometry,l=s.attributes.position,u=s.index,c=t.attributes.position,d=t.index,f=Ro.getPrimitive(),h=Ro.getPrimitive();let p=Ki,m=Yi,g=null,v=null;o&&(g=Qi,v=$i);let y=1/0,b=null,x=null;return qi.copy(n).invert(),Xi.matrix.copy(qi),e.shapecast({boundsTraverseOrder:e=>Wi.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<a&&(t&&(Xi.min.copy(e.min),Xi.max.copy(e.max),Xi.needsUpdate=!0),!0),intersectsRange:(r,o)=>{if(t.boundsTree){const s=t.boundsTree;return s.shapecast({boundsTraverseOrder:e=>Xi.distanceToBox(e),intersectsBounds:(e,t,n)=>n<y&&n<a,intersectsRange:(t,a)=>{for(let w=t,S=t+a;w<S;w++){const t=s.resolveTriangleIndex(w);ei(h,3*t,d,c),h.a.applyMatrix4(n),h.b.applyMatrix4(n),h.c.applyMatrix4(n),h.needsUpdate=!0;for(let n=r,a=r+o;n<a;n++){const t=e.resolveTriangleIndex(n);ei(f,3*t,u,l),f.needsUpdate=!0;const r=f.distanceToTriangle(h,p,g);if(r<y&&(m.copy(p),v&&v.copy(g),y=r,b=n,x=w),r<i)return!0}}}})}for(let a=0,s=Hr(t);a<s;a++){ei(h,3*a,d,c),h.a.applyMatrix4(n),h.b.applyMatrix4(n),h.c.applyMatrix4(n),h.needsUpdate=!0;for(let t=r,n=r+o;t<n;t++){const n=e.resolveTriangleIndex(t);ei(f,3*n,u,l),f.needsUpdate=!0;const r=f.distanceToTriangle(h,p,g);if(r<y&&(m.copy(p),v&&v.copy(g),y=r,b=t,x=a),r<i)return!0}}}}),Ro.releasePrimitive(f),Ro.releasePrimitive(h),y===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=y,r.faceIndex=b,o&&(o.point?o.point.copy(v):o.point=v.clone(),o.point.applyMatrix4(qi),m.applyMatrix4(qi),o.distance=m.sub(o.point).length(),o.faceIndex=x),r)}const Ji=new ko.constructor,ea=new ko.constructor,ta=new Lo(()=>new i.au),na=new i.au,ra=new i.au,oa=new i.au,ia=new i.au;let aa=!1;function sa(e,t,n,r,o){let i,a,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,f=arguments.length>10&&void 0!==arguments[10]&&arguments[10];f?(i=ea,a=Ji):(i=Ji,a=ea);const h=i.float32Array,p=i.uint32Array,m=i.uint16Array,g=a.float32Array,v=a.uint32Array,y=a.uint16Array,b=2*t,x=ao(2*e,m),w=ao(b,y);let S=!1;if(w&&x)S=f?o(so(t,v),lo(2*t,y),so(e,p),lo(2*e,m),c,l+t,u,s+e):o(so(e,p),lo(2*e,m),so(t,v),lo(2*t,y),u,s+e,c,l+t);else if(w){const i=ta.getPrimitive();Xr(t,g,i),i.applyMatrix4(n);const a=uo(e),d=co(e,p);Xr(a,h,na),Xr(d,h,ra);const m=i.intersectsBox(na),v=i.intersectsBox(ra);S=m&&sa(t,a,r,n,o,l,s,c,u+1,i,!f)||v&&sa(t,d,r,n,o,l,s,c,u+1,i,!f),ta.releasePrimitive(i)}else{const i=uo(t),a=co(t,v);Xr(i,g,oa),Xr(a,g,ia);const m=d.intersectsBox(oa),y=d.intersectsBox(ia);if(m&&y)S=sa(e,i,n,r,o,s,l,u,c+1,d,f)||sa(e,a,n,r,o,s,l,u,c+1,d,f);else if(m)if(x)S=sa(e,i,n,r,o,s,l,u,c+1,d,f);else{const t=ta.getPrimitive();t.copy(oa).applyMatrix4(n);const a=uo(e),d=co(e,p);Xr(a,h,na),Xr(d,h,ra);const m=t.intersectsBox(na),g=t.intersectsBox(ra);S=m&&sa(i,a,r,n,o,l,s,c,u+1,t,!f)||g&&sa(i,d,r,n,o,l,s,c,u+1,t,!f),ta.releasePrimitive(t)}else if(y)if(x)S=sa(e,a,n,r,o,s,l,u,c+1,d,f);else{const t=ta.getPrimitive();t.copy(ia).applyMatrix4(n);const i=uo(e),d=co(e,p);Xr(i,h,na),Xr(d,h,ra);const m=t.intersectsBox(na),g=t.intersectsBox(ra);S=m&&sa(a,i,r,n,o,l,s,c,u+1,t,!f)||g&&sa(a,d,r,n,o,l,s,c,u+1,t,!f),ta.releasePrimitive(t)}}return S}const la=new Mo,ua=new i.au,ca={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class da{static serialize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,o=e._indirectBuffer,i=n.getIndex();let a;return a=t.cloneBuffers?{roots:r.map(e=>e.slice()),index:i.array.slice(),indirectBuffer:o?o.slice():null}:{roots:r,index:i.array,indirectBuffer:o},a}static deserialize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n={setIndex:!0,indirect:!!e.indirectBuffer,...n};const{index:r,roots:o,indirectBuffer:a}=e,s=new da(t,{...n,[Fr]:!0});if(s._roots=o,s._indirectBuffer=a||null,n.setIndex){const n=t.getIndex();if(null===n){const n=new i.K(e.index,1,!1);t.setIndex(n)}else n.array!==r&&(n.array.set(r),n.needsUpdate=!0)}return s}get indirect(){return!!this._indirectBuffer}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if(t=Object.assign({...ca,[Fr]:!1},t),t.useSharedArrayBuffer&&!(typeof SharedArrayBuffer<"u"))throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Fr]||(So(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new i.au)));const{_indirectBuffer:n}=this;this.resolveTriangleIndex=t.indirect?e=>n[e]:e=>e}refit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(this.indirect?Mi:ni)(this,e)}traverse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this._roots[t],r=new Uint32Array(n),o=new Uint16Array(n);!function t(i){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const s=2*i,l=o[s+15]===Dr;if(l){const t=r[i+6],u=o[s+14];e(a,l,new Float32Array(n,4*i,6),t,u)}else{const o=i+8,s=r[i+6],u=r[i+7];e(a,l,new Float32Array(n,4*i,6),u)||(t(o,a+1),t(s,a+1))}}(0)}raycast(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.as;const n=this._roots,r=this.geometry,o=[],a=t.isMaterial,s=Array.isArray(t),l=r.groups,u=a?t.side:t,c=this.indirect?Ii:si;for(let i=0,d=n.length;i<d;i++){const n=s?t[l[i].materialIndex].side:u,r=o.length;if(c(this,i,n,e,o),s){const e=l[i].materialIndex;for(let t=r,n=o.length;t<n;t++)o[t].face.materialIndex=e}}return o}raycastFirst(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.as;const n=this._roots,r=this.geometry,o=t.isMaterial,a=Array.isArray(t);let s=null;const l=r.groups,u=o?t.side:t,c=this.indirect?Ni:di;for(let i=0,d=n.length;i<d;i++){const n=c(this,i,a?t[l[i].materialIndex].side:u,e);null!=n&&(null==s||n.distance<s.distance)&&(s=n,a&&(n.face.materialIndex=l[i].materialIndex))}return s}intersectsGeometry(e,t){let n=!1;const r=this._roots,o=this.indirect?Vi:bi;for(let i=0,a=r.length;i<a&&(n=o(this,i,e,t),!n);i++);return n}shapecast(e){const t=Ro.getPrimitive(),n=this.indirect?ii:ti;let{boundsTraverseOrder:r,intersectsBounds:o,intersectsRange:i,intersectsTriangle:a}=e;if(i&&a){const e=i;i=(r,o,i,s,l)=>!!e(r,o,i,s,l)||n(r,o,this,a,i,s,t)}else i||(i=a?(e,r,o,i)=>n(e,r,this,a,o,i,t):(e,t,n)=>n);let s=!1,l=0;const u=this._roots;for(let c=0,d=u.length;c<d;c++){const e=u[c];if(s=Bo(this,c,o,i,r,l),s)break;l+=e.byteLength}return Ro.releasePrimitive(t),s}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:o}=n;const a=Ro.getPrimitive(),s=this.geometry.index,l=this.geometry.attributes.position,u=this.indirect?e=>{const t=this.resolveTriangleIndex(e);ei(a,3*t,s,l)}:e=>{ei(a,3*e,s,l)},c=Ro.getPrimitive(),d=e.geometry.index,f=e.geometry.attributes.position,h=e.indirect?t=>{const n=e.resolveTriangleIndex(t);ei(c,3*n,d,f)}:e=>{ei(c,3*e,d,f)};if(o){const e=(e,n,r,i,s,l,d,f)=>{for(let p=r,m=r+i;p<m;p++){h(p),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let t=e,r=e+n;t<r;t++)if(u(t),a.needsUpdate=!0,o(a,c,t,p,s,l,d,f))return!0}return!1};if(r){const t=r;r=function(n,r,o,i,a,s,l,u){return!!t(n,r,o,i,a,s,l,u)||e(n,r,o,i,a,s,l,u)}}else r=e}return function(e,t,n,r){if(aa)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");aa=!0;const o=e._roots,a=t._roots;let s,l=0,u=0;const c=(new i.k).copy(n).invert();for(let i=0,d=o.length;i<d;i++){Ji.setBuffer(o[i]),u=0;const e=ta.getPrimitive();Xr(0,Ji.float32Array,e),e.applyMatrix4(c);for(let t=0,o=a.length;t<o&&(ea.setBuffer(a[i]),s=sa(0,0,n,c,r,l,u,0,0,e),ea.clearBuffer(),u+=a[t].length,!s);t++);if(ta.releasePrimitive(e),Ji.clearBuffer(),l+=o[i].length,s)break}return aa=!1,s}(this,e,t,r)}intersectsBox(e,t){return la.set(e.min,e.max,t),la.needsUpdate=!0,this.shapecast({intersectsBounds:e=>la.intersectsBox(e),intersectsTriangle:e=>la.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;return(this.indirect?Zi:Ci)(this,e,t,n,r,o,i)}closestPointToPoint(e){return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const i=r*r,a=o*o;let s=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(Uo.copy(t).clamp(e.min,e.max),Uo.distanceToSquared(t)),intersectsBounds:(e,t,n)=>n<s&&n<a,intersectsTriangle:(e,n)=>{e.closestPointToPoint(t,Uo);const r=t.distanceToSquared(Uo);return r<s&&(Fo.copy(Uo),s=r,l=n),r<i}}),s===1/0)return null;const u=Math.sqrt(s);return n.point?n.point.copy(Fo):n.point=Fo.clone(),n.distance=u,n.faceIndex=l,n}(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Xr(0,new Float32Array(t),ua),e.union(ua)}),e}}function fa(e,t,n){return null===e||(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e.distance<n.near||e.distance>n.far)?null:e}const ha=new i.s,pa=new i.k,ma=i.ad.prototype.raycast;function ga(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;pa.copy(this.matrixWorld).invert(),ha.copy(e.ray).applyMatrix4(pa);const n=this.geometry.boundsTree;if(!0===e.firstHitOnly){const r=fa(n.raycastFirst(ha,this.material),this,e);r&&t.push(r)}else{const r=n.raycast(ha,this.material);for(let n=0,o=r.length;n<o;n++){const o=fa(r[n],this,e);o&&t.push(o)}}}else ma.call(this,e,t)}function va(e){return this.boundsTree=new da(this,e),this.boundsTree}function ya(){this.boundsTree=null}const ba=e=>e.isMesh,xa=a.forwardRef((e,t)=>{let{enabled:n=!0,firstHitOnly:r=!1,children:o,strategy:s=jr,verbose:l=!1,setBoundingBox:u=!0,maxDepth:c=40,maxLeafTris:d=10,indirect:f=!1,...h}=e;const p=a.useRef(null),m=xe(e=>e.raycaster);return a.useImperativeHandle(t,()=>p.current,[]),a.useEffect(()=>{if(n){const e={strategy:s,verbose:l,setBoundingBox:u,maxDepth:c,maxLeafTris:d,indirect:f},t=p.current;return m.firstHitOnly=r,t.traverse(t=>{ba(t)&&!t.geometry.boundsTree&&t.raycast===i.ad.prototype.raycast&&(t.raycast=ga,t.geometry.computeBoundsTree=va,t.geometry.disposeBoundsTree=ya,t.geometry.computeBoundsTree(e))}),()=>{delete m.firstHitOnly,t.traverse(e=>{ba(e)&&e.geometry.boundsTree&&(e.geometry.disposeBoundsTree(),e.raycast=i.ad.prototype.raycast)})}}},[]),a.createElement("group",(0,i._)({ref:p},h),o)}),wa=a.forwardRef(function(e,t){let{children:n,disable:r,disableX:o,disableY:s,disableZ:l,left:u,right:c,top:d,bottom:f,front:h,back:p,onCentered:m,precise:g=!0,cacheKey:v=0,...y}=e;const b=a.useRef(null),x=a.useRef(null),w=a.useRef(null);return a.useLayoutEffect(()=>{x.current.matrixWorld.identity();const e=(new i.au).setFromObject(w.current,g),t=new i.c,n=new i.av,a=e.max.x-e.min.x,v=e.max.y-e.min.y,y=e.max.z-e.min.z;e.getCenter(t),e.getBoundingSphere(n);const S=d?v/2:f?-v/2:0,_=u?-a/2:c?a/2:0,E=h?y/2:p?-y/2:0;x.current.position.set(r||o?0:-t.x+_,r||s?0:-t.y+S,r||l?0:-t.z+E),typeof m<"u"&&m({parent:b.current.parent,container:b.current,width:a,height:v,depth:y,boundingBox:e,boundingSphere:n,center:t,verticalAlignment:S,horizontalAlignment:_,depthAlignment:E})},[v,m,d,u,h,r,o,s,l,g,c,f,p]),a.useImperativeHandle(t,()=>b.current,[]),a.createElement("group",(0,i._)({ref:b},y),a.createElement("group",{ref:x},a.createElement("group",{ref:w},n)))});function Sa(){const{controllers:e}=Ct(),t=(0,a.useRef)(),n=(0,a.useRef)();return we(()=>{if(e&&e[0]&&e[1]){if(e[0].controller){const n=e[0].hand.joints["index-finger-tip"].position;t.current.position.copy(n)}if(e[1].controller){const t=e[1].hand.joints["index-finger-tip"].position;n.current.position.copy(t)}}}),i.aI.jsxs(i.aI.Fragment,{children:[i.aI.jsxs("mesh",{name:"leftTipBbox",ref:n,children:[i.aI.jsx("boxGeometry",{args:[.02,.02,.02]}),i.aI.jsx("meshStandardMaterial",{color:"blue",transparent:!0,opacity:0})]}),i.aI.jsxs("mesh",{name:"rightTipBbox",ref:t,children:[i.aI.jsx("boxGeometry",{args:[.02,.02,.02]}),i.aI.jsx("meshStandardMaterial",{color:"orange",transparent:!0,opacity:0})]})]})}function _a(e){const{currentLine:t,scale:n}=e,r=(0,a.useRef)();return i.aI.jsxs("group",{children:[i.aI.jsx(wa,{bottom:!0,right:!0,position:[t.midPoint.x,t.midPoint.y,t.midPoint.z],rotation:[0,0,0],children:i.aI.jsx(Nr,{color:"gray",scale:.05,ref:r,children:`${(t.startPoint.distanceTo(t.endPoint)*n).toFixed(2)} \xb5m`})}),i.aI.jsx(zr,{points:[t.startPoint,t.endPoint],color:"white",lineWidth:2,dashed:!1,segments:!0})]})}function Ea(e){const{segmentationGroup:t,segmentationSettings:n,segmentationSceneScale:r,renderingSettings:o,materialRef:s,highlightEntity:l,setObsHighlight:u}=e,c=(0,a.useRef)(),d=(0,a.useRef)(),f=(0,a.useRef)(),{isPresenting:h}=Ct();(0,a.useEffect)(()=>{h&&c?.current?null!==s&&(s.current.material.uniforms.u_physical_Pixel.value=.2):h||null!==s&&(s.current.material.uniforms.u_physical_Pixel.value=2.5)},[h]);const{scene:p}=xe(),{controllers:m}=Ct(),[g,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[x,w]=(0,a.useState)(!1),[S,_]=(0,a.useState)({startPoint:new i.c,midPoint:new i.c,endPoint:new i.c,setStartPoint:!1,setEndPoint:!1}),[E,A]=(0,a.useState)([]),[T,P]=(0,a.useState)(0);return we(()=>{if(h){const e=p.getObjectByName("rightTipBbox"),t=p.getObjectByName("leftTipBbox"),n=(new i.au).setFromObject(t),r=(new i.au).setFromObject(e);let o=!1;if(P(T-1),n.intersectsBox(r)&&n.max.x!==-r.min.x&&(v(!0),w(!0),_({startPoint:new i.c,midPoint:new i.c,endPoint:new i.c,setStartPoint:!1,setEndPoint:!1})),g){let e=m[1].hand.joints["index-finger-tip"].position.clone(),t=m[0].hand.joints["index-finger-tip"].position.clone();e=e.applyMatrix4(f.current.matrixWorld.clone().invert()),t=t.applyMatrix4(f.current.matrixWorld.clone().invert());let n=e.clone(),r=t.clone();S.setStartPoint&&(n=S.startPoint),S.setEndPoint&&(r=S.endPoint),_({startPoint:n,midPoint:(new i.c).addVectors(n,r).multiplyScalar(.5),endPoint:r,setStartPoint:S.setStartPoint,setEndPoint:S.setEndPoint}),!0===m[0].hand.inputState.pinching&&_({startPoint:S.startPoint,midPoint:S.midPoint,endPoint:S.endPoint,setStartPoint:S.setStartPoint,setEndPoint:!0}),!0===m[1].hand.inputState.pinching&&_({startPoint:S.startPoint,midPoint:S.midPoint,endPoint:S.endPoint,setStartPoint:!0,setEndPoint:S.setEndPoint}),S.setStartPoint&&S.setEndPoint&&(E.push(S),A(E),w(!1),v(!1),P(8))}else T<=0&&c?.current&&h&&(c.current.children[0].children.forEach((e,t)=>{const a=c.current.children[0].children[t],s=(new i.au).setFromObject(a),l=n.intersectsBox(s),d=r.intersectsBox(s);(l||d)&&(o=!0,u(a.name),b(!0),void 0!==m[1]&&l&&!0===m[1].hand.inputState.pinching&&(P(10),o=!1,m[1].hand.inputState.pinching=!1),void 0!==m[0]&&d&&!0===m[0].hand.inputState.pinching&&(P(10),o=!1,m[0].hand.inputState.pinching=!1))}),!o&&y&&(u(null),b(!1)))}},[g,y,S,E,x,T,h]),i.aI.jsx("group",{children:Ct().isPresenting?i.aI.jsxs(bt,{children:[i.aI.jsxs("group",{ref:f,children:[t?.visible?i.aI.jsxs("group",{children:[i.aI.jsx("hemisphereLight",{skyColor:8421504,groundColor:6316128}),i.aI.jsx("directionalLight",{color:16777215,position:[0,-800,0]}),i.aI.jsx("primitive",{ref:c,object:t,position:[-.18,1.13,-1],scale:[.002*r[0],.002*r[1],.002*r[2]]})]}):null,o.uniforms&&o.shader?i.aI.jsx("group",{children:i.aI.jsxs("mesh",{name:"cube",position:[-.18,1.13,-1],rotation:[0,0,0],scale:[.002*o.meshScale[0],.002*o.meshScale[1],.002*o.meshScale[2]],ref:s,children:[i.aI.jsx("boxGeometry",{args:o.geometrySize}),i.aI.jsx("shaderMaterial",{customProgramCacheKey:()=>"1",side:i.as,uniforms:o.uniforms,needsUpdate:!0,transparent:!0,vertexShader:o.shader.vertexShader,fragmentShader:o.shader.fragmentShader})]})}):null]}),i.aI.jsx("group",{name:"currentLine",ref:d,children:x?i.aI.jsx(_a,{currentLine:S,scale:200}):null}),i.aI.jsx("group",{name:"lines",children:E.map(e=>i.aI.jsx(_a,{currentLine:e,scale:200}))})]}):i.aI.jsxs("group",{children:[i.aI.jsxs("group",{children:[t?.visible?i.aI.jsxs("group",{children:[i.aI.jsx("hemisphereLight",{skyColor:8421504,groundColor:6316128}),i.aI.jsx("directionalLight",{color:16777215,position:[0,-800,0]}),i.aI.jsx("directionalLight",{color:16777215,position:[0,800,0]}),i.aI.jsx(xa,{firstHitOnly:!0,children:i.aI.jsx("primitive",{ref:c,object:t,position:[0,0,0],onClick:e=>{"finalPass"===e.object.parent.userData.name&&l(e.object.name,e.object.userData.layerScope,e.object.userData.channelScope)},onPointerOver:e=>{u(e.object.name)},onPointerOut:e=>u(null)})})]}):null,o.uniforms&&o.shader?i.aI.jsx("group",{children:i.aI.jsxs("mesh",{scale:o.meshScale,ref:s,children:[i.aI.jsx("boxGeometry",{args:o.geometrySize}),i.aI.jsx("shaderMaterial",{customProgramCacheKey:()=>"1",side:i.as,uniforms:o.uniforms,needsUpdate:!0,transparent:!0,vertexShader:o.shader.vertexShader,fragmentShader:o.shader.fragmentShader})]})}):null]}),i.aI.jsx("group",{name:"lines",children:E.map(e=>i.aI.jsx(_a,{currentLine:e,scale:1}))})]})})}function Aa(){const{controllers:e}=Ct();return we(()=>{e?.[0]&&e?.[1]&&(e[0]?.hand?.children?.[25]?.children?.[0]?.children?.[0]&&(e[0].hand.children[25].children[0].children[0].material.transparent=!0,e[0].hand.children[25].children[0].children[0].material.opacity=.5),e[1]?.hand?.children?.[25]?.children?.[0]?.children?.[0]&&(e[1].hand.children[25].children[0].children[0].material.transparent=!0,e[1].hand.children[25].children[0].children[0].material.opacity=.5))}),null}class Ta{constructor(e,t,n,r,o){if(this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new i.aJ,this.matrix.identity(),this.sliceList=[],this.lowerThresholdValue=-1/0,this.upperThresholdValue=1/0,arguments.length>0){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(n)||1,r){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":default:this.data=new Uint8Array(o);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(o);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(o);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(o);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(o);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(o);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw new Error("uint64_t type is not supported in JavaScript");case"Float32":case"float32":case"float":this.data=new Float32Array(o);break;case"Float64":case"float64":case"double":this.data=new Float64Array(o)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw new Error("lengths are not matching arrayBuffer size")}}get lowerThreshold(){return this.lowerThresholdValue}set lowerThreshold(e){this.lowerThresholdValue=e,this.sliceList.forEach(e=>{e.geometryNeedsUpdate=!0})}get upperThreshold(){return this.upperThresholdValue}set upperThreshold(e){this.upperThresholdValue=e,this.sliceList.forEach(e=>{e.geometryNeedsUpdate=!0})}getData(e,t,n){return this.data[n*this.xLength*this.yLength+t*this.xLength+e]}access(e,t,n){return n*this.xLength*this.yLength+t*this.xLength+e}reverseAccess(e){const t=Math.floor(e/(this.yLength*this.xLength)),n=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-n*this.xLength,n,t]}map(e,t){const{length:n}=this.data,r=t||this;for(let o=0;o<n;o++)this.data[o]=e.call(r,this.data[o],o,this.data);return this}extractPerpendicularPlane(e,t){const n=(new i.k).identity(),r=this;let o,a,s,l;const u=new i.c,c=new i.c,d=new i.c,f=new i.c(this.xLength,this.yLength,this.zLength);switch(e){case"x":u.set(1,0,0),c.set(0,0,-1),d.set(0,-1,0),o=this.spacing[2],a=this.spacing[1],l=new i.c(t,0,0),n.multiply((new i.k).makeRotationY(Math.PI/2)),s=(r.RASDimensions[0]-1)/2,n.setPosition(new i.c(t-s,0,0));break;case"y":u.set(0,1,0),c.set(1,0,0),d.set(0,0,1),o=this.spacing[0],a=this.spacing[2],l=new i.c(0,t,0),n.multiply((new i.k).makeRotationX(-Math.PI/2)),s=(r.RASDimensions[1]-1)/2,n.setPosition(new i.c(0,t-s,0));break;default:u.set(0,0,1),c.set(1,0,0),d.set(0,-1,0),o=this.spacing[0],a=this.spacing[1],l=new i.c(0,0,t),s=(r.RASDimensions[2]-1)/2,n.setPosition(new i.c(0,0,t-s))}c.applyMatrix4(r.inverseMatrix).normalize(),c.argVar="i",d.applyMatrix4(r.inverseMatrix).normalize(),d.argVar="j",u.applyMatrix4(r.inverseMatrix).normalize();const h=Math.floor(Math.abs(c.dot(f))),p=Math.floor(Math.abs(d.dot(f))),m=Math.abs(h*o),g=Math.abs(p*a);l=Math.abs(Math.round(l.applyMatrix4(r.inverseMatrix).dot(u)));const v=[new i.c(1,0,0),new i.c(0,1,0),new i.c(0,0,1)],y=[c,d,u].find(e=>Math.abs(e.dot(v[0]))>.9),b=[c,d,u].find(e=>Math.abs(e.dot(v[1]))>.9),x=[c,d,u].find(e=>Math.abs(e.dot(v[2]))>.9);return{iLength:h,jLength:p,sliceAccess:function(e,t){const n=y===u?l:"i"===y.arglet?e:t,o=b===u?l:"i"===b.arglet?e:t,i=x===u?l:"i"===x.arglet?e:t,a=y.dot(v[0])>0?n:r.xLength-1-n,s=b.dot(v[1])>0?o:r.yLength-1-o,c=x.dot(v[2])>0?i:r.zLength-1-i;return r.access(a,s,c)},matrix:n,planeWidth:m,planeHeight:g}}computeMinMax(){let e=1/0,t=-1/0;const n=this.data.length;let r=0;for(r=0;r<n;r++)if(!Number.isNaN(this.data[r])){const n=this.data[r];e=Math.min(e,n),t=Math.max(t,n)}return this.min=e,this.max=t,[e,t]}}const Pa={uniforms:{u_size:{value:new i.c(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_opacity:{value:.5},u_clim:{value:new i.d(.2,.8)},u_clim2:{value:new i.d(.2,.8)},u_clim3:{value:new i.d(.2,.8)},u_clim4:{value:new i.d(.2,.8)},u_clim5:{value:new i.d(.2,.8)},u_clim6:{value:new i.d(.2,.8)},u_xClip:{value:new i.d(-1,1e6)},u_yClip:{value:new i.d(-1,1e6)},u_zClip:{value:new i.d(-1,1e6)},u_data:{value:null},u_stop_geom:{value:null},u_geo_color:{value:null},u_window_size:{value:new i.d(1,1)},u_vol_scale:{value:new i.d(1,1,1)},u_physical_Pixel:{value:.5},volumeTex:{value:null},volumeTex2:{value:null},volumeTex3:{value:null},volumeTex4:{value:null},volumeTex5:{value:null},volumeTex6:{value:null},u_color:{value:new i.c(0,0,0)},u_color2:{value:new i.c(0,0,0)},u_color3:{value:new i.c(0,0,0)},u_color4:{value:new i.c(0,0,0)},u_color5:{value:new i.c(0,0,0)},u_color6:{value:new i.c(0,0,0)},u_cmdata:{value:null},near:{value:.1},far:{value:1e4},alphaScale:{value:0},dtScale:{value:1},volumeCount:{value:0},finalGamma:{value:0},boxSize:{value:new i.c(1,1,1)}},vertexShader:["out vec3 rayDirUnnorm;","out vec3 cameraCorrected;","uniform vec3 u_vol_scale;","uniform vec3 u_size;","varying vec3 worldSpaceCoords;","varying vec2 vUv;","varying vec4 glPosition;","uniform highp vec3 boxSize;","void main()","{","   worldSpaceCoords = position / boxSize + vec3(0.5, 0.5, 0.5); //move it from [-0.5;0.5] to [0,1]","   cameraCorrected = (inverse(modelMatrix) * vec4(cameraPosition, 1.)).xyz;","   rayDirUnnorm = position - cameraCorrected;","   gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","   glPosition = gl_Position;","   vUv = uv;","}"].join("\n"),fragmentShader:["#include <packing>","precision highp float;"," precision mediump sampler3D;","in vec3 rayDirUnnorm;","in vec3 cameraCorrected;","uniform sampler3D volumeTex;","uniform sampler3D volumeTex2;","uniform sampler3D volumeTex3;","uniform sampler3D volumeTex4;","uniform sampler3D volumeTex5;","uniform sampler3D volumeTex6;","uniform vec2 u_clim;","uniform vec2 u_clim2;","uniform vec2 u_clim3;","uniform vec2 u_clim4;","uniform vec2 u_clim5;","uniform vec2 u_clim6;","uniform vec2 u_window_size;","uniform vec2 u_xClip;","uniform vec2 u_yClip;","uniform vec2 u_zClip;","uniform sampler2D u_cmdata;","uniform sampler2D u_stop_geom;","uniform sampler2D u_geo_color;","uniform vec3 u_color;","uniform vec3 u_color2;","uniform vec3 u_color3;","uniform vec3 u_color4;","uniform vec3 u_color5;","uniform vec3 u_color6;","uniform float alphaScale;","uniform float dtScale;","uniform float finalGamma;","uniform float volumeCount;","uniform highp vec3 boxSize;","uniform vec3 u_size;","uniform int u_renderstyle;","uniform float u_opacity;","uniform vec3 u_vol_scale;","uniform float near;","uniform float u_physical_Pixel;","varying vec2 vUv;","varying vec4 glPosition;","uniform float far;","varying vec3 worldSpaceCoords;","float linearize_z(float z) {","        return near * far / (far + z * (near - far));","}","vec2 intersect_hit(vec3 orig, vec3 dir) {","  vec3 boxMin = vec3(-0.5) * boxSize;","  vec3 boxMax = vec3( 0.5) * boxSize;","  if(u_xClip.x > -1.0){   boxMin.x = u_xClip.x-(boxSize.x/2.0);","   if(u_xClip.y < boxSize.x)","       boxMax.x = u_xClip.y-(boxSize.x/2.0);","  }","  if(u_yClip.x > -1.0){   boxMin.y = u_yClip.x-(boxSize.y/2.0);","   if(u_yClip.y < boxSize.y)","      boxMax.y = u_yClip.y-(boxSize.y/2.0);","  }","  if(u_zClip.x > -1.0){   boxMin.z = u_zClip.x-(boxSize.z/2.0);","   if(u_zClip.y < boxSize.z)       boxMax.z = u_zClip.y-(boxSize.z/2.0);","  }","  vec3 invDir = 1.0 / dir;","  vec3 tmin0 = (boxMin - orig) * invDir;","  vec3 tmax0 = (boxMax - orig) * invDir;","  vec3 tmin = min(tmin0, tmax0);","  vec3 tmax = max(tmin0, tmax0);","  float t0 = max(tmin.x, max(tmin.y, tmin.z));","  float t1 = min(tmax.x, min(tmax.y, tmax.z));","  return vec2(t0, t1);","}","   // Pseudo-random number gen from","   // http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/","   // with some tweaks for the range of values","       float wang_hash(int seed) {","     seed = (seed ^ 61) ^ (seed >> 16);","     seed *= 9;","     seed = seed ^ (seed >> 4);","     seed *= 0x27d4eb2d;","     seed = seed ^ (seed >> 15);","     return float(seed % 2147483647) / float(2147483647);","     }","float linear_to_srgb(float x) {","   if (x <= 0.0031308f) {","     return 12.92f * x;","   }","   return 1.055f * pow(x, 1.f / 2.4f) - 0.055f;","}","void main(void) {","  //STEP 1: Normalize the view Ray","  vec3 rayDir = normalize(rayDirUnnorm);","  //STEP 2: Intersect the ray with the volume bounds to find the interval along the ray overlapped by the volume","  vec2 t_hit = intersect_hit(cameraCorrected, rayDir);","  if (t_hit.x >= t_hit.y) {","    discard;","  }","  //No sample behind the eye","  t_hit.x = max(t_hit.x, 0.0);","  //STEP 3: Compute the step size to march through the volume grid","  ivec3 volumeTexSize = textureSize(volumeTex, 0);","  vec3 dt_vec = 1.0 / (vec3(volumeTexSize) * abs(rayDir));","  float dt = min(dt_vec.x, min(dt_vec.y, dt_vec.z));","  dt = max(1.0, dt);","  // Ray starting point, in the real space where the box may not be a cube.","  // Prevents a lost WebGL context."," float offset = wang_hash(int(gl_FragCoord.x + 640.0 * gl_FragCoord.y));"," vec3 p = cameraCorrected + (t_hit.x + offset + dt) * rayDir;","  // Most browsers do not need this initialization, but add it to be safe.","  gl_FragColor = vec4(0.0);","  p = p / boxSize + vec3(0.5);","  vec3 step = (rayDir * dt) / boxSize;","  // ","  // Initialization of some variables.","  float max_val = 0.0;","  float max_val2 = 0.0;","  float max_val3 = 0.0;","  float max_val4 = 0.0;","  float max_val5 = 0.0;","  float max_val6 = 0.0;","  vec3 rgbCombo = vec3(0.0);","  float total = 0.0;","  int max_i = 30000;","  int i = 0;","  float x = gl_FragCoord.x/u_window_size.x;","  float y = gl_FragCoord.y/u_window_size.y;","  vec3 meshPos = texture2D(u_stop_geom, vec2(x,y)).xyz;","  float dist = 1000.0;","  for (float t = t_hit.x; t < t_hit.y; t += dt) {","       if(meshPos != vec3(0.0))           dist = distance(p,meshPos);","      float val = texture(volumeTex, p.xyz).r;","      val = max(0.0, (val - u_clim[0]) / (u_clim[1] - u_clim[0]));","      rgbCombo += max(0.0, min(1.0, val)) * u_color;","      total += val;","      if(volumeCount > 1.0){           float val2 = texture(volumeTex2, p.xyz).r;","           val2 = max(0.0,(val2 - u_clim2[0]) / (u_clim2[1] - u_clim2[0]));","           rgbCombo += max(0.0, min(1.0, val2)) * u_color2;","           total += val2;","       }","       if(volumeCount > 2.0){           float val3 = texture(volumeTex3, p.xyz).r;","           val3 = max(0.0,(val3 - u_clim3[0]) / (u_clim3[1] - u_clim3[0]));","           rgbCombo += max(0.0, min(1.0, val3)) * u_color3;","           total += val3;","       }","       if(volumeCount > 3.0){           float val4 = texture(volumeTex4, p.xyz).r;","           val4 = max(0.0,(val4 - u_clim4[0]) / (u_clim4[1] - u_clim4[0]));","           rgbCombo += max(0.0, min(1.0, val4)) * u_color4;","           total += val4;","       }","       if(volumeCount > 4.0){           float val5 = texture(volumeTex5, p.xyz).r;","           val5 = max(0.0,(val5 - u_clim5[0]) / (u_clim5[1] - u_clim5[0]));","           rgbCombo += max(0.0, min(1.0, val5)) * u_color5;","           total += val5;","        }","        if(volumeCount > 5.0){           float val6 = texture(volumeTex6, p.xyz).r;","           val6 = max(0.0,(val6 - u_clim6[0]) / (u_clim6[1] - u_clim6[0]));","           rgbCombo += max(0.0, min(1.0, val6)) * u_color6;","           total += val6;","       }","       if(total > 0.0 && dist < 0.1){","           break;","       }else if(dist < 0.1){           gl_FragColor = vec4(0.0,0.0,0.0,0.0);","           break;","       }","       if(u_renderstyle == 0 && (max_val > u_clim[1] && max_val2 >= u_clim2[1] && max_val3 >= u_clim3[1] && max_val4 >= u_clim4[1] && max_val5 >= u_clim5[1] &&  max_val6 >= u_clim6[1])) break;","       if(u_renderstyle == 2){           total = min(total, 1.0);","           vec4 val_color = vec4(rgbCombo, total);","           val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);","           gl_FragColor.rgb += (1.0 - gl_FragColor.a) * val_color.a * val_color.rgb;","           gl_FragColor.a += (1.0 - gl_FragColor.a) * val_color.a * dtScale;","           if (gl_FragColor.a >= 0.95) {","               break;","           }","       }","       p += step;","  }","   gl_FragDepth = distance(worldSpaceCoords,p)*u_physical_Pixel;","   if(u_renderstyle == 0 && (max_val <  u_clim[0] && max_val2 < u_clim2[0] && max_val3 < u_clim3[0] &&   max_val4 <  u_clim4[0] && max_val5 <  u_clim5[0] && max_val6 <  u_clim6[0])){","        gl_FragColor = vec4(0,0,0,0);","   }else if(u_renderstyle == 0){","       max_val = (max_val - u_clim[0]) / (u_clim[1] - u_clim[0]);","       max_val2 = (max_val2 - u_clim2[0]) / (u_clim2[1] - u_clim2[0]);","       max_val3 = (max_val3 - u_clim3[0]) / (u_clim3[1] - u_clim3[0]);","       max_val4 = (max_val4 - u_clim4[0]) / (u_clim4[1] - u_clim4[0]);","       max_val5 = (max_val5 - u_clim5[0]) / (u_clim5[1] - u_clim5[0]);","       max_val6 = (max_val6 - u_clim6[0]) / (u_clim6[1] - u_clim6[0]);","       vec3 color = u_color * max_val;","       if(volumeCount > 1.0) color = color +  u_color2 * max_val2;","       if(volumeCount > 3.0) color = color +  u_color4 * max_val4;","       if(volumeCount > 2.0) color = color +  u_color3 * max_val3;","       if(volumeCount > 4.0) color = color +  u_color5 * max_val5;","       if(volumeCount > 5.0) color = color +  u_color6 * max_val6;","       vec3 colorCorrected = vec3(min(color[0], 1.0), min(color[1],1.0), min(color[2],1.0));","        gl_FragColor = vec4(color,1.0);","    }","    gl_FragColor.r = linear_to_srgb(gl_FragColor.r);","    gl_FragColor.g = linear_to_srgb(gl_FragColor.g);","    gl_FragColor.b = linear_to_srgb(gl_FragColor.b);","}"].join("\n")},Ca={maximumIntensityProjection:0,minimumIntensityProjection:1,additive:2};function Ma(e,t,n,r,o){const{images:a={},imageLayerScopes:s,imageLayerCoordination:l,imageChannelScopesByLayer:u,imageChannelCoordination:c}=e,d=s[0],f=u[d],h=l[0][d],p=c[0][d],{channelsVisible:m,allChannels:g,channelTargetC:v,resolution:y,data:b,colors:x,contrastLimits:w,is3dMode:S,renderingMode:_,layerTransparency:E,xSlice:A,ySlice:T,zSlice:P}=function(e,t,n,r,o,a){const{spatialRenderingMode:s}=a,l=o?.image?.instance?.getData();if(!l)return{channelsVisible:null,resolution:null,data:null,colors:null,contrastLimits:null,allChannels:null,channelTargetC:null};const u=o.image.instance,c="3D"===s,d="RGB"===t[i.aK.PHOTOMETRIC_INTERPRETATION],f=t[i.aK.VOLUMETRIC_RENDERING_ALGORITHM],h=Ca[f],p=t[i.aK.SPATIAL_LAYER_VISIBLE],m=t[i.aK.SPATIAL_LAYER_OPACITY];u.isInterleaved();const g=d?[[255,0,0],[0,255,0],[0,0,255]]:n.map(e=>r[e][i.aK.SPATIAL_CHANNEL_COLOR]),v=d?[[0,255],[0,255],[0,255]]:n.map(e=>r[e][i.aK.SPATIAL_CHANNEL_WINDOW]||[0,255]),y=d?[p&&!0,p&&!0,p&&!0]:n.map(e=>p&&r[e][i.aK.SPATIAL_CHANNEL_VISIBLE]),b=d?[p&&!0,p&&!0,p&&!0]:n.map(e=>p&&u.getChannelIndex(r[e][i.aK.SPATIAL_TARGET_C])),x=u.getAutoTargetResolution(),w=t[i.aK.SPATIAL_TARGET_RESOLUTION],S=null===w||Number.isNaN(w)?x:w,_=o.image.loaders[0].channels;let E=t[i.aK.SPATIAL_SLICE_X],A=t[i.aK.SPATIAL_SLICE_Y],T=t[i.aK.SPATIAL_SLICE_Z];return E=null!==E?E:new i.d(-1,1e5),A=null!==A?A:new i.d(-1,1e5),T=null!==T?T:new i.d(-1,1e5),{channelsVisible:y,allChannels:_,channelTargetC:b,resolution:S,data:l,colors:g,contrastLimits:v,is3dMode:c,renderingMode:h,layerTransparency:m,xSlice:E,ySlice:A,zSlice:T}}(0,h,f,p,a[d],e);return null!==v&&(0===t.channelTargetC.length||t.channelTargetC.toString()===v.toString()&&t.resolution.toString()===y.toString()?(t.channelsVisible.toString()!==m.toString()||t.colors.toString()!==x.toString()||t.is3dMode!==S||t.contrastLimits.toString()!==w.toString()||t.renderingMode.toString()!==_.toString()||t.layerTransparency.toString()!==E.toString()||t.xSlice.toString()!==A.toString()||t.ySlice.toString()!==T.toString()||t.zSlice.toString()!==P.toString())&&(n({channelsVisible:m,allChannels:g,channelTargetC:v,resolution:y,data:b,colors:x,contrastLimits:w,is3dMode:S,renderingMode:_,layerTransparency:E,xSlice:A,ySlice:T,zSlice:P}),o(!1)):r||o(!0)),{images:a,layerScope:d,imageLayerScopes:s,imageLayerCoordination:l,imageChannelScopesByLayer:u,imageChannelCoordination:c,channelsVisible:m,allChannels:g,channelTargetC:v,resolution:y,data:b,colors:x,contrastLimits:w,is3dMode:S,renderingMode:_,layerTransparency:E,xSlice:A,ySlice:T,zSlice:P}}function La(e,t){const[n,r]=t;return(e-n)/Math.sqrt(r**2-n**2)}function Ia(e,t,n,r,o,a,s,l,u,c,d,f,h,p){const m=[],g=[],v=[];let y=null,b=l;if(null==b||!Array.isArray(b)||b.length<3)b=[{size:b?.[0]?.size??1},{size:b?.[1]?.size??1},{size:b?.[2]?.size??1}];else for(let i=0;i<b.length;i++)(!b[i]||void 0===b[i].size||null===b[i].size)&&(b[i]={size:1});if(t.forEach((t,i)=>{n[i]&&(y=e.get(t),m.push(o.get(t)),g.push([r[i][0]/255,r[i][1]/255,r[i][2]/255]),0===a[i][0]&&255===a[i][1]?v.push([La(s.get(t)[0],s.get(t)),La(s.get(t)[1],s.get(t))]):v.push([La(a[i][0],s.get(t)),La(a[i][1],s.get(t))]))}),null===y)return null;const x=Pa,w=i.aB.clone(x.uniforms);return function(e,t,n,r,o,i,a,s,l,u,c,d,f){e.boxSize.value.set(n.xLength,n.yLength,n.zLength),e.volumeTex.value=t.length>0?t[0]:null,e.volumeTex2.value=t.length>1?t[1]:null,e.volumeTex3.value=t.length>2?t[2]:null,e.volumeTex4.value=t.length>3?t[3]:null,e.volumeTex5.value=t.length>4?t[4]:null,e.volumeTex6.value=t.length>5?t[5]:null,e.near.value=.1,e.far.value=3e3,e.alphaScale.value=1,e.dtScale.value=s,e.finalGamma.value=4.5,e.volumeCount.value=t.length,e.u_size.value.set(n.xLength,n.yLength,n.zLength),e.u_stop_geom.value=null,e.u_window_size.value.set(0,0),e.u_vol_scale.value.set(1/n.xLength,1/n.yLength,1/n.zLength*2),e.u_renderstyle.value=o,e.u_clim.value.set(i.length>0?i[0][0]:null,i.length>0?i[0][1]:null),e.u_clim2.value.set(i.length>1?i[1][0]:null,i.length>1?i[1][1]:null),e.u_clim3.value.set(i.length>2?i[2][0]:null,i.length>2?i[2][1]:null),e.u_clim4.value.set(i.length>3?i[3][0]:null,i.length>3?i[3][1]:null),e.u_clim5.value.set(i.length>4?i[4][0]:null,i.length>4?i[4][1]:null),e.u_clim6.value.set(i.length>5?i[5][0]:null,i.length>5?i[5][1]:null),e.u_xClip.value.set(l[0]*(1/d[0])/f[0]*n.xLength,l[1]*(1/d[0])/f[0]*n.xLength),e.u_yClip.value.set(u[0]*(1/d[1])/f[1]*n.yLength,u[1]*(1/d[1])/f[1]*n.yLength),e.u_zClip.value.set(c[0]*(1/d[2])/f[2]*n.zLength,c[1]*(1/d[1])/f[2]*n.zLength),e.u_color.value.set(a.length>0?a[0][0]:null,a.length>0?a[0][1]:null,a.length>0?a[0][2]:null),e.u_color2.value.set(a.length>1?a[1][0]:null,a.length>1?a[1][1]:null,a.length>1?a[1][2]:null),e.u_color3.value.set(a.length>2?a[2][0]:null,a.length>2?a[2][1]:null,a.length>2?a[2][2]:null),e.u_color4.value.set(a.length>3?a[3][0]:null,a.length>3?a[3][1]:null,a.length>3?a[3][2]:null),e.u_color5.value.set(a.length>4?a[4][0]:null,a.length>4?a[4][1]:null,a.length>4?a[4][2]:null),e.u_color6.value.set(a.length>5?a[5][0]:null,a.length>5?a[5][1]:null,a.length>5?a[5][2]:null)}(w,m,y,0,u,v,g,c,d,f,h,[b[0].size,b[1].size,b[2]?b[2].size:1],p),[w,x,[1,b[1].size/b[0].size,b[2]?b[2].size/b[0].size:1],[y.xLength,y.yLength,y.zLength],[1,y.yLength/y.xLength,y.zLength/y.xLength]]}const Ra={Uint8:Uint8Array,Uint16:Uint16Array,Uint32:Uint32Array,Int8:Int8Array,Int16:Int16Array,Int32:Int32Array,Float32:Float32Array,Float64:Float64Array};function ka(e,t,n){return async function(e){let{source:t,selection:n,onUpdate:r=()=>{},downsampleDepth:o=1,signal:a}=e;const{shape:s,labels:l,dtype:u}=t,{height:c,width:d}=(0,i.aO)(t),f=s[l.indexOf("z")],h=Math.max(1,Math.floor(f/o)),p=c*d,m=new(0,Ra[u])(p*h);return await Promise.all(new Array(h).fill(0).map(async(e,i)=>{const s={...n,z:i*o},{data:l}=await t.getRaster({selection:s,signal:a});let u=0;for(r({z:i,total:h,progress:.5});u<p;){const e=i*p+(p-u-1),t=(d-u-1)%d+d*Math.floor(u/d);m[e]=l[t],u+=1}r({z:i,total:h,progress:1})})),{data:m,height:c,width:d,depth:h}}({source:n[t],selection:{t:0,c:e},downsampleDepth:2**t})}async function za(e,t,n,r,o,a,s){let l=null,u=null;const{shape:c,labels:d}=n[0],f=e.filter(e=>!r.has(e)||t!==s),h=await Promise.all(f.map(e=>ka(e,t,n)));return f.forEach((e,s)=>{const c=h[s];l=function(e){const t=new Ta;return t.xLength=e.width,t.yLength=e.height,t.zLength=e.depth,t.data=e.data,t}(c);const d=l.computeMinMax();l.data=function(e){const[t,n]=e.computeMinMax(),r=new Float32Array(e.data.length);for(let o=0;o<e.data.length;o++)r[o]=(e.data[o]-t)/Math.sqrt(n**2-t**2);return r}(l),r.set(e,l),o.set(e,function(e){const t=new i.aL(e.data,e.xLength,e.yLength,e.zLength);return t.format=i.aM,t.type=i.aN,t.generateMipmaps=!1,t.minFilter=i.a1,t.magFilter=i.a1,t.needsUpdate=!0,t}(l)),a.set(e,d),u=function(e){const{x:t,y:n,z:r}=e?.meta?.physicalSizes??{};return[t,n,r]}(n[t])}),[r,o,a,u,[c[d.indexOf("x")],c[d.indexOf("y")],c[d.indexOf("z")]]]}function Na(e){const t=(0,a.useRef)(null),n=(0,a.useRef)(null),[r,o]=(0,a.useState)(!1),[s,l]=(0,a.useState)(!1),[u,c]=(0,a.useState)(null),[d,f]=(0,a.useState)([1,1,1]),[h,p]=(0,a.useState)({uniforms:null,shader:null,meshScale:null,geometrySize:null,boxSize:null}),[m,g]=(0,a.useState)({volumes:new Map,textures:new Map,volumeMinMax:new Map,scale:null,resolution:null,originalScale:null}),[v,y]=(0,a.useState)({channelsVisible:[],allChannels:[],channelTargetC:[],resolution:null,data:null,colors:[],contrastLimits:[],is3dMode:!1,renderingMode:null,layerTransparency:1}),[b,x]=(0,a.useState)({visible:!0,color:[1,1,1],opacity:1,multiVisible:"",multiOpacity:"",multiColor:"",data:null,obsSets:[]}),{images:w,layerScope:S,channelsVisible:_,allChannels:E,channelTargetC:A,resolution:T,data:P,colors:C,contrastLimits:M,is3dMode:L,renderingMode:I,layerTransparency:R,xSlice:k,ySlice:z,zSlice:N}=Ma(e,v,y,s,l),{obsSegmentations:O,onEntitySelected:j,segmentationLayerCoordination:B,segmentationChannelCoordination:D,segmentationChannelScopesByLayer:U}=e;let F=()=>{};const H=[];if(void 0!==D[0][S]){const e=D[0][S][S],{setObsHighlight:t}=D[1][S][S];F=t;const n=D[0][S][S].additionalObsSets;null!==n&&e.obsSetSelection.forEach(t=>{const r=t[1];n.tree[0].children.forEach(t=>{t.name===r&&t.set.forEach(t=>{let[n]=t;const o={name:"",id:"",color:[255,255,255]};o.name=r,o.id=n,e.obsSetColor.forEach(e=>{e.path[1]===r&&(o.color=e.color)}),H.push(o)})})}),null!==e.obsHighlight&&H.push({name:"",id:e.obsHighlight,color:[255,34,0]})}if(O?.[S]?.obsSegmentations&&null==u){const{scene:e,sceneOptions:t}=O[S].obsSegmentations;if(e?.children){const n=new i.S,r=new i.G;r.userData.name="finalPass",e.children.forEach(e=>{let n=e;void 0===n.material&&(n=e.children[0]),(n.material instanceof i.w||n.material instanceof i.aa)&&(n.material=new i.a8);let o=n.name.replace("mesh_","").replace("mesh","").replace("glb","").replace("_dec","").replace("_Decobj","").replace("obj","").replace("_DEc","").replace(".","").replace("_Dec","");o.includes("_")&&(o=o.split("_")[0]),n.name=o,n.userData.name=o,n.userData.layerScope=S,n.material.transparent=!0,n.material.writeDepthTexture=!0,n.material.depthTest=!0,n.material.depthWrite=!0,n.material.needsUpdate=!0,n.material.side="back"===t?.materialSide?i.aH:i.as;const a=n.clone();a.geometry=n.geometry.clone(),a.geometry.translate(t?.targetX??0,t?.targetY??0,t?.targetZ??0),a.geometry.scale(t?.scaleX??1,t?.scaleY??1,t?.scaleZ??1),a.geometry.rotateX(t?.rotationX??0),a.geometry.rotateY(t?.rotationY??0),a.geometry.rotateZ(t?.rotationZ??0);const s=n.clone();s.material=n.material.clone(),s.geometry=a.geometry.clone(),r.add(s)}),n.add(r),n.scale.set(t?.sceneScaleX??1,t?.sceneScaleY??1,t?.sceneScaleZ??1);f([t?.sceneScaleX??1,t?.sceneScaleY??1,t?.sceneScaleZ??1]),n.rotateX(t?.sceneRotationX??0),n.rotateY(t?.sceneRotationY??0),n.rotateZ(t?.sceneRotationZ??0),c(n)}}if(void 0!==D[0]&&void 0!==D[0][S]){const e=D[0][S][S];let t="";H.forEach(e=>{t+=`${e.id};${e.color.toString()};${e.name}`});let n="";if(b.obsSets.forEach(e=>{n+=`${e.id};${e.color.toString()};${e.name}`}),U[S].length>1){let t="",n="",r="",o=!1,i=0;U[S].forEach(e=>{const a=D[0][S][e];t+=`${a.spatialChannelColor.toString()};`,n+=`${a.spatialChannelOpacity};`,r+=`${a.spatialChannelVisible};`,o|=a.spatialChannelVisible,i+=a.spatialChannelOpacity}),(t!==b.multiColor||n!==b.multiOpacity||r!==b.multiVisible)&&x({color:e.spatialChannelColor,opacity:i,visible:o,multiColor:t,multiVisible:r,multiOpacity:n,data:O,obsSets:H})}else(e.spatialChannelColor.toString()!==b.color.toString()||e.spatialChannelVisible!==b.visible||e.spatialChannelOpacity!==b.opacity||t!==n)&&x({color:e.spatialChannelColor,opacity:e.spatialChannelOpacity,visible:e.spatialChannelVisible,multiColor:"",multiVisible:"",multiOpacity:"",data:O,obsSets:H})}if((0,a.useEffect)(()=>{if(null!==u){let e=0,t=0;for(let n=0;n<u.children.length;n++)"finalPass"===u.children[n].userData.name?t=n:e=n;u.children[t].children.forEach((t,n)=>{let{color:r}=b;const o=t.userData.name;if(b.obsSets.forEach(e=>{e.id===o&&(r=e.color)}),U[S].length>1)U[S].forEach(r=>{const i=D[0][S][r];i.spatialTargetC===o&&(t.material.color.r=i.spatialChannelColor[0]/255,t.material.color.g=i.spatialChannelColor[1]/255,t.material.color.b=i.spatialChannelColor[2]/255,t.material.opacity=i.spatialChannelOpacity,t.visible=i.spatialChannelVisible,t.material.needsUpdate=!0,t.userData.layerScope=S,t.userData.channelScope=r,u.children[e].children[n].material.needsUpdate=!0)});else{t.material.color.r=r[0]/255,t.material.color.g=r[1]/255,t.material.color.b=r[2]/255,t.material.opacity=b.opacity,t.material.visible=b.visible,t.material.needsUpdate=!0,t.userData.layerScope=S;const e=Object.keys(D[0][S])?.[0];t.userData.channelScope=e}})}},[b,u]),void 0!==w[S]?.image?.instance?.getData()&&!s&&!r&&null!==M&&255!==M[0][1]&&L&&(l(!0),o(!0)),(0,a.useEffect)(()=>{s&&(T!==v.resolution&&t.current&&(t.current.material.uniforms.volumeCount.value=0,t.current.material.uniforms.volumeTex.value=null),(async()=>{const e=await za(A,T,P,m.volumes,m.textures,m.volumeMinMax,m.resolution);if(null!==e[0])if(g({resolution:T,volumes:e[0],textures:e[1],volumeMinMax:e[2],scale:null!==e[3]?e[3]:m.scale,originalScale:e[4]}),h.uniforms&&h.shader)y({channelsVisible:_,allChannels:E,channelTargetC:A,resolution:T,data:P,colors:C,contrastLimits:M,is3dMode:L,renderingMode:I,layerTransparency:R,xSlice:k,ySlice:z,zSlice:N});else{const t=Ia(e[0],A,_,C,e[1],M,e[2],e[3],I,R,k,z,N,e[4]);null!==t&&p({uniforms:t[0],shader:t[1],meshScale:t[2],geometrySize:t[3],boxSize:t[4]})}})(),l(!1))},[s]),(0,a.useEffect)(()=>{if(h.uniforms&&h.shader){const e=Ia(m.volumes,v.channelTargetC,v.channelsVisible,v.colors,m.textures,v.contrastLimits,m.volumeMinMax,m.scale,v.renderingMode,v.layerTransparency,v.xSlice,v.ySlice,v.zSlice,m.originalScale);if(null!==e){let n=0;v.channelsVisible.forEach(e=>{e&&n++}),l(!1),t?.current?.material?.uniforms&&(t.current.material.uniforms.u_clim.value=e[0].u_clim.value,t.current.material.uniforms.u_clim2.value=e[0].u_clim2.value,t.current.material.uniforms.u_clim3.value=e[0].u_clim3.value,t.current.material.uniforms.u_clim4.value=e[0].u_clim4.value,t.current.material.uniforms.u_clim5.value=e[0].u_clim5.value,t.current.material.uniforms.u_clim6.value=e[0].u_clim6.value,t.current.material.uniforms.u_xClip.value=e[0].u_xClip.value,t.current.material.uniforms.u_yClip.value=e[0].u_yClip.value,t.current.material.uniforms.u_zClip.value=e[0].u_zClip.value,t.current.material.uniforms.u_color.value=e[0].u_color.value,t.current.material.uniforms.u_color2.value=e[0].u_color2.value,t.current.material.uniforms.u_color3.value=e[0].u_color3.value,t.current.material.uniforms.u_color4.value=e[0].u_color4.value,t.current.material.uniforms.u_color5.value=e[0].u_color5.value,t.current.material.uniforms.u_color6.value=e[0].u_color6.value,t.current.material.uniforms.volumeTex.value=e[0].volumeTex.value,t.current.material.uniforms.volumeTex2.value=e[0].volumeTex2.value,t.current.material.uniforms.volumeTex3.value=e[0].volumeTex3.value,t.current.material.uniforms.volumeTex4.value=e[0].volumeTex4.value,t.current.material.uniforms.volumeTex5.value=e[0].volumeTex5.value,t.current.material.uniforms.volumeTex6.value=e[0].volumeTex6.value,t.current.material.uniforms.volumeCount.value=n,t.current.material.uniforms.u_renderstyle.value=v.renderingMode,t.current.material.uniforms.dtScale.value=v.layerTransparency)}else t?.current?.material?.uniforms&&(t.current.material.uniforms.volumeCount.value=0,t.current.material.uniforms.volumeTex.value=null)}},[v]),!v.is3dMode)return null;if(v.is3dMode&&(!h.uniforms||!h.shader))return i.aI.jsxs("group",{children:[i.aI.jsx("ambientLight",{}),i.aI.jsx("pointLight",{position:[10,10,10]}),i.aI.jsx(Nr,{color:"white",scale:20,fontWeight:1e3,children:"Loading ..."})]});const V={segmentationGroup:u,segmentationSettings:b,segmentationSceneScale:d,renderingSettings:h,materialRef:t,highlightEntity:j,setObsHighlight:F};return i.aI.jsxs("group",{children:[i.aI.jsx(Lr,{}),i.aI.jsx(kr,{}),i.aI.jsx(Sa,{}),i.aI.jsx(Aa,{}),i.aI.jsx(Ea,{...V}),i.aI.jsx(Or,{ref:n,enableDamping:!1,dampingFactor:0,zoomDampingFactor:0,smoothZoom:!1})]})}const Oa=(0,a.forwardRef)((e,t)=>i.aI.jsxs("div",{style:{width:"100%",height:"100%"},children:[i.aI.jsx(Tt,{mode:"AR",sessionInit:{optionalFeatures:["hand-tracking"]},style:{border:"none",background:"rgba(0, 0, 0, 0.0)",zIndex:1,position:"absolute"},children:e=>"unsupported"!==e?i.aI.jsx("div",{style:{border:"1px solid white",padding:"12px 24px",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",cursor:"pointer"},children:"entered"===e?"Exit AR":"Enter AR"}):null}),i.aI.jsx(st,{style:{position:"absolute",top:0,left:0},camera:{fov:50,up:[0,1,0],position:[0,0,800],near:.1,far:3e3},gl:{antialias:!0,logarithmicDepthBuffer:!1},ref:t,children:i.aI.jsx(_t,{children:i.aI.jsx(Na,{...e})})})]}))}}]);
//# sourceMappingURL=700.5991d261.chunk.js.map